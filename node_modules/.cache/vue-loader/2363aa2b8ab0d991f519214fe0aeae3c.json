{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\cti\\call-relay-group\\callRelayGroup.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\cti\\call-relay-group\\callRelayGroup.vue","mtime":1614579763231},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi8uLi8uLi9zdHlsZXMvdHJlZSZ0YWJsZS1jb21tb24ubGVzcyI7DQpAaW1wb3J0ICIuLi8uLi9zeXMvYmxhY2tsaXN0LW1hbmFnZS9ibGFja2xpc3RNYW5hZ2UiOw0K"},{"version":3,"sources":["callRelayGroup.vue"],"names":[],"mappings":";AACA;AACA","file":"callRelayGroup.vue","sourceRoot":"src/views/cti/call-relay-group","sourcesContent":["<style lang=\"less\">\r\n@import \"../../../styles/tree&table-common.less\";\r\n@import \"../../sys/blacklist-manage/blacklistManage\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Card>\r\n      <Row>\r\n       <div style=\"height:100%\">\r\n         <div class=\"own-space ui-time-schedule-settings\">\r\n           <Col :xs=\"10\" :sm=\"8\" :md=\"8\" :lg=\"7\" class=\"own-space-left bg-default ui-Menu-nesting-default-warp\">\r\n             <div class=\"own-header\">\r\n               <Button\r\n                   type=\"default\"\r\n                   icon=\"md-add\"\r\n                   @click=\"addRelayGroups\"\r\n               >添加中继组</Button\r\n               >\r\n             </div>\r\n             <Menu theme=\"light\" style=\"width: 100%\" class=\"ui-Menu-nesting-default\">\r\n               <Submenu v-for=\"(item,i) in treeData\" :key=\"item.id\" :name=\"item.id\">\r\n                 <template slot=\"title\">\r\n                   <div  @click=\"getCallRelayGroupTenantList1\">\r\n                     {{ item.ctiName }}\r\n                   </div>\r\n                 </template>\r\n                 <MenuItem v-for=\"(itemChild,iChild) in item.children\" :key=\"iChild.id\" :name=\"itemChild.id\" @click.native=\"getCallRelayGroupTenantList1(itemChild.id,item.id)\">\r\n                   {{itemChild.ctiName}}\r\n                   <div class=\"ui-icon-box\">\r\n                     <Icon\r\n                         type=\"ios-create-outline\"\r\n                         @click=\"editRelayGroups1(itemChild)\"\r\n                         @click.stop\r\n                     />\r\n                     <Icon\r\n                         type=\"ios-trash-outline\"\r\n                         @click=\"deleteRelayGroups1(itemChild)\"\r\n                         @click.stop\r\n                     />\r\n                   </div>\r\n                 </MenuItem>\r\n               </Submenu>\r\n             </Menu>\r\n             <!--{{blackListGroups}}-->\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n             <!--          <hr>-->\r\n             <!--          <Row class=\"operation\">-->\r\n             <!--            <Button @click=\"addRelayGroups\" type=\"primary\" icon=\"md-add\"-->\r\n             <!--              >添加中继组</Button-->\r\n             <!--            >-->\r\n             <!--            <Dropdown @on-click=\"handleDropdown\">-->\r\n             <!--              <Button>-->\r\n             <!--                更多操作-->\r\n             <!--                <Icon type=\"md-arrow-dropdown\" />-->\r\n             <!--              </Button>-->\r\n             <!--              <DropdownMenu slot=\"list\">-->\r\n             <!--                <DropdownItem name=\"editRelayGroups\">编辑中继组</DropdownItem>-->\r\n             <!--                <DropdownItem name=\"deleteRelayGroups\">删除中继组</DropdownItem>-->\r\n             <!--                <DropdownItem name=\"refreshRelayGroup\">刷新</DropdownItem>-->\r\n             <!--              </DropdownMenu>-->\r\n             <!--            </Dropdown>-->\r\n             <!--          </Row>-->\r\n             <!--          <Alert show-icon>-->\r\n             <!--            当前选择：-->\r\n             <!--            <span class=\"select-title\">{{ editTitle }}</span>-->\r\n             <!--            <a class=\"select-clear\" v-if=\"editTitle\" @click=\"cancelEdit\"-->\r\n             <!--              >取消选择</a-->\r\n             <!--            >-->\r\n             <!--          </Alert>-->\r\n             <!--          &lt;!&ndash; <Input-->\r\n             <!--            v-model=\"searchKey\"-->\r\n             <!--            suffix=\"ios-search\"-->\r\n             <!--            @on-change=\"search\"-->\r\n             <!--            placeholder=\"输入搜索字典\"-->\r\n             <!--            clearable-->\r\n             <!--          /> &ndash;&gt;-->\r\n             <!--          <div class=\"tree-bar\" :style=\"{ maxHeight: maxHeight }\">-->\r\n             <!--            <Tree-->\r\n             <!--              ref=\"tree\"-->\r\n             <!--              :data=\"treeData\"-->\r\n             <!--              :render=\"renderContent\"-->\r\n             <!--              @on-select-change=\"selectTree\"-->\r\n             <!--            ></Tree>-->\r\n             <!--            <Spin size=\"large\" fix v-if=\"treeLoading\"></Spin>-->\r\n             <!--          </div>-->\r\n           </Col>\r\n           <Col :xs=\"14\" :sm=\"16\" :md=\"16\" :lg=\"17\">\r\n             <div class=\"own-space-right\">\r\n               <Tabs v-model=\"tabName\" :animated=\"false\" @on-click=\"changeTab\">\r\n                 <TabPane label=\"中继资源\" name=\"0\"></TabPane>\r\n                 <TabPane label=\"中继号码\" name=\"1\"></TabPane>\r\n               </Tabs>\r\n\r\n               <Row class=\"operation\">\r\n                 <Col v-show=\"relayGroupTip == 0\" class=\" ui-operation\">\r\n                   <div class=\"ui-operation-left\" v-show=\" selectCount > 0\">\r\n                     <Row class=\"ui-alert-warp\">\r\n                       <Alert>\r\n                         已选择\r\n                         <span class=\"select-count\">{{ selectCount }}</span> 项\r\n                         <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n                       </Alert>\r\n                     </Row>\r\n                     <Button @click=\"delAll\" icon=\"md-trash\">批量回收通道</Button>\r\n                     <Button @click=\"getCallRelayGroupTenantList\" icon=\"md-refresh\">刷新</Button>\r\n                   </div>\r\n                   <div class=\"ui-operation-right\" v-show=\" selectCount <= 0\">\r\n                     <Button @click=\"addCallRelayTenant\" type=\"primary\" icon=\"md-add\">添加公司通道</Button>\r\n                   </div>\r\n\r\n\r\n\r\n                   <!-- <Button type=\"dashed\" @click=\"openTip = !openTip\">{{\r\n                     openTip ? \"关闭提示\" : \"开启提示\"\r\n                   }}</Button> -->\r\n                 </Col>\r\n                 <Col v-show=\"relayGroupPhoneTip == 1\"  class=\" ui-operation\">\r\n\r\n                   <div class=\"ui-operation-left\" v-show=\" selectCount > 0\">\r\n                     <Row class=\"ui-alert-warp\">\r\n                       <Alert>\r\n                         已选择\r\n                         <span class=\"select-count\">{{ selectCount }}</span> 项\r\n                         <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n                       </Alert>\r\n                     </Row>\r\n                     <Button @click=\"delPhoneAll\" icon=\"md-trash\">批量删除</Button>\r\n                     <Dropdown @on-click=\"phoneDropdown\">\r\n                       <Button>\r\n                         更多操作\r\n                         <Icon type=\"md-arrow-dropdown\" />\r\n                       </Button>\r\n                       <DropdownMenu slot=\"list\">\r\n                         <DropdownItem name=\"distriButionPhone\">分配</DropdownItem>\r\n                         <DropdownItem name=\"recoveryPhone\">回收</DropdownItem>\r\n                         <DropdownItem name=\"enablePhone\">启用</DropdownItem>\r\n                         <DropdownItem name=\"outOfServicePhone\">停用</DropdownItem>\r\n                       </DropdownMenu>\r\n                     </Dropdown>\r\n                   </div>\r\n                   <div class=\"ui-operation-right\" v-show=\" selectCount <= 0\">\r\n                     <Button @click=\"addPhone\" type=\"primary\" icon=\"md-add\">添加中继号码</Button>\r\n                     <Button @click=\"importExcel\" icon=\"ios-download\">导入数据</Button>\r\n                     <Button @click=\"getCallRelayPhoneList\" icon=\"md-refresh\">刷新</Button>\r\n                   </div>\r\n\r\n\r\n\r\n\r\n\r\n                   <!-- <Button type=\"dashed\" @click=\"openTip = !openTip\">{{\r\n                     openTip ? \"关闭提示\" : \"开启提示\"\r\n                   }}</Button> -->\r\n                 </Col>\r\n               </Row>\r\n\r\n               <Row>\r\n                 <Table\r\n                     :loading=\"loading\"\r\n                     :columns=\"columns\"\r\n                     :data=\"data\"\r\n                     sortable=\"custom\"\r\n                     @on-sort-change=\"changeSort\"\r\n                     @on-selection-change=\"showSelect\"\r\n                     ref=\"table\"\r\n                     @on-row-click=\"showDetail1\"\r\n                 ></Table>\r\n               </Row>\r\n               <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n                 <Page\r\n                     :current=\"pageNumber\"\r\n                     :total=\"total\"\r\n                     :page-size=\"pageSize\"\r\n                     @on-change=\"changePage\"\r\n                     @on-page-size-change=\"changePageSize\"\r\n                     :page-size-opts=\"[10, 20, 50]\"\r\n                     size=\"small\"\r\n                     show-total\r\n                     show-elevator\r\n                     show-sizer\r\n                 ></Page>\r\n               </Row>\r\n             </div>\r\n           </Col>\r\n         </div>\r\n       </div>\r\n<!--        <div class=\"expand\">-->\r\n<!--          <Icon-->\r\n<!--            :type=\"expandIcon\"-->\r\n<!--            size=\"16\"-->\r\n<!--            class=\"icon\"-->\r\n<!--            @click=\"changeExpand\"-->\r\n<!--          />-->\r\n<!--        </div>-->\r\n\r\n      </Row>\r\n    </Card>\r\n\r\n    <Drawer title=\"导入数据\" closable v-model=\"importModalVisible\" width=\"1000\">\r\n      <div\r\n        style=\"\r\n          display: flex;\r\n          justify-content: space-between;\r\n          align-items: center;\r\n        \"\r\n      ><Upload action :before-upload=\"beforeUploadImport\" accept=\".xls, .xlsx\">\r\n        <Button\r\n            :loading=\"reading\"\r\n            icon=\"ios-cloud-upload-outline\"\r\n            style=\"margin-right: 10px\"\r\n        >上传Excel文件</Button\r\n        >\r\n        <span v-if=\"uploadfile.name\"\r\n        >当前选择文件：{{ uploadfile.name }}</span\r\n        >\r\n      </Upload>\r\n\r\n        <!-- <input type=\"file\" @change=\"getFile($event)\" /><button @click=\"upload\">上传</button>\r\n        <div>{{ result }}</div> -->\r\n        <div v-show=\"uping == 1\">正在上传中</div>\r\n        <Button @click=\"clearImportData\" icon=\"md-trash\">清空数据</Button>\r\n      </div>\r\n      <Alert type=\"warning\" show-icon\r\n        >导入前请下载查看导入模版数据文件，确保数据格式正确，不得修改列英文名称。</Alert\r\n      >\r\n      <Table\r\n        :columns=\"phoneImportColumns\"\r\n        :height=\"height\"\r\n        :data=\"importTableData\"\r\n        ref=\"importTable\"\r\n      ></Table>\r\n      <div class=\"drawer-footer\">\r\n        <Button\r\n          @click=\"downloadTemple\"\r\n          type=\"info\"\r\n          style=\"position: absolute; left: 15px\"\r\n          >下载导入模板</Button\r\n        >\r\n        <Button @click=\"importModalVisible = false\">关闭</Button>\r\n        <Button\r\n          :loading=\"importLoading\"\r\n          :disabled=\"importTableData.length <= 0\"\r\n          @click=\"importData\"\r\n          style=\"margin-left: 5px\"\r\n          type=\"primary\"\r\n        >\r\n          确认导入\r\n          <span v-if=\"importTableData.length > 0\"\r\n            >{{ importTableData.length }} 条数据</span\r\n          >\r\n        </Button>\r\n      </div>\r\n    </Drawer>\r\n\r\n    <!-- <Modal :title=\"importExcelTitle\" v-model=\"importExcelModalVisible\" :mask-closable=\"false\" :width=\"700\">\r\n          <div style=\"display:flex;justify-content: space-between;align-items: center;\">\r\n          <Upload action :before-upload=\"beforeUploadImport\" accept=\".xls, .xlsx\">\r\n            <Button\r\n              :loading=\"reading\"\r\n              icon=\"ios-cloud-upload-outline\"\r\n              style=\"margin-right:10px\"\r\n            >上传Excel文件</Button>\r\n            <span v-if=\"uploadfile.name\">当前选择文件：{{ uploadfile.name }}</span>\r\n          </Upload>\r\n          <span>{{ result }}</span>\r\n          <span v-show=\"uping==1\">正在上传中</span>\r\n          <Button @click=\"upload\" icon=\"md-trash\">上传数据</Button>\r\n        </div>\r\n    </Modal> -->\r\n\r\n    <Modal\r\n      :title=\"relayGroupModalTitle\"\r\n      v-model=\"relayGroupModalVisible\"\r\n      :mask-closable=\"false\"\r\n      :width=\"500\"\r\n    >\r\n      <Form\r\n        ref=\"relayGroupForm\"\r\n        :model=\"relayGroupForm\"\r\n        :label-width=\"95\"\r\n        :rules=\"relayGroupFormValidate\"\r\n      >\r\n        <FormItem label=\"Cti名称\" prop=\"ctiManageId\">\r\n          <Select v-model=\"relayGroupForm.ctiManageId\" placeholder=\"请选择\">\r\n            <Option\r\n              v-for=\"(item, index) in queryCtiListItems\"\r\n              :key=\"index\"\r\n              :value=\"item.id\"\r\n              >{{ item.ctiName }}</Option\r\n            >\r\n          </Select>\r\n        </FormItem>\r\n        <FormItem label=\"中继组名称\" prop=\"relayGroupName\">\r\n          <Input v-model=\"relayGroupForm.relayGroupName\" />\r\n        </FormItem>\r\n        <FormItem label=\"中继组号\" prop=\"relayGroupNo\">\r\n          <Input v-model=\"relayGroupForm.relayGroupNo\" />\r\n        </FormItem>\r\n        <FormItem label=\"中继类型\" prop=\"relayGroupType\">\r\n          <Select v-model=\"relayGroupForm.relayGroupType\" placeholder=\"请选择\">\r\n            <Option value=\"1\">网络中继 (SIP，IAX)</Option>\r\n            <Option value=\"2\">模拟中继 (FXO口)</Option>\r\n            <Option value=\"3\">数字中继 (E1 PRI)</Option>\r\n          </Select>\r\n        </FormItem>\r\n        <FormItem label=\"通道总数\" prop=\"totalChanel\">\r\n          <!-- <Input v-model=\"relayGroupForm.totalChanel\"  /> -->\r\n          <InputNumber\r\n            :width=\"100\"\r\n            v-model=\"relayGroupForm.totalChanel\"\r\n          ></InputNumber>\r\n        </FormItem>\r\n        <FormItem label=\"溢出率(%)\" prop=\"overflowRate\">\r\n          <!-- <Input v-model=\"relayGroupForm.overflowRate\"  /> -->\r\n          <InputNumber\r\n            :width=\"100\"\r\n            v-model=\"relayGroupForm.overflowRate\"\r\n          ></InputNumber>\r\n        </FormItem>\r\n        <FormItem label=\"备注\" prop=\"remark\">\r\n          <Input v-model=\"relayGroupForm.remark\" />\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"relayGroupModalVisible = false\"\r\n          >取消</Button\r\n        >\r\n        <Button\r\n          type=\"primary\"\r\n          :loading=\"submitLoading\"\r\n          @click=\"handelSubmitRelayGroup\"\r\n          >提交</Button\r\n        >\r\n      </div>\r\n    </Modal>\r\n\r\n    <Modal\r\n      :title=\"modalTitle\"\r\n      v-model=\"modalVisible\"\r\n      :mask-closable=\"false\"\r\n      :width=\"700\"\r\n    >\r\n      <Form ref=\"form\" :model=\"form\" :label-width=\"180\" :rules=\"formValidate\">\r\n        <table id=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th :width=\"250\">新增公司名称</th>\r\n              <th :width=\"150\">分配通道数量</th>\r\n              <th>\r\n                <Button\r\n                  style=\"float: right; margin-left: 60px\"\r\n                  @click=\"insertTd\"\r\n                  :width=\"200\"\r\n                  type=\"primary\"\r\n                  icon=\"md-add\"\r\n                  >添加公司</Button\r\n                >\r\n              </th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"(item, index) in queryTenantListItems\" :key=\"index\">\r\n              <td :width=\"150\" style=\"text-align: center\">\r\n                {{ item.title\r\n                }}<Input\r\n                  v-model=\"item.tenantId\"\r\n                  v-show=\"false\"\r\n                  :value=\"item.tenantId\"\r\n                />\r\n              </td>\r\n              <td :width=\"150\">\r\n                <Input prop=\"maxChanel\" v-model=\"item.maxChanel\" />\r\n              </td>\r\n              <td>\r\n                <Button\r\n                  style=\"float: right\"\r\n                  @click=\"removeTd(index)\"\r\n                  type=\"primary\"\r\n                  icon=\"md-trash\"\r\n                  >移除</Button\r\n                >\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"modalVisible = false\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"handelSubmit\"\r\n          >提交</Button\r\n        >\r\n      </div>\r\n    </Modal>\r\n\r\n    <Modal\r\n      :title=\"modalTenantPhoneTitle\"\r\n      v-model=\"tenantPhoneModalVisible\"\r\n      :mask-closable=\"false\"\r\n      :width=\"500\"\r\n    >\r\n      <Form\r\n        ref=\"tenantPhoneForm\"\r\n        :model=\"tenantPhoneForm\"\r\n        :label-width=\"80\"\r\n        :rules=\"tenantPhoneFormValidate\"\r\n      >\r\n        <FormItem label=\"公司\" prop=\"tenantIds\">\r\n          <Select v-model=\"tenantPhoneForm.tenantIds\" placeholder=\"请选择\">\r\n            <Option\r\n              v-for=\"(item, index) in queryTenantPhoneListItems\"\r\n              :key=\"index\"\r\n              :value=\"item.id\"\r\n              >{{ item.title }}</Option\r\n            >\r\n          </Select>\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelTenantPhone\">取消</Button>\r\n        <Button\r\n          type=\"primary\"\r\n          :loading=\"submitLoading\"\r\n          @click=\"submitTenantPhone\"\r\n          >提交</Button\r\n        >\r\n      </div>\r\n    </Modal>\r\n\r\n    <Modal\r\n      :title=\"modalPhoneTitle\"\r\n      v-model=\"phoneModalVisible\"\r\n      :mask-closable=\"false\"\r\n      :width=\"600\"\r\n    >\r\n      <Form\r\n        ref=\"phoneForm\"\r\n        :model=\"phoneForm\"\r\n        :label-width=\"110\"\r\n        :rules=\"phoneFormValidate\"\r\n      >\r\n        <FormItem label=\"外呼主叫号码\" prop=\"relayPhoneNumber\">\r\n          <Input v-model=\"phoneForm.relayPhoneNumber\" />\r\n        </FormItem>\r\n        <FormItem label=\"工作模式\" prop=\"workMode\">\r\n          <Select v-model=\"phoneForm.workMode\" placeholder=\"请选择\">\r\n            <Option value=\"1\">呼入呼出</Option>\r\n            <Option value=\"0\">仅呼入</Option>\r\n          </Select>\r\n        </FormItem>\r\n        <FormItem label=\"拉入黑名单\" prop=\"blackMark\">\r\n          <Select v-model=\"phoneForm.blackMark\" placeholder=\"请选择\">\r\n            <Option value=\"1\">不加入黑名单</Option>\r\n            <Option value=\"0\">加入黑名单</Option>\r\n          </Select>\r\n        </FormItem>\r\n        <FormItem label=\"备注\" prop=\"remark\">\r\n          <Input type=\"textarea\" v-model=\"phoneForm.remark\" :rows=\"4\" />\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelPhone\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitPhone\"\r\n          >提交</Button\r\n        >\r\n      </div>\r\n    </Modal>\r\n\r\n    <Modal\r\n      :title=\"modalTenantTitle\"\r\n      v-model=\"modalTenantVisible\"\r\n      :mask-closable=\"false\"\r\n      :width=\"800\"\r\n    >\r\n      <Row v-show=\"openTipTenant\">\r\n        <Alert show-icon>\r\n          已选择\r\n          <span class=\"select-count\">{{ selectTenantCount }}</span> 项\r\n          <a class=\"select-clear\" @click=\"clearTenantSelectAll\">清空</a>\r\n        </Alert>\r\n      </Row>\r\n      <Row>\r\n        <Table\r\n          :loading=\"loading\"\r\n          :columns=\"columnsTenant\"\r\n          :data=\"dataTenant\"\r\n          sortable=\"title\"\r\n          @on-sort-change=\"changeTenantSort\"\r\n          @on-selection-change=\"showTenantSelect\"\r\n          ref=\"tableTenant\"\r\n          @on-row-click=\"showDetail\"\r\n        ></Table>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n        <Page\r\n          :current=\"pageNumberTenant\"\r\n          :total=\"totalTenant\"\r\n          :page-size=\"pageSizeTenant\"\r\n          @on-change=\"changeTenantPage\"\r\n          @on-page-size-change=\"changeTenantPageSize\"\r\n          :page-size-opts=\"[10, 20, 50]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n        ></Page>\r\n      </Row>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"modalTenantVisible = false\">取消</Button>\r\n        <Button\r\n          type=\"primary\"\r\n          :loading=\"submitLoading\"\r\n          @click=\"handelTenantSubmit\"\r\n          >提交</Button\r\n        >\r\n      </div>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getAllCtiList,\r\n  getCtiList,\r\n  addRelayGroup,\r\n  editRelayGroup,\r\n  deleteRelayGroup,\r\n  getCallRelayGroupTenantAll,\r\n  getAllTenantDataList,\r\n  addRelayGroupTenant,\r\n  deleteRelayGroupTenant,\r\n  getCallRelayPhoneAlls,\r\n  addRelayGroupPhone,\r\n  editRelayGroupPhone,\r\n  deleteRelayGroupPhone,\r\n  operationPhoneTenant,\r\n  importCallRelayPhoneList,\r\n  getTenantAllLists,\r\n  searchDict,\r\n  getAllDictDataList,\r\n  addDictData,\r\n  editDictData,\r\n  deleteData,\r\n} from \"@/api/index\";\r\n\r\nimport { getStore, setStore } from \"@/libs/storage\";\r\nimport { phoneImportColumns, phoneData } from \"@/libs/importCallRelayPhone\";\r\nimport excel from \"@/libs/excel\";\r\nexport default {\r\n  name: \"call-relaygroup\",\r\n  data() {\r\n    return {\r\n      openTip: false,\r\n      treeLoading: false, // 树加载状态\r\n      maxHeight: \"500px\",\r\n      loading: false, // 表格加载状态\r\n      editTitle: \"\", // 编辑节点名称\r\n      searchKey: \"\", // 搜索树\r\n      expand: true,\r\n      span: 18,\r\n      expandIcon: \"ios-arrow-back\",\r\n      selectNode: {},\r\n      treeData: [], // 树数据\r\n      selectCount: 0, // 多选计数\r\n      selectList: [], // 多选数据\r\n      relayGroupTip: 0,\r\n      relayGroupPhoneTip: 0,\r\n      modalTenantVisible: false, // 添加或编辑显示\r\n      modalTenantTitle: \"\", // 添加或编辑标题\r\n      openTipTenant: false,\r\n      loadingTenant: false, // 表格加载状态\r\n      selectTenantCount: 0, // 多选计数\r\n      selectTenantList: [], // 多选数据\r\n      pageNumberTenant: 1,\r\n      pageSizeTenant: 10,\r\n      pageNumber: 1, // 当前页数\r\n      pageSize: 10, // 页面大小\r\n      upath: \"\",\r\n      groupId:\"\",\r\n      importModalVisible: false, // 导入显示\r\n      importExcelModalVisible: false,\r\n      uploadfile: {\r\n        name: \"\",\r\n      },\r\n      importTableData: [],\r\n      importColumns: [],\r\n      importLoading: false, // 导入加载状态\r\n\r\n      tenantPhoneModalVisible: false, // 添加或编辑显示\r\n      modalTenantPhoneTitle: \"\", // 添加或编辑标题\r\n      tenantPhoneFormValidate: {\r\n        // 表单验证规则\r\n        tenantIds: [\r\n          { required: true, message: \"公司不能为空\", trigger: \"blur\" },\r\n        ],\r\n      },\r\n      tenantPhoneForm: {\r\n        tenantIds: \"\"\r\n      },\r\n      queryTenantPhoneListItems: [],\r\n      phoneModalVisible: false, // 添加或编辑显示\r\n      modalPhoneTitle: \"\", // 添加或编辑标题\r\n      importExcelTitle: \"导入数据\",\r\n      phoneForm: {\r\n        // 添加或编辑表单对象初始化数据\r\n        relayPhoneNumber: \"\",\r\n        workMode: \"\",\r\n        blackMark: \"\",\r\n      },\r\n      phoneFormValidate: {\r\n        // 表单验证规则\r\n        relayPhoneNumber: [\r\n          { required: true, message: \"中继号码不能为空\", trigger: \"blur\" }\r\n        ],\r\n        workMode: [\r\n          { required: true, message: \"工作模式不能为空\", trigger: \"change\" }\r\n        ],\r\n        blackMark: [\r\n          { required: true, message: \"黑名单不能为空\", trigger: \"change\" }\r\n        ],\r\n      },\r\n\r\n      columnsTenant: [\r\n        // 表头\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          title: \"公司编号\",\r\n          key: \"code\",\r\n          width: 200,\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"公司名称\",\r\n          key: \"title\",\r\n          width: 355,\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"可分配通道数量\",\r\n          key: \"chanleNum\",\r\n          width: 150,\r\n          sortable: true\r\n        }\r\n      ],\r\n      dataTenant: [], //表单数据\r\n      totalTenant: 0, // 表单数据总数\r\n      searchTenantForm: {\r\n        pageNumberTenant: 1, // 当前页数\r\n        pageSizeTenant: 10, // 页面大小\r\n        sort: \"create_time\", // 默认排序字段\r\n        order: \"desc\", // 默认排序方式\r\n      },\r\n      searchForm: {\r\n        // 搜索框对应data对象\r\n        pageNumber: 1, // 当前页数\r\n        pageSize: 10, // 页面大小\r\n        sort: \"createTime\", // 默认排序字段\r\n        order: \"desc\", // 默认排序方式\r\n      },\r\n      modalType: 0, // 添加或编辑标识\r\n      modalVisible: false, // 添加或编辑显示\r\n      relayGroupModalVisible: false,\r\n      relayGroupModalTitle: \"\",\r\n      modalTitle: \"\", // 添加或编辑标题\r\n      queryCtiListItems: [],\r\n      queryTenantListItems: [],\r\n      maxNum: 0,\r\n      relayGroupForm: {\r\n        ctiManageId: \"\",\r\n        relayGroupName: \"\",\r\n        relayGroupNo: \"\",\r\n        relayGroupType: \"\",\r\n        remark: \"\",\r\n        totalChanel: \"0\",\r\n        overflowRate: \"0\"\r\n      },\r\n      form: {\r\n        // 添加或编辑表单对象初始化数据\r\n        maxChanel: \"\",\r\n      },\r\n      relayGroupFormValidate: {\r\n        // 表单验证规则\r\n        ctiManageId: [\r\n          { required: true, message: \"Cti不能为空\", trigger: \"change\" }\r\n        ],\r\n        relayGroupName: [\r\n          { required: true, message: \"中继名称不能为空\", trigger: \"blur\" }\r\n        ],\r\n        relayGroupNo: [\r\n          { required: true, message: \"中继编号不能为空\", trigger: \"blur\" }\r\n        ],\r\n        relayGroupType: [\r\n          { required: true, message: \"中继类型不能为空\", trigger: \"change\" }\r\n        ]\r\n      },\r\n      formValidate: {\r\n        // 表单验证规则\r\n        maxChanel: [\r\n          { required: true, message: \"分配数量不能为空\", trigger: \"blur\" }\r\n        ],\r\n      },\r\n      columns: [\r\n        // 表头\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\",\r\n        },\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\",\r\n        },\r\n        {\r\n          title: \"公司名称\",\r\n          key: \"title\",\r\n          width: 140,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"中继组名称\",\r\n          key: \"relayGroupName\",\r\n          width: 130,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"中继组号\",\r\n          key: \"relayGroupNo\",\r\n          width: 120,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"已分配通道数\",\r\n          key: \"maxChanel\",\r\n          width: 120,\r\n        },\r\n        {\r\n          title: \"公司最大通道数/公司已分配通道数\",\r\n          key: \"maxNum\",\r\n          width: 270,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          width: 160,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          width: 52,\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              //删除\r\n              h('Tooltip',{props: {\r\n                  placement: 'top',\r\n                  transfer: true\r\n                }},[h(\r\n                  \"Icon\",\r\n                  {\r\n                    props: {\r\n                      type: \"ios-trash-outline\",\r\n                      size: \"\",\r\n                    },\r\n                    style: { marginRight: \"5px\",fontSize:'18px',cursor: 'pointer' },\r\n                    on: {\r\n                      click: () => {\r\n                        this.remove(params.row);\r\n                      },\r\n                    },\r\n                  },\r\n                  this.$t(\"play\")\r\n              ),h('span', {\r\n                slot: 'content',\r\n                style: {\r\n                  whiteSpace: 'normal'\r\n                }\r\n              }, '删除')]),\r\n            ]);\r\n          },\r\n        },\r\n      ],\r\n      submitLoading: false, // 添加或编辑提交状态\r\n      data: [], //表单数据\r\n      total: 0, // 表单数据总数\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      // 获取树数据\r\n      this.getAllCti();\r\n      //表单获取Cti数据\r\n      this.getAllCtiLists();\r\n    },\r\n    getAllCti() {\r\n      this.treeLoading = true;\r\n      getAllCtiList().then((res) => {\r\n        this.treeLoading = false;\r\n        if (res.success) {\r\n          var result = res.result;\r\n          for (var i = 0; i < result.length; i++) {\r\n            var children = result[i].children;\r\n            var childrenList = [];\r\n            for (var y = 0; y < children.length; y++) {\r\n              var totalC = 0;\r\n              if (parseInt(children[y].overflowRate) >= 0) {\r\n                totalC =\r\n                  children[y].totalChanel +\r\n                  Math.round(\r\n                    parseFloat(children[y].overflowRate / 100).toFixed(2) *\r\n                      children[y].totalChanel\r\n                  );\r\n              } else {\r\n                totalC = children[y].totalChanel;\r\n              }\r\n              childrenList.push({\r\n                relayGroupId: children[y].id,\r\n                id: children[y].id,\r\n                ctiName:\r\n                  children[y].relayGroupName +\r\n                  \"(\" +\r\n                  totalC +\r\n                  \"/\" +\r\n                  children[y].maxChanel +\r\n                  \")\",\r\n                relayGroupName: children[y].relayGroupName,\r\n                relayGroupNo: children[y].relayGroupNo,\r\n                relayGroupType: children[y].relayGroupType,\r\n                totalChanel: children[y].totalChanel,\r\n                overflowRate: children[y].overflowRate,\r\n                ctiManageId: children[y].ctiManageId,\r\n                areaCode: children[y].areaCode,\r\n                remark: children[y].remark,\r\n                maxChanel: children[y].maxChanel,\r\n                createBy: children[y].create_by,\r\n                createTime: children[y].create_time,\r\n                icon: \"ios-call\"\r\n              });\r\n            }\r\n            result[i].icon = \"ios-navigate\";\r\n            result[i].children = JSON.parse(JSON.stringify(childrenList));\r\n          }\r\n\r\n          this.treeData = result;\r\n        }\r\n      });\r\n    },\r\n    getTenantAll() {\r\n      getTenantAllLists().then((res) => {\r\n        if (res.success) {\r\n          this.queryTenantPhoneListItems = res.result;\r\n        }\r\n      });\r\n    },\r\n    changeTab(v) {\r\n      if (0 == v) {\r\n        this.relayGroupTip = v;\r\n        this.relayGroupPhoneTip = v;\r\n        this.columns = [\r\n          // 表头\r\n          {\r\n            type: \"selection\",\r\n            width: 60,\r\n            align: \"center\",\r\n          },\r\n          {\r\n            type: \"index\",\r\n            width: 60,\r\n            align: \"center\",\r\n          },\r\n          {\r\n            title: \"公司名称\",\r\n            key: \"title\",\r\n            width: 140,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"中继组名称\",\r\n            key: \"relayGroupName\",\r\n            width: 130,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"中继组号\",\r\n            key: \"relayGroupNo\",\r\n            width: 120,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"已分配通道数\",\r\n            key: \"maxChanel\",\r\n            width: 120,\r\n          },\r\n          {\r\n            title: \"公司最大通道数/公司已分配通道数\",\r\n            key: \"maxNum\",\r\n            width: 270,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"创建时间\",\r\n            key: \"createTime\",\r\n            width: 160,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"操作\",\r\n            key: \"action\",\r\n            width: 70,\r\n            render: (h, params) => {\r\n              return h(\"div\", [\r\n                h('Tooltip',{props: {\r\n                    placement: 'top',\r\n                    transfer: true\r\n                  }},[h(\r\n                    \"Icon\",\r\n                    {\r\n                      props: {\r\n                        type: \"ios-create-outline\",\r\n                        size: \"\",\r\n                      },\r\n                      style: { marginRight: \"5px\",fontSize:'18px',cursor: 'pointer' },\r\n                      on: {\r\n                        click: () => {\r\n                          this.remove(params.row);\r\n                        },\r\n                      },\r\n                    },\r\n                    this.$t(\"play\")\r\n                ),h('span', {\r\n                  slot: 'content',\r\n                  style: {\r\n                    whiteSpace: 'normal'\r\n                  }\r\n                }, '删除')]),\r\n                // h(\r\n                //   \"Button\",\r\n                //   {\r\n                //     props: {\r\n                //       type: \"error\",\r\n                //       size: \"small\",\r\n                //     },\r\n                //     on: {\r\n                //       click: () => {\r\n                //         this.remove(params.row);\r\n                //       },\r\n                //     },\r\n                //   },\r\n                //   \"删除\"\r\n                // ),\r\n              ]);\r\n            },\r\n          },\r\n        ];\r\n        this.getCallRelayGroupTenantList();\r\n      } else {\r\n        this.relayGroupTip = v;\r\n        this.relayGroupPhoneTip = v;\r\n        this.columns = [\r\n          // 表头\r\n          {\r\n            type: \"selection\",\r\n            width: 60,\r\n            align: \"center\",\r\n          },\r\n          {\r\n            title: \"公司名称\",\r\n            key: \"title\",\r\n            width: 210,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"中继号码\",\r\n            key: \"relayPhoneNumber\",\r\n            width: 125,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"所属CTI\",\r\n            key: \"ctiName\",\r\n            width: 110,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"中继组名称\",\r\n            key: \"relayGroupName\",\r\n            width: 125,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"分配状态\",\r\n            key: \"assigned\",\r\n            width: 100,\r\n          },\r\n          {\r\n            title: \"有效状态\",\r\n            key: \"enabled\",\r\n            width: 120,\r\n            render: (h, params) => {\r\n              let re = \"\";\r\n              if (params.row.enabled == \"1\") {\r\n                return h(\"div\", [\r\n                  h(\"Badge\", {\r\n                    props: {\r\n                      status: \"success\",\r\n                      text: \"有效\",\r\n                    },\r\n                  }),\r\n                ]);\r\n              } else if (params.row.enabled == \"0\") {\r\n                return h(\"div\", [\r\n                  h(\"Badge\", {\r\n                    props: {\r\n                      status: \"error\",\r\n                      text: \"无效\",\r\n                    },\r\n                  }),\r\n                ]);\r\n              }\r\n            },\r\n          },\r\n          {\r\n            title: \"工作模式\",\r\n            key: \"workMode\",\r\n            width: 100,\r\n            render: (h, params) => {\r\n              let re = \"\";\r\n              if (params.row.workMode == \"1\") {\r\n                return h(\"span\", [h(\"span\", \"呼入呼出\")]);\r\n              } else if (params.row.workMode == \"0\") {\r\n                return h(\"span\", [h(\"span\", \"仅呼入\")]);\r\n              }\r\n            },\r\n          },\r\n          {\r\n            title: \"备注\",\r\n            key: \"remark\",\r\n            width: 150,\r\n            sortable: true,\r\n          },\r\n          {\r\n            title: \"操作\",\r\n            key: \"action\",\r\n            width: 90,\r\n            render: (h, params) => {\r\n              return h(\"div\", [\r\n                h('Tooltip',{props: {\r\n                    placement: 'top',\r\n                    transfer: true\r\n                  }},[h(\r\n                    \"Icon\",\r\n                    {\r\n                      props: {\r\n                        type: \"ios-create-outline\",\r\n                        size: \"\",\r\n                      },\r\n                      style: { marginRight: \"5px\",fontSize:'18px',cursor: 'pointer' },\r\n                      on: {\r\n                        click: () => {\r\n                          this.editPhone(params.row);\r\n                        },\r\n                      },\r\n                    },\r\n                    this.$t(\"play\")\r\n                ),h('span', {\r\n                  slot: 'content',\r\n                  style: {\r\n                    whiteSpace: 'normal'\r\n                  }\r\n                }, '编辑')]),\r\n                // h(\r\n                //   \"Button\",\r\n                //   {\r\n                //     props: {\r\n                //       type: \"primary\",\r\n                //       size: \"small\",\r\n                //     },\r\n                //     style: {\r\n                //       marginRight: \"5px\",\r\n                //     },\r\n                //     on: {\r\n                //       click: () => {\r\n                //         this.editPhone(params.row);\r\n                //       },\r\n                //     },\r\n                //   },\r\n                //   \"编辑\"\r\n                // ),\r\n                // h(\r\n                //   \"Button\",\r\n                //   {\r\n                //     props: {\r\n                //       type: \"error\",\r\n                //       size: \"small\",\r\n                //     },\r\n                //     on: {\r\n                //       click: () => {\r\n                //         this.removePhone(params.row);\r\n                //       },\r\n                //     },\r\n                //   },\r\n                //   \"删除\"\r\n                // ),\r\n                h('Tooltip',{props: {\r\n                    placement: 'top',\r\n                    transfer: true\r\n                  }},[h(\r\n                    \"Icon\",\r\n                    {\r\n                      props: {\r\n                        type: \"ios-trash-outline\",\r\n                        size: \"\",\r\n                      },\r\n                      style: { marginRight: \"5px\",fontSize:'18px',cursor: 'pointer' },\r\n                      on: {\r\n                        click: () => {\r\n                          this.removePhone(params.row);\r\n                        },\r\n                      },\r\n                    },\r\n                    this.$t(\"play\")\r\n                ),h('span', {\r\n                  slot: 'content',\r\n                  style: {\r\n                    whiteSpace: 'normal'\r\n                  }\r\n                }, '删除')]),\r\n              ]);\r\n            },\r\n          },\r\n        ];\r\n        this.getCallRelayPhoneList();\r\n      }\r\n    },\r\n    getAllCtiLists() {\r\n      getAllCtiList().then((res) => {\r\n        if (res.success) {\r\n          var result = res.result;\r\n          for (var i = 0; i < result.length; i++) {\r\n            this.queryCtiListItems.push({\r\n              id: result[i].id,\r\n              ctiName: result[i].ctiName,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    renderContent(h, { root, node, data }) {\r\n      // return h(\"span\", [\r\n      //   h(\"span\", [\r\n      //     h(\"span\", data.ctiName),\r\n      //   ]),\r\n      // ]);\r\n      return h(\"span\", [\r\n        h(\"span\", [\r\n          h(\"Icon\", {\r\n            props: {\r\n              type: data.icon,\r\n              size: \"16\",\r\n              color: \"\",\r\n            },\r\n            style: {\r\n              \"margin-right\": \"8px\",\r\n              \"margin-bottom\": \"3px\",\r\n            },\r\n          }),\r\n          h(\"span\", data.ctiName),\r\n        ]),\r\n      ]);\r\n    },\r\n    search() {\r\n      // 搜索树\r\n      if (this.searchKey) {\r\n        this.treeLoading = true;\r\n        searchDict({ key: this.searchKey }).then((res) => {\r\n          this.treeLoading = false;\r\n          if (res.success) {\r\n            this.treeData = res.result;\r\n          }\r\n        });\r\n      } else {\r\n        // 为空重新加载\r\n        this.getAllCti();\r\n      }\r\n    },\r\n    selectTree(v) {\r\n      if (v.length > 0) {\r\n        // 转换null为\"\"\r\n        for (let attr in v[0]) {\r\n          if (v[0][attr] == null) {\r\n            v[0][attr] = \"\";\r\n          }\r\n        }\r\n        let str = JSON.stringify(v[0]);\r\n        let data = JSON.parse(str);\r\n        this.selectNode = data;\r\n        this.relayGroupForm = data;\r\n        this.editTitle = data.ctiName;\r\n        // 重新加载表\r\n        this.searchForm.pageNumber = 1;\r\n        this.searchForm.pageSize = 10;\r\n        if (this.relayGroupTip == 0) {\r\n          this.getCallRelayGroupTenantList();\r\n        } else {\r\n          this.getCallRelayPhoneList();\r\n        }\r\n      } else {\r\n        this.cancelEdit();\r\n      }\r\n    },\r\n    addCallRelayTenant() {\r\n      if (!this.selectNode.relayGroupId) {\r\n        this.$Message.warning(\"请先选择一个中继组进行分配\");\r\n        return;\r\n      }\r\n      if (parseInt(this.selectNode.overflowRate) >= 0) {\r\n        this.maxNum =\r\n          parseInt(\r\n            this.selectNode.totalChanel +\r\n              Math.round(\r\n                parseFloat(this.selectNode.overflowRate / 100).toFixed(2) *\r\n                  this.selectNode.totalChanel\r\n              )\r\n          ) - parseInt(this.selectNode.maxChanel);\r\n      } else {\r\n        this.maxNum =\r\n          parseInt(this.selectNode.totalChanel) -\r\n          parseInt(this.selectNode.maxChanel);\r\n      }\r\n\r\n      if (this.maxNum <= 0) {\r\n        this.$Message.warning(\"分配通道数为0不能分配\");\r\n        return;\r\n      }\r\n      this.modalType = 0;\r\n      this.$refs.form.resetFields();\r\n      this.modalVisible = true;\r\n      this.modalTitle = \"新增中继组通道数(剩余分配总数\" + this.maxNum + \")\";\r\n      this.queryTenantListItems = [];\r\n    },\r\n    insertTd() {\r\n      this.modalTenantVisible = true;\r\n      this.modalTenantTitle=\"添加公司\";\r\n      this.getTenantDataList();\r\n    },\r\n    removeTd(index) {\r\n      this.queryTenantListItems.splice(index, 1);\r\n    },\r\n    cancelEdit() {\r\n      let data = this.$refs.tree.getSelectedNodes()[0];\r\n      if (data) {\r\n        data.selected = false;\r\n      }\r\n      // 取消选择后获取全部数据\r\n      this.selectNode = {};\r\n      this.editTitle = \"\";\r\n    },\r\n    changeSelect(v) {\r\n      this.selectCount = v.length;\r\n      this.selectList = v;\r\n    },\r\n    changeExpand() {\r\n      this.expand = !this.expand;\r\n      if (this.expand) {\r\n        this.expandIcon = \"ios-arrow-back\";\r\n        this.span = 18;\r\n      } else {\r\n        this.expandIcon = \"ios-arrow-forward\";\r\n        this.span = 23;\r\n      }\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      if (this.relayGroupTip == 0) {\r\n        this.getCallRelayGroupTenantList();\r\n      } else {\r\n        this.getCallRelayPhoneList();\r\n      }\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      if (this.relayGroupTip == 0) {\r\n        this.getCallRelayGroupTenantList();\r\n      } else {\r\n        this.getCallRelayPhoneList();\r\n      }\r\n    },\r\n    getCallRelayGroupTenantList() {\r\n      if (!this.selectNode.relayGroupId) {\r\n        this.data = [];\r\n        this.total = 0;\r\n        return;\r\n      }\r\n      \r\n      this.loading = true;\r\n      if (this.selectNode.relayGroupId) {\r\n        this.searchForm.callRelayGroupId = this.selectNode.relayGroupId;\r\n      } else {\r\n        delete this.searchForm.callRelayGroupId;\r\n      }\r\n      \r\n      getCallRelayGroupTenantAll(this.searchForm).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.data = res.result.list;\r\n          this.total = res.result.total;\r\n        }\r\n      });\r\n    },\r\n    //\r\n    getCallRelayGroupTenantList1(id,parentId) {\r\n      // if (!this.selectNode.relayGroupId) {\r\n      //   this.data = [];\r\n      //   this.total = 0;\r\n      //   return;\r\n      // }\r\n      this.groupId=id;\r\n      this.selectNode.relayGroupId=id;\r\n      this.selectNode.ctiManageId=parentId;\r\n      if (id!=undefined) {\r\n        this.searchForm.callRelayGroupId = id;\r\n      } else {\r\n        delete this.searchForm.callRelayGroupId;\r\n      }\r\n      if (this.relayGroupTip == 0) {\r\n        this.getCallRelayGroupTenantList();\r\n      } else {\r\n        this.getCallRelayPhoneList();\r\n      }\r\n      // getCallRelayGroupTenantAll(this.searchForm).then((res) => {\r\n      //   this.loading = false;\r\n      //   if (res.success) {\r\n      //     this.data = res.result.list;\r\n      //     this.total = res.result.total;\r\n      //   }\r\n      // });\r\n    },\r\n    getDataList() {\r\n      this.loading = true;\r\n      if (this.selectNode.id) {\r\n        this.searchForm.dictId = this.selectNode.id;\r\n      } else {\r\n        delete this.searchForm.dictId;\r\n      }\r\n      if (!this.searchForm.status) {\r\n        this.searchForm.status = \"\";\r\n      }\r\n      getAllDictDataList(this.searchForm).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.data = res.result.content;\r\n          this.total = res.result.totalElements;\r\n        }\r\n      });\r\n    },\r\n    clearTenantSelectAll() {\r\n      this.$refs.tableTenant.selectAll(false);\r\n    },\r\n    changeTenantSort(e) {\r\n      this.searchTenantForm.sort = e.key;\r\n      this.searchTenantForm.order = e.order;\r\n      if (e.order == \"normal\") {\r\n        this.searchTenantForm.order = \"\";\r\n      }\r\n      this.getTenantDataList();\r\n    },\r\n    showTenantSelect(e) {\r\n      this.selectTenantList = e;\r\n      this.selectTenantCount = e.length;\r\n      if(this.selectTenantCount > 0){\r\n         this.openTipTenant = true;\r\n      }else{\r\n         this.openTipTenant = false;\r\n      }\r\n    },\r\n    changeTenantPage(v) {\r\n      this.searchTenantForm.pageNumber = v;\r\n      this.getTenantDataList();\r\n      this.clearTenantSelectAll();\r\n    },\r\n    changeTenantPageSize(v) {\r\n      this.searchTenantForm.pageSize = v;\r\n      this.getTenantDataList();\r\n    },\r\n    handelTenantSubmit() {\r\n      this.queryTenantListItems = this.selectTenantList;\r\n      this.modalTenantVisible = false;\r\n      this.selectTenantList = [];\r\n    },\r\n    getTenantDataList() {\r\n      this.loading = true;\r\n      this.selectTenantCount = 0;\r\n      this.searchTenantForm.callRelayGroupId = this.selectNode.relayGroupId;\r\n      this.searchTenantForm.ctiManageId = this.selectNode.ctiManageId;\r\n\r\n      this.searchTenantForm.pageNumber = this.searchTenantForm.pageNumberTenant;\r\n      this.searchTenantForm.pageSize = this.searchTenantForm.pageSizeTenant;\r\n\r\n      getAllTenantDataList(this.searchTenantForm).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.dataTenant = res.result.list;\r\n          this.totalTenant = res.result.total;\r\n          //this.changeTenantPageSize(1);\r\n        }\r\n      });\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order == \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getDataList();\r\n    },\r\n    showSelect(e) {\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n      if(this.selectCount > 0){\r\n         this.openTip = true;\r\n      }else{\r\n         this.openTip = false;\r\n      }\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    refreshRelayGroup() {\r\n      this.getAllCti();\r\n      this.selectNode = {};\r\n      this.editTitle = \"\";\r\n    },\r\n    refreshCti() {\r\n      getAllCtiList().then((res) => {\r\n        if (res.success) {\r\n          var result = res.result;\r\n          for (var i = 0; i < result.length; i++) {\r\n            var children = result[i].children;\r\n            var childrenList = [];\r\n            for (var y = 0; y < children.length; y++) {\r\n              var totalC = 0;\r\n              if (parseInt(children[y].overflowRate) >= 0) {\r\n                totalC =\r\n                  children[y].totalChanel +\r\n                  Math.round(\r\n                    parseFloat(children[y].overflowRate / 100).toFixed(2) *\r\n                      children[y].totalChanel\r\n                  );\r\n              } else {\r\n                totalC = children[y].totalChanel;\r\n              }\r\n              childrenList.push({\r\n                relayGroupId: children[y].id,\r\n                id: children[y].id,\r\n                ctiName:\r\n                  children[y].relayGroupName +\r\n                  \"(\" +\r\n                  totalC +\r\n                  \"/\" +\r\n                  children[y].maxChanel +\r\n                  \")\",\r\n                relayGroupName: children[y].relayGroupName,\r\n                relayGroupNo: children[y].relayGroupNo,\r\n                relayGroupType: children[y].relayGroupType,\r\n                totalChanel: children[y].totalChanel,\r\n                overflowRate: children[y].overflowRate,\r\n                ctiManageId: children[y].ctiManageId,\r\n                areaCode: children[y].areaCode,\r\n                remark: children[y].remark,\r\n                maxChanel: children[y].maxChanel,\r\n                createBy: children[y].create_by,\r\n                createTime: children[y].create_time,\r\n                icon: \"ios-call\"\r\n              });\r\n            }\r\n            result[i].icon = \"ios-navigate\";\r\n            result[i].children = JSON.parse(JSON.stringify(childrenList));\r\n          }\r\n          this.selectNode = {};\r\n          this.treeData = [];\r\n          this.treeData = result;\r\n        }\r\n      });\r\n    },\r\n    handleDropdown(name) {\r\n      if (name == \"editRelayGroups\") {\r\n        if (!this.selectNode.relayGroupId) {\r\n          this.$Message.warning(\"1级是CTI,请选择二级中继组进行编辑\");\r\n          return;\r\n        }\r\n        this.editRelayGroups();\r\n      } else if (name == \"deleteRelayGroups\") {\r\n        this.deleteRelayGroups();\r\n      } else if (name == \"refreshRelayGroup\") {\r\n        this.refreshRelayGroup();\r\n      }\r\n    },\r\n    addRelayGroups() {\r\n      this.$refs.relayGroupForm.resetFields();\r\n      delete this.relayGroupForm.id;\r\n      this.modalType = 0;\r\n      this.relayGroupModalTitle = \"添加中继组\";\r\n      this.relayGroupModalVisible = true;\r\n      this.relayGroupForm = {};\r\n    },\r\n    editRelayGroups(v) {\r\n      this.modalType = 1;\r\n      this.relayGroupModalTitle = \"编辑中继组\";\r\n      v = this.selectNode;\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] == null) {\r\n           delete v[attr];\r\n        }\r\n      }\r\n      let str = JSON.stringify(v);\r\n      let roleInfo = JSON.parse(str);\r\n      this.relayGroupForm = {};\r\n      this.relayGroupForm = roleInfo;\r\n      this.relayGroupModalVisible = true;\r\n    },\r\n\r\n    deleteRelayGroups() {\r\n      if (!this.selectNode.relayGroupId) {\r\n        this.$Message.warning(\"1级是CTI,请选择二级中继组进行删除\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        loading: true,\r\n        content: \"您确认要删除 \" + this.selectNode.ctiName + \" ?\",\r\n        onOk: () => {\r\n          // 删除\r\n          deleteRelayGroup({ ids: this.selectNode.id }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.refreshRelayGroup();\r\n              this.getCallRelayGroupTenantList();\r\n              this.getCallRelayPhoneList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    //\r\n    editRelayGroups1(v) {\r\n\r\n      this.modalType = 1;\r\n      this.relayGroupModalTitle = \"编辑中继组\";\r\n      var data={};\r\n      for(var i in v){\r\n        if(v[i]!=null){\r\n          data[i]=v[i]\r\n        }\r\n      }\r\n      this.relayGroupForm = data;\r\n      this.relayGroupModalVisible = true;\r\n    },\r\n    //\r\n    deleteRelayGroups1(v) {\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        loading: true,\r\n        content: \"您确认要删除 \" + v.ctiName + \" ?\",\r\n        onOk: () => {\r\n          // 删除\r\n          deleteRelayGroup({ ids: v.id }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.refreshRelayGroup();\r\n              this.getCallRelayGroupTenantList();\r\n              this.getCallRelayPhoneList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    add() {\r\n      if (!this.selectNode.id) {\r\n        this.$Message.warning(\"请先选择一个字典类别\");\r\n        return;\r\n      }\r\n      this.modalType = 0;\r\n      this.modalTitle = \"添加字典 \" + this.editTitle + \" 的数据\";\r\n      this.$refs.form.resetFields();\r\n      this.modalVisible = true;\r\n    },\r\n    edit(v) {\r\n      this.modalType = 1;\r\n      this.modalTitle = \"编辑字典 \" + this.editTitle + \" 的数据\";\r\n      this.$refs.form.resetFields();\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] == null) {\r\n          v[attr] = \"\";\r\n        }\r\n      }\r\n      let str = JSON.stringify(v);\r\n      let data = JSON.parse(str);\r\n      this.form = data;\r\n      this.modalVisible = true;\r\n    },\r\n    handelSubmitRelayGroup() {\r\n      this.$refs.relayGroupForm.validate((valid) => {\r\n        if (valid) {\r\n          this.submitLoading = true;\r\n          if (this.modalType == 0) {\r\n            // 添加 避免编辑后传入id等数据 记得删除\r\n            delete this.relayGroupForm.id;\r\n            addRelayGroup(this.relayGroupForm).then((res) => {\r\n              this.submitLoading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.getAllCti();\r\n                this.relayGroupModalVisible = false;\r\n                this.relayGroupForm = [];\r\n              }\r\n            });\r\n          } else if (this.modalType == 1) {\r\n            // 编辑\r\n            editRelayGroup(this.relayGroupForm).then((res) => {\r\n              this.submitLoading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.getAllCti();\r\n                this.relayGroupModalVisible = false;\r\n                this.relayGroupForm = [];\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    handelSubmit() {\r\n      if (this.queryTenantListItems.length <= 0) {\r\n        this.$Message.success(\"分配成功\");\r\n        this.modalVisible = false;\r\n        return;\r\n      }\r\n      var totalNum = 0;\r\n      var result = this.queryTenantListItems;\r\n      for (var i = 0; i < result.length; i++) {\r\n        if (\r\n          result[i].maxChanel == \"\" ||\r\n          result[i].maxChanel == null ||\r\n          result[i].maxChanel <= 0\r\n        ) {\r\n          this.$Message.warning(\"可分配通道数不能为空且得大于0\");\r\n          return;\r\n        }\r\n        if (result[i].maxChanel > result[i].chanleNum) {\r\n          this.$Message.warning(\r\n            result[i].title + \"可分配通道数\" + result[i].chanleNum\r\n          );\r\n          return;\r\n        }\r\n        result[i].ctiManageId = this.selectNode.ctiManageId;\r\n        result[i].relayGroupId = this.selectNode.relayGroupId;\r\n        totalNum = totalNum + parseInt(result[i].maxChanel);\r\n      }\r\n      if (totalNum > this.maxNum) {\r\n        this.$Message.warning(\"剩余可分配通道数\" + this.maxNum);\r\n        return;\r\n      }\r\n      for (var i = 0; i < result.length; i++) {\r\n        addRelayGroupTenant(result[i]).then((res) => {});\r\n      }\r\n      this.$Message.success(\"分配成功\");\r\n      this.modalVisible = false;\r\n      setTimeout(() => {\r\n         this.getCallRelayGroupTenantList();\r\n      }, 150);\r\n     \r\n      \r\n    },\r\n    remove(v) {\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content: \"您确认要删除 \" + v.title + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          // 删除\r\n          deleteRelayGroupTenant({ ids: v.id }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.getCallRelayGroupTenantList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    delAll() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要回收的数据\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认回收\",\r\n        content: \"您确认要回收所选的 \" + this.selectCount + \" 条数据?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let ids = \"\";\r\n          this.selectList.forEach(function (e) {\r\n            ids += e.id + \",\";\r\n          });\r\n          ids = ids.substring(0, ids.length - 1);\r\n          // 批量删除\r\n          deleteRelayGroupTenant({ ids: ids }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.clearSelectAll();\r\n              this.getCallRelayGroupTenantList();\r\n              this.refreshRelayGroup();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    cancelPhone() {\r\n      this.phoneModalVisible = false;\r\n    },\r\n    submitPhone() {\r\n      this.$refs.phoneForm.validate((valid) => {\r\n        if (valid) {\r\n          if (this.modalType == 0) {\r\n            // 添加\r\n            this.submitLoading = true;\r\n            this.phoneForm.relayGroupId = this.selectNode.relayGroupId;\r\n            this.phoneForm.ctiManageId = this.selectNode.ctiManageId;\r\n            this.phoneForm.relayPhoneName = this.phoneForm.relayPhoneNumber;\r\n            this.phoneForm.enabled = 1;\r\n            addRelayGroupPhone(this.phoneForm).then((res) => {\r\n              this.submitLoading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.getCallRelayPhoneList();\r\n                this.phoneModalVisible = false;\r\n              }\r\n            });\r\n          } else {\r\n            this.submitLoading = true;\r\n            editRelayGroupPhone(this.phoneForm).then((res) => {\r\n              this.submitLoading = false;\r\n              if (res.success) {\r\n                this.$Message.success(\"操作成功\");\r\n                this.getCallRelayPhoneList();\r\n                this.phoneModalVisible = false;\r\n              }\r\n            });\r\n          }\r\n        }\r\n      });\r\n    },\r\n    addPhone() {\r\n      if (!this.selectNode.relayGroupId) {\r\n        this.$Message.warning(\"请先选择一个中继组进行新增\");\r\n        return;\r\n      }\r\n      this.showPhone = true;\r\n      this.modalType = 0;\r\n      this.$refs.phoneForm.resetFields();\r\n      this.phoneForm = {workMode:\"1\",blackMark:\"1\"};\r\n      this.phoneModalVisible = true;\r\n      this.modalPhoneTitle = \"新增中继号码\";\r\n    },\r\n    editPhone(v) {\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] == null) {\r\n          delete v[attr];\r\n        }\r\n        if (v[attr] == \"undefined\") {\r\n           v[attr] = \"\";\r\n        }\r\n        if(attr==\"workMode\"){\r\n          v[attr] = v[attr]+\"\";\r\n        }\r\n        if(attr==\"blackMark\"){\r\n          v[attr] = v[attr]+\"\";\r\n        }\r\n      }\r\n      this.modalType = 1;\r\n      this.phoneModalVisible = true;\r\n      this.modalPhoneTitle = \"编辑中继号码\";\r\n      this.$refs.phoneForm.resetFields();\r\n      let str = JSON.stringify(v);\r\n      let data = JSON.parse(str);\r\n      this.phoneForm = data;\r\n      this.showPhone = true;\r\n    },\r\n    removePhone(v) {\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content: \"您确认要删除 \" + v.relayPhoneNumber + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          // 删除\r\n          deleteRelayGroupPhone({ ids: v.id }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.getCallRelayPhoneList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    delPhoneAll() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要删除的数据\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let ids = \"\";\r\n          this.selectList.forEach(function (e) {\r\n            ids += e.id + \",\";\r\n          });\r\n          ids = ids.substring(0, ids.length - 1);\r\n          // 批量删除\r\n          deleteRelayGroupPhone({ ids: ids }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.getCallRelayPhoneList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    getCallRelayPhoneList() {\r\n      if (!this.selectNode.relayGroupId) {\r\n        this.data = [];\r\n        this.total = 0;\r\n        return;\r\n      }\r\n      this.loading = true;\r\n      this.searchForm.callRelayGroupId = this.selectNode.relayGroupId;\r\n      getCallRelayPhoneAlls(this.searchForm).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.data = res.result.list;\r\n          this.total = res.result.total;\r\n          this.selectCount = 0;\r\n        }\r\n      });\r\n    },\r\n    phoneDropdown(name) {\r\n      if (!this.selectNode.relayGroupId) {\r\n        this.$Message.warning(\"请先选择一个中继组选择要操作的数据\");\r\n        return;\r\n      }\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要操作的数据\");\r\n        return;\r\n      }\r\n      if (name == \"distriButionPhone\") {\r\n        this.tenantPhoneModalVisible = true;\r\n        this.queryTenantPhoneListItems = [];\r\n        this.modalTenantPhoneTitle = \"分配公司中继号码\";\r\n        this.tenantPhoneForm.tenantIds = \"\";\r\n        this.getTenantAll();\r\n      } else if (name == \"recoveryPhone\") {\r\n        this.operationPhoneTenantList(\"2\");\r\n      } else if (name == \"enablePhone\") {\r\n        this.operationPhoneTenantList(\"3\");\r\n      } else if (name == \"outOfServicePhone\") {\r\n        this.operationPhoneTenantList(\"4\");\r\n      }\r\n    },\r\n    operationPhoneTenantList(type) {\r\n      var param = {};\r\n      param[\"callRelayGroupId\"] = this.selectNode.relayGroupId;\r\n      param[\"ctiManageId\"] = this.selectNode.ctiManageId;\r\n      if (type == \"1\") {\r\n        param[\"tenantId\"] = this.tenantPhoneForm.tenantIds;\r\n      }else{\r\n        param[\"tenantId\"] = \"\";\r\n      }\r\n      let ids = \"\";\r\n      this.selectList.forEach(function (e) {\r\n        if (type == \"2\") {\r\n          if (e.phoneTenantId != null && e.phoneTenantId != \"\") {\r\n            ids += e.phoneTenantId + \",\";\r\n          }\r\n        } else if (type == \"1\") {\r\n          if (e.phoneTenantId != null && e.phoneTenantId != \"\") {\r\n          } else {\r\n            ids += e.id + \",\";\r\n          }\r\n        } else {\r\n          ids += e.id + \",\";\r\n        }\r\n      });\r\n      ids = ids.substring(0, ids.length - 1);\r\n      param[\"ids\"] = ids;\r\n      param[\"type\"] = type;\r\n      // 批量操作数据\r\n      operationPhoneTenant(param).then((res) => {\r\n        if (res.success) {\r\n          this.$Message.success(\"操作成功\");\r\n          this.getCallRelayPhoneList();\r\n          this.tenantPhoneModalVisible = false;\r\n          this.tenantPhoneForm.tenantIds = \"\";\r\n        }\r\n      });\r\n    },\r\n    cancelTenantPhone() {\r\n      this.queryTenantPhoneListItems = [];\r\n      this.tenantPhoneModalVisible = false;\r\n      this.tenantPhoneForm.tenantIds = \"\";\r\n    },\r\n    submitTenantPhone() {\r\n      this.operationPhoneTenantList(\"1\");\r\n    },\r\n    beforeUploadImport(file) {\r\n      this.uploadfile = file;\r\n      const fileExt = file.name.split(\".\").pop().toLocaleLowerCase();\r\n      if (fileExt == \"xlsx\" || fileExt == \"xls\") {\r\n        this.readFile(file);\r\n        this.file = file;\r\n      } else {\r\n        this.$Notice.warning({\r\n          title: \"文件类型错误\",\r\n          desc:\r\n            \"所选文件‘ \" +\r\n            file.name +\r\n            \" ’不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。\",\r\n        });\r\n      }\r\n      return false;\r\n    },\r\n    // 读取文件\r\n    readFile(file) {\r\n      this.reading = true;\r\n      const reader = new FileReader();\r\n      reader.readAsArrayBuffer(file);\r\n      reader.onerror = (e) => {\r\n        this.reading = false;\r\n        this.$Message.error(\"文件读取出错\");\r\n      };\r\n      reader.onload = (e) => {\r\n        const data = e.target.result;\r\n        const { header, results } = excel.read(data, \"array\");\r\n        const tableTitle = header.map((item) => {\r\n          return { title: item, key: item, minWidth: 100, align: \"center\" };\r\n        });\r\n        this.importTableData = results;\r\n        this.phoneImportColumns = tableTitle;\r\n        this.reading = false;\r\n        this.$Message.success(\"读取数据成功\");\r\n      };\r\n    },\r\n    downloadTemple() {\r\n      let title = [];\r\n      let key = [];\r\n      phoneImportColumns.forEach((e) => {\r\n        title.push(e.title);\r\n        key.push(e.key);\r\n      });\r\n      const params = {\r\n        title: title,\r\n        key: key,\r\n        data: phoneData,\r\n        autoWidth: true,\r\n        filename: \"导入数据模版\",\r\n      };\r\n      excel.export_array_to_excel(params);\r\n    },\r\n    importExcel() {\r\n      this.importModalVisible = true;\r\n      this.uploadfile = {};\r\n      this.uping = 0;\r\n      this.result = \"\";\r\n      this.importTableData = [];\r\n      this.phoneImportColumns = [];\r\n    },\r\n    importData() {\r\n      this.importLoading = true;\r\n      // 传入导入数据 后端接收body数组列表批量导入\r\n      // this.importRequest(\"请求路径\", this.importTableData).then(res => {\r\n      //   this.importLoading = false;\r\n      //   if (res.success) {\r\n      //     this.importModalVisible = false;\r\n      //     this.getDataList();\r\n      //     this.$Modal.info({\r\n      //       title: \"导入结果\",\r\n      //       content: res.message\r\n      //     });\r\n      //   }\r\n      // });\r\n      // 模拟请求成功\r\n      var params = {};\r\n      params[\"dataList\"] = JSON.stringify(this.importTableData);\r\n      params[\"relayGroupId\"] = this.selectNode.relayGroupId;\r\n      params[\"ctiManageId\"] = this.selectNode.ctiManageId;\r\n      importCallRelayPhoneList(params).then((res) => {\r\n        if (res.success) {\r\n          this.getCallRelayPhoneList();\r\n          this.importLoading = false;\r\n          this.importModalVisible = false;\r\n          this.$Modal.info({\r\n            title: \"导入结果\",\r\n            content: res.message,\r\n          });\r\n        }\r\n      });\r\n    },\r\n    clearImportData() {\r\n      this.importTableData = [];\r\n      this.importColumns = [];\r\n      this.uploadfile = {};\r\n    },\r\n    upload() {\r\n      this.importLoading = true;\r\n      var zipFormData = new FormData();\r\n      zipFormData.append(\"file\", this.uploadfile); //file要和@RequestParam(\"file\")MultipartFile file对应好\r\n      zipFormData.append(\"relayGroupId\", this.selectNode.relayGroupId);\r\n      zipFormData.append(\"ctiManageId\", this.selectNode.ctiManageId);\r\n      this.uping = 1;\r\n      importCallRelayPhoneList(zipFormData).then((res) => {\r\n        if (res.success) {\r\n          this.importLoading = false;\r\n          this.uping = 0;\r\n          this.result = res.message;\r\n        }\r\n      });\r\n    },\r\n    getFile(even) {\r\n      this.upath = event.target.files[0];\r\n    },\r\n    showDetail(row,index){\r\n      this.$refs.tableTenant.toggleSelect(index)\r\n    },\r\n    showDetail1(row,index){\r\n      this.$refs.table.toggleSelect(index)\r\n    }\r\n  },\r\n  mounted() {\r\n    // 计算高度\r\n    let height = document.documentElement.clientHeight;\r\n    this.maxHeight = Number(height - 287) + \"px\";\r\n    this.init();\r\n  },\r\n};\r\n</script>"]}]}