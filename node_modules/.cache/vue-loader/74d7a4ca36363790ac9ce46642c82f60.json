{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\own-space\\own-space.vue?vue&type=style&index=0&id=809e9776&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\own-space\\own-space.vue","mtime":1614579763341},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuL293bi1zcGFjZS5sZXNzIjsNCg=="},{"version":3,"sources":["own-space.vue"],"names":[],"mappings":";AACA","file":"own-space.vue","sourceRoot":"src/views/own-space","sourcesContent":["<style lang=\"less\" scoped>\r\n@import \"./own-space.less\";\r\n</style>\r\n\r\n<template>\r\n  <div class=\"own-space\">\r\n    <Card class=\"own-space-new\">\r\n      <div class=\"own-wrap\">\r\n        <div style=\"width:240px\">\r\n          <Menu :active-name=\"activeName\" theme=\"light\" @on-select=\"changeMenu\">\r\n            <MenuItem name=\"基本信息\">基本信息</MenuItem>\r\n            <MenuItem name=\"安全设置\">安全设置</MenuItem>\r\n            <MenuItem name=\"第三方账号绑定\">第三方账号绑定</MenuItem>\r\n            <MenuItem name=\"消息通知\">消息通知</MenuItem>\r\n          </Menu>\r\n        </div>\r\n        <div style=\"padding: 8px 40px;width:100%\">\r\n          <div class=\"title\">{{currMenu}}</div>\r\n          <div>\r\n            <div v-show=\"currMenu=='基本信息'\">\r\n              <Form ref=\"userForm\" :model=\"userForm\" :label-width=\"90\" label-position=\"left\">\r\n                <FormItem label=\"登录账号：\" prop=\"username\">{{userForm.username}}</FormItem>\r\n                <FormItem label=\"用户头像：\">\r\n                  <upload-pic-thumb v-model=\"userForm.avatar\" :multiple=\"false\"></upload-pic-thumb>\r\n                </FormItem>\r\n                <FormItem label=\"用户名：\" prop=\"nickname\">\r\n                  <Input v-model=\"userForm.nickname\" style=\"width: 300px\" />\r\n                </FormItem>\r\n                <FormItem label=\"性别：\">\r\n                  <RadioGroup v-model=\"userForm.sex\">\r\n                    <Radio v-for=\"(item, i) in dictSex\" :key=\"i\" :label=\"item.value\">{{item.title}}</Radio>\r\n                  </RadioGroup>\r\n                </FormItem>\r\n                <FormItem label=\"生日：\">\r\n                  <DatePicker\r\n                    v-model=\"userForm.birth\"\r\n                    @on-change=\"changeBirth\"\r\n                    style=\"width: 300px\"\r\n                    type=\"date\"\r\n                  ></DatePicker>\r\n                </FormItem>\r\n                <FormItem label=\"所在省市：\">\r\n                  <al-cascader\r\n                    v-model=\"userForm.addressArray\"\r\n                    @on-change=\"changeAddress\"\r\n                    data-type=\"code\"\r\n                    level=\"2\"\r\n                    style=\"width: 300px\"\r\n                  />\r\n                </FormItem>\r\n                <FormItem label=\"街道地址：\" prop=\"street\">\r\n                  <Input v-model=\"userForm.street\" style=\"width: 300px\" />\r\n                </FormItem>\r\n                <FormItem label=\"个人简介：\" prop=\"description\">\r\n                  <Input\r\n                    v-model=\"userForm.description\"\r\n                    type=\"textarea\"\r\n                    style=\"width: 300px\"\r\n                    :autosize=\"{minRows: 3,maxRows: 5}\"\r\n                    placeholder=\"个人简介\"\r\n                  ></Input>\r\n                </FormItem>\r\n                <FormItem label=\"所属部门：\">\r\n                  <span>{{ userForm.departmentTitle }}</span>\r\n                </FormItem>\r\n                <FormItem label=\"用户类型：\">\r\n                  <span>{{ userForm.typeTxt }}</span>\r\n                </FormItem>\r\n                <FormItem>\r\n                  <Button\r\n                    type=\"primary\"\r\n                    style=\"width: 100px;margin-right:5px\"\r\n                    :loading=\"saveLoading\"\r\n                    @click=\"saveEdit\"\r\n                  >保存</Button>\r\n                </FormItem>\r\n              </Form>\r\n            </div>\r\n            <div v-show=\"currMenu=='安全设置'\" class=\"safe\">\r\n              <div class=\"item\">\r\n                <div>\r\n                  <div class=\"title\">账户密码</div>\r\n                  <div v-if=\"userForm.passStrength\" class=\"desc\">\r\n                    当前密码强度：\r\n                    <span\r\n                      v-if=\"userForm.passStrength=='弱'\"\r\n                      class=\"red\"\r\n                    >{{userForm.passStrength}}</span>\r\n                    <span v-if=\"userForm.passStrength=='中'\" class=\"middle\">{{userForm.passStrength}}</span>\r\n                    <span v-if=\"userForm.passStrength=='强'\" class=\"green\">{{userForm.passStrength}}</span>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a @click=\"changePass\">修改</a>\r\n                </div>\r\n              </div>\r\n              <div class=\"item\">\r\n                <div>\r\n                  <div class=\"title\">绑定手机</div>\r\n                  <div class=\"desc\">\r\n                    <span v-if=\"userForm.mobile\">已绑定手机：{{userForm.mobile}}</span>\r\n                    <span v-else>未绑定手机号</span>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a @click=\"showChangeMobile\">修改</a>\r\n                </div>\r\n              </div>\r\n              <div class=\"item\">\r\n                <div>\r\n                  <div class=\"title\">绑定邮箱</div>\r\n                  <div class=\"desc\">\r\n                    <span v-if=\"userForm.email\">已绑定邮箱：{{userForm.email}}</span>\r\n                    <span v-else>未绑定邮箱</span>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a @click=\"showChangeEmail\">修改</a>\r\n                </div>\r\n              </div>\r\n              <div class=\"item\">\r\n                <div>\r\n                  <div class=\"title\">密保问题</div>\r\n                  <div class=\"desc\">未设置密保问题，密保问题可有效保护账户安全</div>\r\n                </div>\r\n                <div>\r\n                  <a>暂不支持设置</a>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div v-show=\"currMenu=='第三方账号绑定'\" class=\"safe\">\r\n              <div class=\"item\">\r\n                <div style=\"display:flex;align-items:center\">\r\n                  <Icon type=\"logo-github\" size=\"42\" color=\"#181617\" style=\"margin-right: 16px;\" />\r\n                  <div>\r\n                    <div class=\"title\">Github</div>\r\n                    <div class=\"desc\">\r\n                      <span v-if=\"relate.github\">已绑定Github账号：{{relate.githubUsername}}</span>\r\n                      <span v-else>当前未绑定Github账号</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a v-if=\"!relate.github\" @click=\"toRelateGithub()\">立即绑定</a>\r\n                  <a v-else @click=\"unRelateGithub()\">解除绑定</a>\r\n                </div>\r\n              </div>\r\n              <div class=\"item\">\r\n                <div style=\"display:flex;align-items:center\">\r\n                  <img src=\"@/assets/QQ.png\" width=\"42px\" style=\"margin-right: 16px\"/>\r\n                  <div>\r\n                    <div class=\"title\">QQ</div>\r\n                    <div class=\"desc\">\r\n                      <span v-if=\"relate.qq\">已绑定QQ账号：{{relate.qqUsername}}</span>\r\n                      <span v-else>当前未绑定QQ账号</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a v-if=\"!relate.qq\" @click=\"toRelateQQ()\">立即绑定</a>\r\n                  <a v-else @click=\"unRelateQQ()\">解除绑定</a>\r\n                </div>\r\n              </div>\r\n              <div class=\"item\">\r\n                <div style=\"display:flex;align-items:center\">\r\n                  <icon name=\"brands/weixin\" scale=\"2.5\" style=\"margin: 0 16px 0 2px;color:#60c126\"></icon>\r\n                  <div>\r\n                    <div class=\"title\">微信</div>\r\n                    <div class=\"desc\">\r\n                      <span v-if=\"relate.wechat\">已绑定微信账号：{{relate.wechatUsername}}</span>\r\n                      <span v-else>当前未绑定微信账号</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a v-if=\"!relate.wechat\" @click=\"toRelateWechat()\">立即绑定</a>\r\n                  <a v-else @click=\"unRelateWechat()\">解除绑定</a>\r\n                </div>\r\n              </div>\r\n              <div class=\"item\">\r\n                <div style=\"display:flex;align-items:center\">\r\n                  <img src=\"@/assets/weibo.png\" width=\"41px\" style=\"margin-right: 16px\"/>\r\n                  <div>\r\n                    <div class=\"title\">微博</div>\r\n                    <div class=\"desc\">\r\n                      <span v-if=\"relate.weibo\">已绑定微博账号：{{relate.weiboUsername}}</span>\r\n                      <span v-else>当前未绑定微博账号</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <a v-if=\"!relate.weibo\" @click=\"toRelateWeibo()\">立即绑定</a>\r\n                  <a v-else @click=\"unRelateWeibo()\">解除绑定</a>\r\n                </div>\r\n              </div>\r\n              <Spin fix v-if=\"jumping\">跳转中...</Spin>\r\n            </div>\r\n            <div v-show=\"currMenu=='消息通知'\" class=\"safe\">\r\n              <div class=\"item\">\r\n                <div>\r\n                  <div class=\"title\">系统消息</div>\r\n                  <div class=\"desc\">系统消息将以站内信的形式通知</div>\r\n                </div>\r\n                <div>\r\n                  <i-switch\r\n                    v-model=\"messageOpen\"\r\n                    @on-change=\"changeMessage\"\r\n                    :true-value=\"1\"\r\n                    :false-value=\"0\"\r\n                  >\r\n                    <span slot=\"open\">开</span>\r\n                    <span slot=\"close\">关</span>\r\n                  </i-switch>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n\r\n    <Modal\r\n      title=\"修改手机号\"\r\n      v-model=\"editMobileVisible\"\r\n      :closable=\"false\"\r\n      :mask-closable=\"false\"\r\n      :width=\"500\"\r\n    >\r\n      <Form\r\n        ref=\"mobileEditForm\"\r\n        :model=\"mobileEditForm\"\r\n        :label-width=\"70\"\r\n        :rules=\"mobileEditValidate\"\r\n      >\r\n        <FormItem label=\"手机号\" prop=\"mobile\">\r\n          <Input v-model=\"mobileEditForm.mobile\" @on-change=\"hasChangePhone\" placeholder=\"请输入新手机号\" />\r\n        </FormItem>\r\n        <FormItem label=\"验证码\" prop=\"code\" :error=\"codeError\">\r\n          <Row type=\"flex\" justify=\"space-between\">\r\n            <Input v-model=\"mobileEditForm.code\" placeholder=\"请输入您收到的短信验证码\" style=\"width:280px;\" />\r\n            <CountDownButton\r\n              ref=\"countDownMobile\"\r\n              @on-click=\"sendEditMobileCode\"\r\n              :disabled=\"canSendMobileCode\"\r\n              :autoCountDown=\"false\"\r\n              :loading=\"sending\"\r\n              :text=\"getSms\"\r\n            />\r\n          </Row>\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelInputCodeBox\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"checkCodeLoading\" @click=\"submitEditMobile\">提交</Button>\r\n      </div>\r\n    </Modal>\r\n\r\n    <Modal\r\n      title=\"修改邮箱\"\r\n      v-model=\"editEmailVisible\"\r\n      :closable=\"false\"\r\n      :mask-closable=\"false\"\r\n      :width=\"500\"\r\n    >\r\n      <Form\r\n        ref=\"emailEditForm\"\r\n        :model=\"emailEditForm\"\r\n        :label-width=\"100\"\r\n        :rules=\"emailEditValidate\"\r\n      >\r\n        <FormItem label=\"新邮箱地址\" prop=\"email\">\r\n          <Input v-model=\"emailEditForm.email\" @on-change=\"hasChangeEmail\" placeholder=\"请输入新邮箱地址\"></Input>\r\n        </FormItem>\r\n        <FormItem label=\"验证码\" prop=\"code\" :error=\"codeError\">\r\n          <Row type=\"flex\" justify=\"space-between\">\r\n            <Input v-model=\"emailEditForm.code\" placeholder=\"请输入您收到的邮件中的验证码\" style=\"width:250px;\" />\r\n            <CountDownButton\r\n              ref=\"countDownEmail\"\r\n              @on-click=\"sendVerifyEmail\"\r\n              :disabled=\"canSendEditEmail\"\r\n              :autoCountDown=\"false\"\r\n              :loading=\"sending\"\r\n              :text=\"getSms\"\r\n            />\r\n          </Row>\r\n        </FormItem>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelEditEmail\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"editEmailLoading\" @click=\"submitEditEmail\">提交</Button>\r\n      </div>\r\n    </Modal>\r\n\r\n    <check-password ref=\"checkPassMobile\" @on-success=\"checkSuccessMobile\" />\r\n\r\n    <check-password ref=\"checkPassEmail\" @on-success=\"checkSuccessEmail\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  userInfo,\r\n  userInfoEdit,\r\n  relatedInfo,\r\n  unRelate,\r\n  githubLogin,\r\n  qqLogin,\r\n  weiboLogin,\r\n  wechatLogin,\r\n  sendEditEmail,\r\n  editEmail,\r\n  sendEditMobileSms,\r\n  changeMobile\r\n} from \"@/api/index\";\r\nimport { validateMobile } from \"@/libs/validate\";\r\nimport CountDownButton from \"@/views/my-components/xboot/count-down-button\";\r\nimport uploadPicThumb from \"@/views/my-components/xboot/upload-pic-thumb\";\r\nimport checkPassword from \"@/views/my-components/xboot/check-password\";\r\nimport Cookies from \"js-cookie\";\r\nimport messageVue from \"../message/message.vue\";\r\nexport default {\r\n  components: {\r\n    uploadPicThumb,\r\n    checkPassword,\r\n    CountDownButton\r\n  },\r\n  name: \"ownspace_index\",\r\n  data() {\r\n    return {\r\n      activeName: \"基本信息\",\r\n      area: 86,\r\n      messageOpen: 1,\r\n      userForm: {\r\n        id: \"\",\r\n        avatar: \"\",\r\n        username: \"\",\r\n        sex: \"\",\r\n        mobile: \"\",\r\n        email: \"\",\r\n        status: \"\",\r\n        type: \"\",\r\n        typeTxt: \"\",\r\n        address: \"\",\r\n        addressArray: []\r\n      },\r\n      mobileEditForm: {\r\n        mobile: \"\",\r\n        code: \"\"\r\n      },\r\n      emailEditForm: {\r\n        email: \"\",\r\n        code: \"\"\r\n      },\r\n      codeError: \"\",\r\n      initPhone: \"\",\r\n      initEmail: \"\",\r\n      saveLoading: false,\r\n      sending: false,\r\n      getSms: \"获取验证码\",\r\n      canSendMobileCode: true, // 是否可点获取验证码\r\n      checkCodeLoading: false,\r\n      checkPassLoading: false,\r\n      editEmailLoading: false,\r\n      mobileEditValidate: {\r\n        mobile: [\r\n          { required: true, message: \"请输入手机号码\" },\r\n          { validator: validateMobile }\r\n        ]\r\n      },\r\n      emailEditValidate: {\r\n        email: [\r\n          { required: true, message: \"请输入邮箱地址\" },\r\n          { type: \"email\", message: \"邮箱格式不正确\" }\r\n        ]\r\n      },\r\n      editMobileVisible: false, // 显示填写验证码box\r\n      editEmailVisible: false,\r\n      canSendEditEmail: true,\r\n      relate: {},\r\n      jumping: false,\r\n      currMenu: \"基本信息\",\r\n      dictSex: this.$store.state.dict.sex\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      let v = JSON.parse(Cookies.get(\"userInfo\"));\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] == null) {\r\n          v[attr] = \"\";\r\n        }\r\n      }\r\n      let str = JSON.stringify(v);\r\n      let userInfo = JSON.parse(str);\r\n      userInfo.addressArray = [];\r\n      this.userForm = userInfo;\r\n      this.initPhone = userInfo.mobile;\r\n      this.mobileEditForm.mobile = userInfo.mobile;\r\n      this.initEmail = userInfo.email;\r\n      this.emailEditForm.email = userInfo.email;\r\n      if (userInfo.address) {\r\n        this.userForm.address = userInfo.address;\r\n        this.userForm.addressArray = JSON.parse(userInfo.address);\r\n      }\r\n      if (this.userForm.type == 0) {\r\n        this.userForm.typeTxt = \"普通用户\";\r\n      } else if (this.userForm.type == 1) {\r\n        this.userForm.typeTxt = \"管理员\";\r\n      }\r\n      relatedInfo(userInfo.username).then(res => {\r\n        if (res.success) {\r\n          this.relate = res.result;\r\n        } else {\r\n          this.$Message.error(\"加载绑定第三方账号信息失败\");\r\n        }\r\n      });\r\n      let messageOpen = this.getStore(\"messageOpen\");\r\n      if (\r\n        messageOpen != \"\" &&\r\n        messageOpen != undefined &&\r\n        messageOpen != null\r\n      ) {\r\n        this.messageOpen = Number(messageOpen);\r\n      } else {\r\n        this.setStore(\"messageOpen\", 1);\r\n      }\r\n    },\r\n    changePass() {\r\n      this.$router.push({\r\n        name: \"change_pass\"\r\n      });\r\n    },\r\n    changeMenu(v) {\r\n      this.currMenu = v;\r\n    },\r\n    toRelateGithub() {\r\n      this.jumping = true;\r\n      githubLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.jumping = false;\r\n        }\r\n      });\r\n    },\r\n    toRelateQQ() {\r\n      this.jumping = true;\r\n      qqLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.jumping = false;\r\n        }\r\n      });\r\n    },\r\n    toRelateWeibo() {\r\n      this.jumping = true;\r\n      weiboLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.jumping = false;\r\n        }\r\n      });\r\n    },\r\n    toRelateWechat() {\r\n      this.jumping = true;\r\n      wechatLogin().then(res => {\r\n        if (res.success) {\r\n          window.location.href = res.result;\r\n        } else {\r\n          this.jumping = false;\r\n        }\r\n      });\r\n    },\r\n    unRelateGithub() {\r\n      this.$Modal.confirm({\r\n        title: \"确认解绑Github账号\",\r\n        content: \"您确认要解除绑定 \" + this.relate.githubUsername + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let params = {\r\n            ids: [this.relate.githubId]\r\n          };\r\n          unRelate(params).then(res => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.relate.github = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    unRelateQQ() {\r\n      this.$Modal.confirm({\r\n        title: \"确认解绑QQ账号\",\r\n        content: \"您确认要解除绑定 \" + this.relate.qqUsername + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let params = {\r\n            ids: [this.relate.qqId]\r\n          };\r\n          unRelate(params).then(res => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.relate.qq = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    unRelateWeibo() {\r\n      this.$Modal.confirm({\r\n        title: \"确认解绑微博账号\",\r\n        content: \"您确认要解除绑定 \" + this.relate.weiboUsername + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let params = {\r\n            ids: [this.relate.weiboId]\r\n          };\r\n          unRelate(params).then(res => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.relate.weibo = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    unRelateWechat() {\r\n      this.$Modal.confirm({\r\n        title: \"确认解绑微信账号\",\r\n        content: \"您确认要解除绑定 \" + this.relate.wechatUsername + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let params = {\r\n            ids: [this.relate.wechatId]\r\n          };\r\n          unRelate(params).then(res => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.relate.wechat = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    showChangeMobile() {\r\n      this.$refs.checkPassMobile.show();\r\n    },\r\n    checkSuccessMobile() {\r\n      this.editMobileVisible = true;\r\n    },\r\n    showChangeEmail() {\r\n      this.$refs.checkPassEmail.show();\r\n    },\r\n    checkSuccessEmail() {\r\n      this.editEmailVisible = true;\r\n    },\r\n    saveEdit() {\r\n      this.saveLoading = true;\r\n      if (typeof this.userForm.birth == \"object\") {\r\n        this.userForm.birth = this.format(this.userForm.birth, \"yyyy-MM-dd\");\r\n      }\r\n      delete this.userForm.roles;\r\n      userInfoEdit(this.userForm).then(res => {\r\n        this.saveLoading = false;\r\n        if (res.success) {\r\n          this.$Message.success(\"保存成功\");\r\n          // 更新用户信息\r\n          Cookies.set(\"userInfo\", this.userForm);\r\n          // 更新头像\r\n          this.$store.commit(\"setAvatarPath\", this.userForm.avatar);\r\n        }\r\n      });\r\n    },\r\n    changeAddress() {\r\n      this.userForm.address = JSON.stringify(this.userForm.addressArray);\r\n    },\r\n    changeBirth(v) {\r\n      this.userForm.birth = v;\r\n    },\r\n    cancelInputCodeBox() {\r\n      this.editMobileVisible = false;\r\n      this.userForm.mobile = this.initPhone;\r\n    },\r\n    cancelEditEmail() {\r\n      this.editEmailVisible = false;\r\n      this.emailEditForm.email = this.initEmail;\r\n    },\r\n    sendEditMobileCode() {\r\n      this.$refs[\"mobileEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          this.getSms = \"发送中\";\r\n          this.sending = true;\r\n          sendEditMobileSms(this.mobileEditForm.mobile).then(res => {\r\n            this.getSms = \"获取验证码\";\r\n            this.sending = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"发送短信验证码成功\");\r\n              // 开始倒计时\r\n              this.$refs.countDownMobile.startCountDown();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    submitEditMobile() {\r\n      this.$refs[\"mobileEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          if (!this.mobileEditForm.code) {\r\n            this.codeError = \"请填写短信验证码\";\r\n            return;\r\n          } else {\r\n            this.codeError = \"\";\r\n          }\r\n          this.checkCodeLoading = true;\r\n          changeMobile(this.mobileEditForm).then(res => {\r\n            this.checkCodeLoading = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"修改成功\");\r\n              this.userForm.mobile = this.mobileEditForm.mobile;\r\n              this.initPhone = this.mobileEditForm.mobile;\r\n              this.updateUserInfo();\r\n              this.editMobileVisible = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    hasChangePhone() {\r\n      if (this.mobileEditForm.mobile == this.initPhone) {\r\n        this.canSendMobileCode = true;\r\n      } else {\r\n        this.$refs[\"mobileEditForm\"].validate(valid => {\r\n          if (valid) {\r\n            this.canSendMobileCode = false;\r\n          } else {\r\n            this.canSendMobileCode = true;\r\n          }\r\n        });\r\n      }\r\n    },\r\n    hasChangeEmail() {\r\n      if (this.emailEditForm.email == this.initEmail) {\r\n        this.canSendEditEmail = true;\r\n      } else {\r\n        this.canSendEditEmail = false;\r\n      }\r\n    },\r\n    sendVerifyEmail() {\r\n      this.$refs[\"emailEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          this.getSms = \"发送中\";\r\n          this.sending = true;\r\n          sendEditEmail(this.emailEditForm.email).then(res => {\r\n            this.getSms = \"获取验证码\";\r\n            this.sending = false;\r\n            if (res.success) {\r\n              this.$Message.success(\"发送邮件验证码成功，请注意查收\");\r\n              // 开始倒计时\r\n              this.$refs.countDownEmail.startCountDown();\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    submitEditEmail() {\r\n      this.$refs[\"emailEditForm\"].validate(valid => {\r\n        if (valid) {\r\n          if (!this.emailEditForm.code) {\r\n            this.codeError = \"验证码不能为空\";\r\n            return;\r\n          } else {\r\n            this.codeError = \"\";\r\n          }\r\n          this.editEmailLoading = true;\r\n          editEmail(this.emailEditForm).then(res => {\r\n            this.editEmailLoading = false;\r\n            if (res.success) {\r\n              this.initEmail = this.emailEditForm.email;\r\n              this.userForm.email = this.emailEditForm.email;\r\n              this.updateUserInfo();\r\n              this.$Message.success(\"修改邮件成功\");\r\n              this.editEmailVisible = false;\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    updateUserInfo() {\r\n      // 更新用户信息\r\n      userInfo().then(res => {\r\n        if (res.success) {\r\n          // 避免超过大小限制\r\n          delete res.result.permissions;\r\n          if (this.getStore(\"saveLogin\")) {\r\n            // 保存7天\r\n            Cookies.set(\"userInfo\", JSON.stringify(res.result), {\r\n              expires: 7\r\n            });\r\n          } else {\r\n            Cookies.set(\"userInfo\", JSON.stringify(res.result));\r\n          }\r\n          this.setStore(\"userInfo\", res.result);\r\n        }\r\n      });\r\n    },\r\n    changeMessage(v) {\r\n      this.setStore(\"messageOpen\", v);\r\n    }\r\n  },\r\n  mounted() {\r\n    let type = this.$route.query.type;\r\n    if (type == \"social\") {\r\n      this.activeName = \"第三方账号绑定\";\r\n      this.currMenu = \"第三方账号绑定\";\r\n    }\r\n    this.init();\r\n  }\r\n};\r\n</script>\r\n"]}]}