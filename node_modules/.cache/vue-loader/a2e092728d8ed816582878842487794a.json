{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\sys\\out-call\\callTask.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\sys\\out-call\\callTask.vue","mtime":1614579763381},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi8vIOW7uuiuruW8leWFpemAmueUqOagt+W8jyDlhbfkvZPot6/lvoToh6rooYzkv67mlLkg5Y+v5Yig6Zmk5LiL6Z2i5qC35byP5Luj56CBDQpAaW1wb3J0ICIuLi8uLi8uLi9zdHlsZXMvdGFibGUtY29tbW9uLmxlc3MiOw0KLnNlYXJjaCB7DQogIC5vcGVyYXRpb24gew0KICAgIG1hcmdpbi1ib3R0b206IDJ2aDsNCiAgfQ0KICAuc2VsZWN0LWNvdW50IHsNCiAgICBmb250LXdlaWdodDogNjAwOw0KICAgIGNvbG9yOiAjNDBhOWZmOw0KICB9DQogIC5zZWxlY3QtY2xlYXIgew0KICAgIG1hcmdpbi1sZWZ0OiAxMHB4Ow0KICB9DQogIC5wYWdlIHsNCiAgICBtYXJnaW4tdG9wOiAydmg7DQogIH0NCiAgLmRyb3AtZG93biB7DQogICAgbWFyZ2luLWxlZnQ6IDVweDsNCiAgfQ0KfQ0K"},{"version":3,"sources":["callTask.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAisBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"callTask.vue","sourceRoot":"src/views/sys/out-call","sourcesContent":["<template>\r\n  <div class=\"search\">\r\n    <Card v-show=\"currView=='index'\">\r\n      <Row class=\"operation\">\r\n        <Button @click=\"addTask\" type=\"primary\" icon=\"md-add\">新增任务</Button>\r\n        <Button @click=\"getResultAll('1','','1')\"  type=\"primary\" icon=\"md-add\">配置公共营销结果</Button>\r\n        <Button @click=\"getDataList\" icon=\"md-refresh\">刷新</Button>\r\n        <!-- <Button type=\"dashed\" @click=\"openTip=!openTip\">{{openTip ? \"关闭提示\" : \"开启提示\"}}</Button> -->\r\n      </Row>\r\n      <Row v-show=\"openTip && selectCount > 0\">\r\n        <Alert show-icon>\r\n          已选择\r\n          <span class=\"select-count\">{{selectCount}}</span> 项\r\n          <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n        </Alert>\r\n      </Row>\r\n      <Row>\r\n        <Table\r\n          :loading=\"loading\"\r\n          border\r\n          :columns=\"columns\"\r\n          :data=\"data\"\r\n          ref=\"table\"\r\n          sortable=\"custom\"\r\n          @on-sort-change=\"changeSort\"\r\n          @on-selection-change=\"changeSelect\"\r\n        ></Table>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n        <Page\r\n          :current=\"searchForm.pageNumber\"\r\n          :total=\"total\"\r\n          :page-size=\"searchForm.pageSize\"\r\n          @on-change=\"changePage\"\r\n          @on-page-size-change=\"changePageSize\"\r\n          :page-size-opts=\"[10,20,50]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n        ></Page>\r\n      </Row>\r\n    </Card>\r\n\r\n    <!-- 编辑 -->\r\n    <Modal :title=\"modalTitle\" v-model=\"taskModalVisible\" :mask-closable=\"false\" :width=\"700\">\r\n      <Form ref=\"taskForm\" :model=\"taskForm\" :label-width=\"100\" :rules=\"taskFormValidate\">\r\n          <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"任务名称\" prop=\"taskName\">\r\n                <Input v-model=\"taskForm.taskName\"  />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"最大通道数\" prop=\"maxChannel\">\r\n                <Input v-model=\"taskForm.maxChannel\"  />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"开始日期\" prop=\"startTime\">\r\n                <DatePicker  type=\"datetime\" style=\"width:217px\" placeholder=\"请选择\" v-model=\"taskForm.startTime\"></DatePicker>\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"完成日期\" prop=\"endTime\">\r\n                <DatePicker type=\"datetime\" style=\"width:217px\" placeholder=\"请选择\" v-model=\"taskForm.endTime\"></DatePicker>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"免呼组\" prop=\"blackGroupId\">\r\n                <Select v-model=\"taskForm.blackGroupId\" placeholder=\"请选择\">\r\n                  <Option\r\n                    v-for=\"(item, index) in blackListItems\"\r\n                    :key=\"index\"\r\n                    :value=\"item.id\"\r\n                    >{{ item.name }}</Option\r\n                  >\r\n                </Select>\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"中继组\" prop=\"relayGroupId\">\r\n                <Select v-model=\"taskForm.relayGroupId\" @on-change=\"getRelayPhoneAll()\" placeholder=\"请选择\">\r\n                  <Option\r\n                    v-for=\"(item, index) in relayGroupListItems\"\r\n                    :key=\"index\"\r\n                    :value=\"item.id\"\r\n                    >{{ item.relayGroupName }}</Option\r\n                  >\r\n                </Select>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"主叫号码规则\" prop=\"relayPhoneMode\">\r\n                 <Select v-model=\"taskForm.relayPhoneMode\" @on-change=\"getRelayPhoneAllDisabled()\" placeholder=\"请选择\">\r\n                  <Option value=\"0\">顺序分配</Option>\r\n                  <Option value=\"1\">随机分配</Option>\r\n                  <Option value=\"2\">指定号码</Option>\r\n                </Select>\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"主叫号码\" prop=\"relayPhoneId\">\r\n                <Select v-model=\"taskForm.relayPhoneId\" :disabled=\"selectPhone\" placeholder=\"请选择\">\r\n                  <Option\r\n                    v-for=\"(item, index) in relayPhoneListItems\"\r\n                    :key=\"index\"\r\n                    :value=\"item.id\"\r\n                    >{{ item.relayPhoneNumber }}</Option\r\n                  >\r\n                </Select>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n         <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"时间组\" prop=\"workTimeGroupId\">\r\n                <Select v-model=\"taskForm.workTimeGroupId\" placeholder=\"请选择\">\r\n                  <Option\r\n                    v-for=\"(item, index) in WorkTimeListItems\"\r\n                    :key=\"index\"\r\n                    :value=\"item.id\"\r\n                    >{{ item.name }}</Option\r\n                  >\r\n                </Select>\r\n              </FormItem>\r\n            </Col>\r\n            \r\n          </Row>\r\n          <Row :gutter=\"32\">\r\n            <Col span=\"32\">\r\n              <FormItem label=\"备注\" prop=\"remark\">\r\n                 <Input type=\"textarea\" v-model=\"taskForm.remark\" :rows=\"4\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row :gutter=\"64\">\r\n            <Col span=\"64\">\r\n              <FormItem label=\"营销结果配置\" prop=\"startTime\">\r\n                  <table id=\"table\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th :width=\"100\">名称</th>\r\n                      <th :width=\"100\">备注</th>\r\n                      <th :width=\"100\">是否成功标识</th>\r\n                      <th><Button  @click=\"insertResult\" :width=\"200\" type=\"primary\" icon=\"md-add\"></Button></th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    <tr v-for=\"(item, index) in queryResultListItems\" :key=\"index\">\r\n                      <td :width=\"100\" style=\"text-align: center\">\r\n                        <input prop=\"fullName\" v-model=\"item.fullName\"  />\r\n                        <!-- <input v-model=\"item.id\" v-show=\"false\" value=\"item.id\" /> -->\r\n                      </td>\r\n                      <td :width=\"100\" style=\"text-align: center\">\r\n                        <input v-model=\"item.remark\" />\r\n                      </td>\r\n                      <td :width=\"100\" style=\"text-align: center\">\r\n                        <input type=\"checkbox\" v-model=\"item.successFlag\" />\r\n                      </td>\r\n                      <td><Button   @click=\"removeResult(index)\" type=\"primary\" icon=\"md-remove\"></Button></td>\r\n                    </tr>\r\n                  </tbody>\r\n                </table>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n        \r\n        \r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelTask\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitTask\">提交</Button>\r\n      </div>\r\n    </Modal>\r\n\r\n    <Modal :title=\"resultTitle\" v-model=\"resultModalVisible\" :mask-closable=\"false\" :width=\"500\">\r\n       <Form ref=\"resultForm\" :model=\"resultForm\" :label-width=\"200\" :rules=\"resultValidate\">\r\n        <table id=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th :width=\"100\">名称</th>\r\n              <th :width=\"100\">备注</th>\r\n              <th :width=\"100\">是否成功标识</th>\r\n              <th><Button  @click=\"insertResult\" :width=\"200\" type=\"primary\" icon=\"md-add\"></Button></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"(item, index) in queryResultListItems\" :key=\"index\">\r\n              <td :width=\"100\" style=\"text-align: center\">\r\n                <input prop=\"fullName\" v-model=\"item.fullName\"  />\r\n                <!-- <input v-model=\"item.id\" v-show=\"false\" value=\"item.id\" /> -->\r\n              </td>\r\n              <td :width=\"100\" style=\"text-align: center\">\r\n                <input v-model=\"item.remark\" />\r\n              </td>\r\n              <td :width=\"100\" style=\"text-align: center\">\r\n                <input type=\"checkbox\" v-model=\"item.successFlag\" />\r\n              </td>\r\n              <td><Button   @click=\"removeResult(index)\" type=\"primary\" icon=\"md-remove\"></Button></td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelResult\">取消</Button>\r\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitResult\">提交</Button>\r\n      </div>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 根据你的实际请求api.js位置路径修改\r\nimport {\r\n  getCtiList,\r\n  deleteCti,\r\n  editCti,\r\n  addCti,\r\n  getResultAllLists,\r\n  insertMarketingResult,\r\n  getBlackListGroups,   //获取黑名单组\r\n  getWorktimeGroups,    //获取时间组\r\n  getRelayGroupList,    //获取中继组\r\n  getRelayPhoneList,     //获取中继号码\r\n  insertCallTask\r\n} from \"@/api/index\";\r\nexport default {\r\n  name: \"task-manage\",\r\n  data() {\r\n    return {\r\n      openTip: false, // 显示提示\r\n      showTask: false, // 显示租户窗口\r\n      formData: {},\r\n      currView: \"index\",\r\n      loading: true, // 表单加载状态\r\n      modalTitle: \"\",\r\n      modalType: 0,\r\n      taskModalVisible: false,\r\n      blackListItems:[],\r\n      WorkTimeListItems:[],\r\n      relayGroupListItems:[],\r\n      relayPhoneListItems:[],\r\n      selectPhone:true,\r\n      searchForm: {\r\n        // 搜索框初始化对象\r\n        pageNumber: 1, // 当前页数\r\n        pageSize: 10, // 页面大小\r\n        sort: \"createTime\", // 默认排序字段\r\n        order: \"desc\", // 默认排序方式\r\n      },\r\n      taskForm: {\r\n        taskName: \"\",\r\n        maxChannel: \"\",\r\n        startTime: \"\",\r\n        endTime: \"\"\r\n      },\r\n      taskFormValidate: {\r\n        taskName: [{ required: true, message: \"任务名称不能为空\", trigger: \"blur\" }],\r\n        // maxChannel: [{ required: true, message: \"最大通道数不能为空\", trigger: \"blur\" }],\r\n        // startTime: [{ required: true, message: \"开始时间不能为空\", trigger: \"change\" }],\r\n        // endTime: [{ required: true, message: \"结束时间不能为空\", trigger: \"change\" }]\r\n      },\r\n\r\n      resultTitle:\"\",\r\n      resultModalVisible:false,\r\n      resultForm:{},\r\n      queryResultListItems:[],\r\n      resultValidate:{\r\n         fullName: [{ required: true, message: \"名称不能为空\", trigger: \"blur\" }]\r\n      },\r\n      resultParams:{},\r\n\r\n      selectList: [], // 多选数据\r\n      selectCount: 0, // 多选计数\r\n      columns: [\r\n        // 表头\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          title: \"CTI名称\",\r\n          key: \"ctiName\",\r\n          minWidth: 220,\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"IP地址\",\r\n          key: \"ctiIp\",\r\n          minWidth: 120,\r\n          sortable: true,\r\n        },\r\n        {\r\n          title: \"端口地址\",\r\n          key: \"ctiPort\",\r\n          width: 140,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          title: \"组Id\",\r\n          key: \"ctiGroup\",\r\n          minWidth: 210,\r\n          sortable: false,\r\n        },\r\n        {\r\n          title: \"节点号\",\r\n          key: \"ctiNode\",\r\n          minWidth: 130,\r\n          sortable: false,\r\n        },\r\n        {\r\n          title: \"备注\",\r\n          key: \"remark\",\r\n          minWidth: 130,\r\n          sortable: false,\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          align: \"center\",\r\n          width: 200,\r\n          fixed: \"right\",\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"primary\",\r\n                    size: \"small\",\r\n                  },\r\n                  style: {\r\n                    marginRight: \"5px\",\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.edit(params.row);\r\n                    },\r\n                  },\r\n                },\r\n                \"编辑\"\r\n              ),\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"error\",\r\n                    size: \"small\",\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.remove(params.row);\r\n                    },\r\n                  },\r\n                },\r\n                \"删除\"\r\n              ),\r\n            ]);\r\n          },\r\n        },\r\n      ],\r\n      data: [], // 表单数据\r\n      pageNumber: 1, // 当前页数\r\n      pageSize: 10, // 页面大小\r\n      total: 0, // 表单数据总数\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getDataList();\r\n    },\r\n    submited() {\r\n      this.currView = \"index\";\r\n      this.getDataList();\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getDataList();\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getDataList();\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order === \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getDataList();\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    changeSelect(e) {\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n      if(this.selectCount > 0){\r\n         this.openTip = true;\r\n      }else{\r\n         this.openTip = false;\r\n      }\r\n    },\r\n    getDataList() {\r\n      this.loading = true;\r\n      getCtiList(this.searchForm).then((res) => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          this.data = res.result.content;\r\n          this.total = res.result.totalElements;\r\n        }\r\n      });\r\n    },\r\n    showDetail(v) {\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] == null) {\r\n          v[attr] = \"\";\r\n        }\r\n      }\r\n      let str = JSON.stringify(v);\r\n      let data = JSON.parse(str);\r\n      this.ctiForm = data;\r\n      this.showCti = true;\r\n    },\r\n    cancelTask() {\r\n      this.taskModalVisible = false;\r\n      this.queryResultListItems = [];\r\n      this.taskForm = {};\r\n    },\r\n    submitTask() {\r\n        var params = {}; \r\n        if(!this.taskForm.taskName){\r\n          this.$Message.warning(\"任务名称不能为空\");\r\n          return;\r\n        }\r\n        if(!this.taskForm.blackGroupId){\r\n          this.$Message.warning(\"免呼组不能为空\");\r\n          return;\r\n        }\r\n        if(!this.taskForm.relayGroupId){\r\n          this.$Message.warning(\"中继组不能为空\");\r\n          return;\r\n        }\r\n        if(!this.taskForm.relayPhoneMode){\r\n          this.$Message.warning(\"主叫号码规则不能为空\");\r\n          return;\r\n        }else{\r\n          if(this.taskForm.relayPhoneMode == 2){\r\n              if(!this.taskForm.relayPhoneId){\r\n                this.$Message.warning(\"主叫号码不能为空\");\r\n                return;\r\n              }\r\n          }\r\n        }\r\n        if(!this.taskForm.workTimeGroupId){\r\n          this.$Message.warning(\"时间组不能为空\");\r\n          return;\r\n        }\r\n        this.taskForm.startTime =  this.dateFormat(this.taskForm.startTime);\r\n        this.taskForm.endTime =  this.dateFormat(this.taskForm.endTime);\r\n        \r\n        params = this.taskForm;\r\n        var result = this.queryResultListItems;\r\n        if(result.length <= 0){\r\n            this.$Message.warning(\"营销结果配置不能为空,至少配置一项\");\r\n            return;\r\n        }else{\r\n          for (var i = 0; i < result.length; i++) {\r\n            if (result[i].fullName == \"\" || result[i].fullName == null) {\r\n              this.$Message.warning(\"营销结果名称不能为空\");\r\n              return;\r\n            }\r\n            if(result[i].successFlag == true){\r\n                result[i].successFlag = 1;\r\n            }\r\n          }\r\n          params[\"list\"] = JSON.stringify(result);\r\n        }\r\n        this.submitLoading = true;\r\n        params[\"taskState\"] = 0;\r\n        params[\"taskType\"] = 1;\r\n        params[\"taskDisplay\"] = 1;\r\n        params[\"maxCallCount\"] = 0;\r\n        params[\"id\"] = 0;\r\n        submitCallTask(params).then(res => {\r\n          this.submitLoading = false;\r\n          if (res.success) {\r\n            this.$Message.success(\"操作成功\");\r\n            this.taskForm = {};\r\n            this.queryResultListItems = [];\r\n            this.taskModalVisible = false;\r\n          }\r\n        });\r\n    },\r\n    dateFormat(dateData) {\r\n      var date = new Date(dateData)\r\n      var y = date.getFullYear()\r\n      var m = date.getMonth() + 1\r\n      m = m < 10 ? ('0' + m) : m\r\n      var d = date.getDate()\r\n      d = d < 10 ? ('0' + d) : d\r\n      const time = y + '-' + m + '-' + d\r\n      return time\r\n    },\r\n    addTask() {\r\n      this.showTask = true;\r\n      this.modalType = 0;\r\n      this.$refs.taskForm.resetFields();\r\n      this.taskForm = [];\r\n      this.taskModalVisible = true;\r\n      this.modalTitle = \"新增任务\";\r\n      this.getResultAll(\"1\",\"\",\"0\");\r\n      this.getBlackAll();\r\n      this.getWorktimetAll();\r\n      this.getRelayGroupAll();\r\n      this.getRelayPhoneAll();\r\n    },\r\n    edit(v) {\r\n      // 转换null为\"\"\r\n      for (let attr in v) {\r\n        if (v[attr] == null) {\r\n          v[attr] = \"\";\r\n        }\r\n      }\r\n      this.modalType = 1;\r\n      this.ctiModalVisible = true;\r\n      this.modalTitle = \"编辑Cti\";\r\n      this.$refs.ctiForm.resetFields();\r\n      let str = JSON.stringify(v);\r\n      let data = JSON.parse(str);\r\n      delete data[\"children\"];\r\n      this.ctiForm = data;\r\n      this.showCti = true;\r\n    },\r\n    remove(v) {\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        // 记得确认修改此处\r\n        content: \"您确认要删除 \" + v.ctiName + \" ?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          // 删除\r\n          deleteCti({ ids: v.id }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.getDataList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    delAll() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要删除的数据\");\r\n        return;\r\n      }\r\n      this.$Modal.confirm({\r\n        title: \"确认删除\",\r\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\r\n        loading: true,\r\n        onOk: () => {\r\n          let ids = \"\";\r\n          this.selectList.forEach(function (e) {\r\n            ids += e.id + \",\";\r\n          });\r\n          ids = ids.substring(0, ids.length - 1);\r\n          // 批量删除\r\n          deleteCti({ ids: ids }).then((res) => {\r\n            this.$Modal.remove();\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.clearSelectAll();\r\n              this.getDataList();\r\n            }\r\n          });\r\n        },\r\n      });\r\n    },\r\n    showPic(v) {\r\n      let image = new Image();\r\n      image.src = v.logo;\r\n      let viewer = new Viewer(image, {\r\n        hidden: function() {\r\n          viewer.destroy();\r\n        }\r\n      });\r\n      viewer.show();\r\n    },\r\n    cancelResult(){\r\n       this.queryResultListItems = [];\r\n       this.resultModalVisible = false;\r\n    },\r\n    removeResult(index) {\r\n      this.queryResultListItems.splice(index, 1);\r\n    },\r\n    insertResult() {\r\n      this.queryResultListItems.push({successFlag:0,id:\"\",fullName:\"\",remark:\"\"});\r\n    },\r\n    getResultAll(isPublic,taskId,type) {\r\n      this.resultParams[\"isPublic\"] = isPublic;\r\n      this.resultParams[\"taskId\"] = taskId;\r\n      getResultAllLists({isPublic:isPublic,taskId:taskId}).then((res) => {\r\n        if (res.success) {\r\n          if(1==type){\r\n            this.resultModalVisible = true;\r\n            this.resultTitle = \"配置营销结果\";\r\n          }\r\n          this.queryResultListItems = res.result.list;\r\n        }\r\n      });\r\n    },\r\n    submitResult() {\r\n      if(this.queryResultListItems!=null && this.queryResultListItems!=''){\r\n        var result = this.queryResultListItems;\r\n        for (var i = 0; i < result.length; i++) {\r\n          if (result[i].fullName == \"\" || result[i].fullName == null) {\r\n            this.$Message.warning(\"名称不能为空\");\r\n            return;\r\n          }\r\n          if(result[i].successFlag == true){\r\n              result[i].successFlag = 1;\r\n          }\r\n        }\r\n        this.resultParams[\"list\"] = JSON.stringify(result);\r\n        insertMarketingResult(this.resultParams).then(res => {\r\n          this.submitLoading = false;\r\n          if (res.success) {\r\n            this.$Message.success(\"操作成功\");\r\n            this.queryResultListItems = [];\r\n            this.resultParams = [];\r\n            this.resultModalVisible = false;\r\n          }\r\n        });\r\n      }else{\r\n         this.queryResultListItems = [];\r\n         this.resultParams = [];\r\n         this.resultModalVisible = false;\r\n      }\r\n    },\r\n    getBlackAll() {  //获取黑名单组\r\n      getBlackListGroups({}).then((res) => {\r\n        if (res.success) {\r\n          this.blackListItems = res.result;\r\n        }\r\n      });\r\n    },\r\n    getWorktimetAll() {  //获取时间组\r\n      getWorktimeGroups({}).then((res) => {\r\n        if (res.success) {\r\n          this.WorkTimeListItems = res.result;\r\n        }\r\n      });\r\n    },\r\n    getRelayGroupAll() { //获取中继组\r\n      getRelayGroupList({}).then((res) => {\r\n        if (res.success) {\r\n          this.relayGroupListItems = res.result.list;\r\n        }\r\n      });\r\n    },\r\n    getRelayPhoneAll() { //获取中继号码\r\n      var relayGroupId = \"\";\r\n      if(this.taskForm.relayGroupId){\r\n          relayGroupId = this.taskForm.relayGroupId;\r\n      }\r\n      getRelayPhoneList({blackMark:1,workMode:1,relayGroupId:relayGroupId}).then((res) => {\r\n        if (res.success) {\r\n          this.relayPhoneListItems = [];\r\n          this.relayPhoneListItems = res.result.list;\r\n        }\r\n      });\r\n    },\r\n    getRelayPhoneAllDisabled() { //获取中继号码\r\n      if(this.taskForm.relayPhoneMode == 2){\r\n        this.selectPhone = false;\r\n      }else{\r\n        this.selectPhone = true;\r\n      }\r\n      getRelayPhoneList({blackMark:1,workMode:1,relayGroupId:\"\"}).then((res) => {\r\n        if (res.success) {\r\n          this.taskForm.relayPhoneId = \"\";\r\n          this.relayPhoneListItems = [];\r\n          this.relayPhoneListItems = res.result.list;\r\n        }\r\n      });\r\n    }\r\n\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\">\r\n// 建议引入通用样式 具体路径自行修改 可删除下面样式代码\r\n@import \"../../../styles/table-common.less\";\r\n.search {\r\n  .operation {\r\n    margin-bottom: 2vh;\r\n  }\r\n  .select-count {\r\n    font-weight: 600;\r\n    color: #40a9ff;\r\n  }\r\n  .select-clear {\r\n    margin-left: 10px;\r\n  }\r\n  .page {\r\n    margin-top: 2vh;\r\n  }\r\n  .drop-down {\r\n    margin-left: 5px;\r\n  }\r\n}\r\n</style>"]}]}