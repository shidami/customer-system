{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\sys\\out-call\\callTaskMyDetail.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\sys\\out-call\\callTaskMyDetail.vue","mtime":1614579763381},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi8uLi8uLi9zdHlsZXMvdGFibGUtY29tbW9uLmxlc3MiOw0K"},{"version":3,"sources":["callTaskMyDetail.vue"],"names":[],"mappings":";AACA","file":"callTaskMyDetail.vue","sourceRoot":"src/views/sys/out-call","sourcesContent":["<style lang=\"less\">\r\n@import \"../../../styles/table-common.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Card>\r\n      <Row v-show=\"openSearch\">\r\n        <Form ref=\"searchForm\" :model=\"searchForm\" inline :label-width=\"70\">\r\n          <Row>\r\n          <FormItem label=\"任务名称\" prop=\"taskId\"> \r\n              <Select v-model=\"searchForm.taskId\" @on-change=\"getList()\" style=\"width: 150px\"  multiple>\r\n                <Option v-for=\"item in taskList\" :value=\"item.id\" :key=\"item.id\" :label=\"item.taskName\" >\r\n                  <span style=\"margin-right:10px;\">{{ item.taskName }}</span>\r\n                </Option>\r\n              </Select>\r\n          </FormItem>\r\n          <FormItem label=\"任务批次\" prop=\"batchId\">\r\n              <Select v-model=\"searchForm.batchId\" style=\"width: 150px\" multiple>\r\n                <Option v-for=\"item in batchList\" :value=\"item.id\" :key=\"item.id\"   :label=\"item.batchName\" >\r\n                  <span style=\"margin-right:10px;\">{{ item.batchName }}</span>\r\n                </Option>\r\n              </Select>\r\n          </FormItem>\r\n          <FormItem label=\"营销结果\" prop=\"marketingResult\">\r\n              <Select v-model=\"searchForm.marketingResult\" style=\"width: 150px\" multiple>\r\n                <Option v-for=\"item in marketingResultList\" :value=\"item.fullName\" :key=\"item.fullName\" :label=\"item.fullName\" >\r\n                  <span style=\"margin-right:10px;\">{{ item.fullName }}</span>\r\n                </Option>\r\n              </Select>\r\n          </FormItem>\r\n          <FormItem label=\"呼叫结果\" prop=\"callResult\">\r\n              <Select v-model=\"searchForm.callResult\" style=\"width:150px\" multiple>\r\n                <Option v-for=\"item in this.$store.state.dict.callResult\" :value=\"item.value\" :key=\"item.id\" :label=\"item.title\" >\r\n                  <span style=\"margin-right:10px;\">{{ item.title }}</span>\r\n                </Option>\r\n              </Select>\r\n          </FormItem>\r\n          <Form-item style=\"margin-left:-35px;\" class=\"br\">\r\n            <Button @click.native=\"handleSearch\" type=\"primary\" icon=\"ios-search\">搜索</Button>\r\n            <Button @click=\"handleReset\">重置</Button>\r\n            <a class=\"drop-down\" @click=\"dropDown\">\r\n              {{dropDownContent}}\r\n              <Icon :type=\"dropDownIcon\"></Icon>\r\n            </a>\r\n          </Form-item>\r\n          </Row>\r\n          <span v-if=\"drop\">\r\n          <Row>\r\n          <Form-item label=\"手机号\" prop=\"mobileNumber\">\r\n              <Input  type=\"text\"  v-model=\"searchForm.mobileNumber\" clearable placeholder=\"请输入手机号\" style=\"width: 130px\" />\r\n          </Form-item>\r\n          <FormItem label=\"回访状态\" prop=\"returnVisit\">\r\n              <Select v-model=\"searchForm.returnVisit\" clearable placeholder=\"请选择\" style=\"width:120px\">\r\n                <Option  value=\"1\" >待回访</Option>\r\n                <Option  value=\"2\" >已回访</Option>\r\n              </Select>\r\n          </FormItem>\r\n          <Form-item label=\"创建时间\">\r\n            <DatePicker  v-model=\"selectDate\"  type=\"daterange\" format=\"yyyy-MM-dd\" clearable @on-change=\"selectDateRange\" \r\n              placeholder=\"选择起始时间\" style=\"width: 200px\" ></DatePicker>\r\n          </Form-item>\r\n          </Row>\r\n          </span>\r\n          \r\n        </Form>\r\n      </Row>\r\n      <Row class=\"operation\">\r\n        <Button type=\"dashed\" @click=\"openSearch=!openSearch\">{{openSearch ? \"关闭搜索\" : \"开启搜索\"}}</Button>\r\n      </Row>\r\n      <Row v-show=\"openTip && selectCount > 0\">\r\n        <Alert show-icon>\r\n          已选择\r\n          <span class=\"select-count\">{{selectCount}}</span> 项\r\n          <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n        </Alert>\r\n      </Row>\r\n      <Row>\r\n        <Table\r\n          :loading=\"loading\"\r\n          :columns=\"columns\"\r\n          :data=\"data\"\r\n          sortable=\"custom\"\r\n          @on-sort-change=\"changeSort\"\r\n          @on-selection-change=\"showSelect\"\r\n          ref=\"table\"\r\n        ></Table>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n        <Page\r\n          :current=\"searchForm.pageNumber\"\r\n          :total=\"total\"\r\n          :page-size=\"searchForm.pageSize\"\r\n          @on-change=\"changePage\"\r\n          @on-page-size-change=\"changePageSize\"\r\n          :page-size-opts=\"[10,20,50]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n        ></Page>\r\n      </Row>\r\n    </Card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { InitCTIToolCustomUI } from \"@/libs/core/ToolUI_simple_v2.1.2.js\";\r\nimport {\r\n  getCallTaskDetailTodo,\r\n  getCallTaskAllLists,       //获取任务记录\r\n  getCallTaskBatchAllLists,  //根据任务id,获取批次记录\r\n  getResultAllLists,         //根据任务id,获取营销结果\r\n} from \"@/api/index\";\r\nimport $ from \"jquery\";\r\nexport default {\r\n  name: \"callTaskDetail-manage\",\r\n  data() {\r\n    return {\r\n      height: 510,\r\n      showUser: false,\r\n      showType: \"0\",\r\n      openSearch: false,\r\n      openTip: true,\r\n      loading: false,\r\n      reading: false,\r\n      drop: false,\r\n      dropDownContent: \"展开\",\r\n      dropDownIcon: \"ios-arrow-down\",\r\n      selectCount: 0,\r\n      selectList: [],\r\n      taskList: [],  \r\n      batchList: [], \r\n      marketingResultList: [],\r\n      searchForm: {\r\n        taskId:\"\",\r\n        batchId:\"\",\r\n        returnVisit:\"\",\r\n        marketingResult:\"\",\r\n        callResult:\"\",\r\n        mobileNumber:\"\",\r\n        pageNumber: 1,\r\n        pageSize: 10,\r\n        sort: \"create_time\",\r\n        order: \"desc\"\r\n      },\r\n      selectDate: null,\r\n      columns: [\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {  title: \"任务名称\", key: \"taskName\", minWidth: 125},\r\n        {  title: \"批次名称\", key: \"batchName\", minWidth: 125},\r\n        {  title: \"批次类型\", key: \"batchType\", minWidth: 125},\r\n        {  title: \"手机号码\", key: \"mobileNumber\", minWidth: 125,render:(h,params)=>{\r\n          return h('div',[\r\n            h('Button', {\r\n              props: {\r\n                type: 'text',\r\n                size: 'small'\r\n              },\r\n              attrs:{\r\n                id:'tableOcxBtnOutCall',\r\n                keyid:\"MakeCall\"\r\n              },\r\n              on:{\r\n                click: () => {\r\n                  this.rowCall(params.row);\r\n                },\r\n              }\r\n            }, params.row.mobileNumber)\r\n          ])\r\n          }},\r\n        {  title: \"呼叫次数\", key: \"callCount\", minWidth: 125},\r\n        {  title: \"呼叫状态\", key: \"callStatus\", minWidth: 125},\r\n        {  title: \"最近呼叫时间\", key: \"lastCallTime\", minWidth: 125},\r\n        {  title: \"回访时间\", key: \"visitedDate\", minWidth: 125},\r\n        {  title: \"营销结果\", key: \"marketingResult\", minWidth: 125},\r\n        {  title: \"呼叫结果\", key: \"callResult\", minWidth: 125},\r\n        {  title: \"备注\", key: \"remark\", minWidth: 125},\r\n        {  title: \"创建时间\", key: \"createTime\", sortable: true, sortType: \"desc\", width: 180 }\r\n      ],\r\n      data: [],\r\n      total: 0,\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getCallTaskList();\r\n      this.getCallTaskDetailList();\r\n    },\r\n    getCallTaskList(){\r\n        getCallTaskAllLists({}).then((res) => {\r\n            if (res.success) {\r\n               this.taskList = res.result.list;\r\n            }\r\n        });\r\n    },\r\n    getList(){\r\n      var taskId = this.searchForm.taskId;\r\n      if( taskId!=null && taskId !=''){\r\n          let ids = \"\";\r\n          for (var i = 0; i < taskId.length; i++) {\r\n              ids += taskId[i] + \",\";\r\n          }\r\n          ids = ids.substring(0, ids.length - 1);\r\n          this.getResultAll(ids);\r\n          this.getbatchList(ids);\r\n      }else{\r\n        this.searchForm.batchId=\"\";\r\n        this.searchForm.marketingResult=\"\";\r\n        this.batchList = [];\r\n        this.marketingResultList = [];\r\n      }\r\n    },\r\n    getbatchList(ids) {\r\n        getCallTaskBatchAllLists({taskIds:ids}).then((res) => {\r\n            if (res.success) {\r\n                this.batchList=res.result.list;\r\n            }\r\n        });\r\n    },\r\n    getResultAll(ids){\r\n        getResultAllLists({taskIds:ids}).then((res) => {\r\n            if(res.success) {\r\n              this.marketingResultList = res.result.list;\r\n            }\r\n        });\r\n    },\r\n    changeSelect(e) {\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n      if(this.selectCount > 0){\r\n         this.openTip = true;\r\n      }else{\r\n         this.openTip = false;\r\n      }\r\n    },\r\n    handleSearch() {\r\n      this.selectList = \"\";\r\n      this.selectCount = 0;\r\n      this.searchForm.pagember = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.getCallTaskDetailList();\r\n    },\r\n    handleReset() {\r\n      this.$refs.searchForm.resetFields();\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.selectDate = null;\r\n      this.searchForm.startDate = \"\";\r\n      this.searchForm.endDate = \"\";\r\n      this.$refs.dep.clearSelect();\r\n    },\r\n    selectDateRange(v) {\r\n      if (v) {\r\n        this.searchForm.startDate = v[0];\r\n        this.searchForm.endDate = v[1];\r\n      }\r\n    },\r\n    dropDown() {\r\n      if (this.drop) {\r\n        this.dropDownContent = \"展开\";\r\n        this.dropDownIcon = \"ios-arrow-down\";\r\n      } else {\r\n        this.dropDownContent = \"收起\";\r\n        this.dropDownIcon = \"ios-arrow-up\";\r\n      }\r\n      this.drop = !this.drop;\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getCallTaskDetailList();\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getCallTaskDetailList();\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    showSelect(e) {\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order == \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getCallTaskDetailList();\r\n    },\r\n    getCallTaskDetailList() {\r\n        this.loading = true;\r\n        var formdata={};\r\n        for(var i in this.searchForm){\r\n          if(this.searchForm[i] != null && this.searchForm[i] !=\"\"){\r\n            if(i=='taskId' || i=='batchId' || i=='seatUserIds' || i=='callResult' || i=='callStatus' || i=='marketingResult'){\r\n                formdata[i]=  this.searchForm[i].toString();\r\n            }else{\r\n                formdata[i] = this.searchForm[i];\r\n            }   \r\n          }\r\n        }\r\n        getCallTaskDetailTodo(formdata).then(res => {\r\n          this.loading = false;\r\n          if (res.success) {\r\n            this.data = res.result.list;\r\n            this.total = res.result.total;\r\n          }\r\n        });\r\n    },\r\n    rowCall(row){\r\n      row.relayPhone=135268541251;\r\n      row.calltype=4; //1是客户弹屏,4是外呼弹屏\r\n      row.relayGroupNo=2;\r\n     // this.DoOutCall(row.mobileNumber,'1',row.id,row.relayPhone,4,row.relayGroupNo,1,'customerId='+row.id,taskId,batchId,customerId)\r\n      this.DoOutCall(row.mobileNumber,'1',row.id,row.relayPhone,row.calltype,row.relayGroupNo,\"1\",'customerId='+row.id,row.taskId,row.batchId,row.id)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      function DoSendMsg(phone,phoneType)\r\n      {\r\n        if(phone == undefined || phone == null || phone == \"\") return;\r\n        openDialog(\"/MessageModule/Sended/singleEditForm.do?phone=\"+phone, \"SendMsg\", \"发送短信\", 550, 350, function (iframe) {\r\n          top.frames[iframe].AcceptClick();\r\n        },\"发送\");\r\n      }\r\n      function rdoDealTypeChange(t)\r\n      {\r\n        if(t == 1)\r\n        {\r\n          $(\"#rdoIsLocalYes\").removeAttr(\"disabled\");\r\n          $(\"#rdoIsLocalNo\").removeAttr(\"disabled\");\r\n        }else\r\n        {\r\n          $(\"#rdoIsLocalYes\").attr(\"checked\",\"checked\");\r\n          $(\"#rdoIsLocalYes\").attr(\"disabled\",\"disabled\");\r\n          $(\"#rdoIsLocalNo\").attr(\"disabled\",\"disabled\");\r\n\r\n        }\r\n      }\r\n\r\n\r\n    },\r\n    /**\r\n     * 外呼函数\r\n     *\r\n     * @param phone 被叫号码\r\n     * @param phoneType 号码类型\r\n     * @param customId 外呼任务清单ID\r\n     * @param caller 主叫号码\r\n     * @param calltype 呼叫类型 1普通外呼\r\n     * @param relayGrpNo 中继组标识编码\r\n     * @param isPopNow 是否立即弹屏 1是 0否\r\n     * @param otherParams 其他参数字符串\r\n     * @param taskId 外呼任务ID\r\n     * @param batchId 外呼任务批次ID\r\n     * @param customerId 客户ID\r\n     * */\r\n    DoOutCall(phone,phoneType,customId,caller,calltype,relayGrpNo,isPopNow,otherParams,taskId,batchId,customerId){\r\n  if(phone == undefined || phone == null || phone == \"\") return;\r\n  if(customId == undefined || customId == null || customId == \"\") customId = \"\";\r\n  if(caller == undefined || caller == null || caller == \"\") caller = \"\";\r\n  if(calltype == undefined || calltype == null || calltype == \"\") calltype = \"\";\r\n  if(relayGrpNo == undefined || relayGrpNo == null || relayGrpNo == \"\") relayGrpNo = \"\";\r\n  isPopNow = isPopNow == undefined || isPopNow == null || isPopNow == \"\" ? \"0\":isPopNow+\"\";\r\n  otherParams = otherParams == undefined || otherParams == null || otherParams == \"\" ? \"\":otherParams;\r\n  taskId = taskId == undefined || taskId == null || taskId == \"\" ? \"\":taskId;\r\n  batchId = batchId == undefined || batchId == null || batchId == \"\" ? \"\":batchId;\r\n  customerId = customerId == undefined || customerId == null || customerId == \"\" ? \"\":customerId;\r\n  if(!!CCUI.topWindow && (CCUI.topWindow.OcxCore == undefined || CCUI.topWindow.OcxCore.Session == undefined)){\r\n    return false;\r\n  }\r\n  else if(CCUI.topWindow == undefined && (top.OcxCore == undefined || top.OcxCore.Session == undefined))\r\n  {\r\n    return false;\r\n  }\r\n  phone = CCUI.utils.decipherPhone(phone);\r\n  if(!!CCUI.topWindow){\r\n    return CCUI.topWindow.OcxCore.Session.MakeCall(phone,customId,caller,calltype,relayGrpNo,isPopNow,otherParams,taskId,batchId,customerId);\r\n  }\r\n  else{\r\n    return top.OcxCore.Session.MakeCall(phone,customId,caller,calltype,relayGrpNo,isPopNow,otherParams,taskId,batchId,customerId);\r\n  }\r\n\r\n  //AjaxJson(\"/SystemModule/CTI/GetDialNumber.do\", {phone:phone}, function (data) {\r\n\r\n  //});\r\n  /*$(\"#lblOutCallPhone\").text(phone);\r\n  $(\"#hidOutCallPhone\").val(phone);\r\n  $(\"#rdoDealTypeOuter\").attr(\"checked\",\"checked\");\r\n  var content=document.getElementById(\"ocxOutCallContent\");\r\n\r\n  art.dialog({\r\n            title:'外呼拨号',\r\n            width: 300,\r\n        //height: 200,\r\n        id: 'DoOutCallss',\r\n        lock: true,\r\n        content: content,\r\n        ok: function () {\r\n          var OutCallPhone = $(\"#hidOutCallPhone\").val();\r\n          OutCallPhone = CCUI.utils.decipherPhone(OutCallPhone);\r\n         if($(\"#rdoDealTypeInner\").is(':checked') && $(\"#rdoIsLocalYes\").is(':checked')){\r\n                       top.OcxCommandFun.MakeCall(OutCallPhone,customId,caller,calltype,relayGrpNo,isPopNow,otherParams);\r\n                   }else if($(\"#rdoDealTypeInner\").is(':checked') && $(\"#rdoIsLocalNo\").is(':checked')){\r\n                      var typeLine=0+OutCallPhone;\r\n                      top.OcxCommandFun.MakeCall(typeLine,customId,caller,calltype,relayGrpNo,isPopNow,otherParams);\r\n                   }else if($(\"#rdoDealTypeOuter\").is(':checked') && $(\"#rdoIsLocalYes\").is(':checked')){\r\n                      var typeLine=9+OutCallPhone;\r\n                      top.OcxCommandFun.MakeCall(typeLine,customId,caller,calltype,relayGrpNo,isPopNow,otherParams);\r\n                   }else if($(\"#rdoDealTypeOuter\").is(':checked') && $(\"#rdoIsLocalNo\").is(':checked')){\r\n                     var typeLine=90+OutCallPhone;\r\n                     top.OcxCommandFun.MakeCall(typeLine,customId,caller,calltype,relayGrpNo,isPopNow,otherParams);\r\n                   }\r\n              //return false;\r\n          },\r\n          cancel: true\r\n    });*/\r\n}\r\n  },\r\n  mounted() {\r\n    // 计算高度\r\n    this.height = Number(document.documentElement.clientHeight - 230);\r\n    this.init();\r\n  }\r\n};\r\n</script>"]}]}