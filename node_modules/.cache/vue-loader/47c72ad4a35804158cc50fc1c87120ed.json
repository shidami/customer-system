{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\xboot-vue-template\\excel\\excel.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\xboot-vue-template\\excel\\excel.vue","mtime":1614579763461},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi8uLi8uLi9zdHlsZXMvdGFibGUtY29tbW9uLmxlc3MiOw0K"},{"version":3,"sources":["excel.vue"],"names":[],"mappings":";AACA","file":"excel.vue","sourceRoot":"src/views/xboot-vue-template/excel","sourcesContent":["<style lang=\"less\">\r\n@import \"../../../styles/table-common.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Card>\r\n      <Row class=\"operation\">\r\n        <Button @click=\"exportSelectData\" icon=\"md-cloud-upload\">导出所选数据</Button>\r\n        <Button @click=\"exportAll\" icon=\"ios-cloud-upload\">导出全部数据</Button>\r\n        <Button @click=\"importModalVisible=true\" icon=\"ios-download\">导入数据</Button>\r\n        <Button type=\"dashed\" @click=\"openTip=!openTip\">{{openTip ? \"关闭提示\" : \"开启提示\"}}</Button>\r\n      </Row>\r\n      <Row v-show=\"openTip && selectCount > 0\">\r\n        <Alert show-icon>\r\n          已选择\r\n          <span class=\"select-count\">{{selectCount}}</span> 项\r\n          <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n        </Alert>\r\n      </Row>\r\n      <Row>\r\n        <Table\r\n          :loading=\"loading\"\r\n          border\r\n          :columns=\"columns\"\r\n          :data=\"data\"\r\n          sortable=\"custom\"\r\n          @on-sort-change=\"changeSort\"\r\n          @on-selection-change=\"showSelect\"\r\n          ref=\"table\"\r\n        ></Table>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n        <Page\r\n          :current=\"searchForm.pageNumber\"\r\n          :total=\"total\"\r\n          :page-size=\"searchForm.pageSize\"\r\n          @on-change=\"changePage\"\r\n          @on-page-size-change=\"changePageSize\"\r\n          :page-size-opts=\"[10,20,50]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n        ></Page>\r\n      </Row>\r\n    </Card>\r\n\r\n    <!-- 自定义导出数据 -->\r\n    <Modal\r\n      v-model=\"exportModalVisible\"\r\n      :title=\"exportTitle\"\r\n      :loading=\"loadingExport\"\r\n      @on-ok=\"exportCustomData\"\r\n    >\r\n      <Form ref=\"exportForm\" :label-width=\"100\">\r\n        <FormItem label=\"导出文件名\">\r\n          <Input v-model=\"filename\" />\r\n        </FormItem>\r\n        <FormItem label=\"自定义导出列\">\r\n          <CheckboxGroup v-model=\"chooseColumns\">\r\n            <Checkbox\r\n              v-for=\"(item, i) in exportColumns\"\r\n              :label=\"item.title\"\r\n              :key=\"i\"\r\n              :value=\"item.checked\"\r\n              :disabled=\"item.disabled\"\r\n            ></Checkbox>\r\n          </CheckboxGroup>\r\n        </FormItem>\r\n      </Form>\r\n    </Modal>\r\n    <Drawer title=\"导入数据\" closable v-model=\"importModalVisible\" width=\"1000\">\r\n      <div style=\"display:flex;justify-content: space-between;align-items: center;\">\r\n        <Upload action :before-upload=\"beforeUploadImport\" accept=\".xls, .xlsx\">\r\n          <Button\r\n            :loading=\"reading\"\r\n            icon=\"ios-cloud-upload-outline\"\r\n            style=\"margin-right:10px\"\r\n          >上传Excel文件</Button>\r\n          <span v-if=\"uploadfile.name\">当前选择文件：{{ uploadfile.name }}</span>\r\n        </Upload>\r\n        <Button @click=\"clearImportData\" icon=\"md-trash\">清空数据</Button>\r\n      </div>\r\n      <Alert type=\"warning\" show-icon>导入前请下载查看导入模版数据文件，确保数据格式正确，不得修改列英文名称。</Alert>\r\n      <Table\r\n        :columns=\"importColumns\"\r\n        border\r\n        :height=\"height\"\r\n        :data=\"importTableData\"\r\n        ref=\"importTable\"\r\n      ></Table>\r\n      <div class=\"drawer-footer\">\r\n        <Button @click=\"downloadTemple\" type=\"info\" style=\"position:absolute;left:15px;\">下载导入模板</Button>\r\n        <Button @click=\"importModalVisible=false\">关闭</Button>\r\n        <Button\r\n          :loading=\"importLoading\"\r\n          :disabled=\"importTableData.length<=0\"\r\n          @click=\"importData\"\r\n          style=\"margin-left:5px\"\r\n          type=\"primary\"\r\n        >\r\n          确认导入\r\n          <span v-if=\"importTableData.length>0\">{{importTableData.length}} 条数据</span>\r\n        </Button>\r\n      </div>\r\n    </Drawer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// 模版导入文件表数据\r\nimport { userColumns, userData } from \"@/libs/importTemplate\";\r\n// excel转换工具类\r\nimport excel from \"@/libs/excel\";\r\nexport default {\r\n  name: \"excel\",\r\n  data() {\r\n    return {\r\n      openTip: true, // 显示提示\r\n      reading: false, // 读取中\r\n      height: 510, // 高度\r\n      loading: true, // 表单加载状态\r\n      importLoading: false, // 导入加载状态\r\n      loadingExport: true, // 导出加载状态\r\n      exportModalVisible: false, // 自定义导出显示\r\n      importModalVisible: false, // 导入显示\r\n      selectCount: 0, // 多选计数\r\n      selectList: [], // 多选数据\r\n      searchForm: {\r\n        pageNumber: 1,\r\n        pageSize: 10,\r\n        sort: \"createTime\",\r\n        order: \"desc\"\r\n      },\r\n      columns: [\r\n        // 表头\r\n        {\r\n          type: \"selection\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {\r\n          title: \"名称\",\r\n          key: \"name\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          sortType: \"desc\"\r\n        },\r\n        {\r\n          title: \"更新时间\",\r\n          key: \"updateTime\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"操作\",\r\n          key: \"action\",\r\n          align: \"center\",\r\n          width: 200,\r\n          render: (h, params) => {\r\n            return h(\"div\", [\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"primary\",\r\n                    size: \"small\",\r\n                    icon: \"ios-create-outline\"\r\n                  },\r\n                  style: {\r\n                    marginRight: \"5px\"\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.$Message.info(\"点击了编辑\");\r\n                    }\r\n                  }\r\n                },\r\n                \"编辑\"\r\n              ),\r\n              h(\r\n                \"Button\",\r\n                {\r\n                  props: {\r\n                    type: \"error\",\r\n                    size: \"small\",\r\n                    icon: \"md-trash\"\r\n                  },\r\n                  on: {\r\n                    click: () => {\r\n                      this.$Message.info(\"点击了删除\");\r\n                    }\r\n                  }\r\n                },\r\n                \"删除\"\r\n              )\r\n            ]);\r\n          }\r\n        }\r\n      ],\r\n      exportColumns: [\r\n        // 导出列\r\n        {\r\n          title: \"名称\",\r\n          key: \"name\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"手机\",\r\n          key: \"mobile\",\r\n          sortable: true\r\n        },\r\n        {\r\n          title: \"创建时间\",\r\n          key: \"createTime\",\r\n          sortable: true,\r\n          sortType: \"desc\"\r\n        },\r\n        {\r\n          title: \"更新时间\",\r\n          key: \"updateTime\",\r\n          sortable: true\r\n        }\r\n      ],\r\n      chooseColumns: [],\r\n      filename: \"数据\",\r\n      exportTitle: \"确认导出\",\r\n      exportType: \"\",\r\n      importTableData: [],\r\n      importColumns: [],\r\n      uploadfile: {\r\n        name: \"\"\r\n      },\r\n      tempColumns: userColumns,\r\n      tempData: userData,\r\n      data: [],\r\n      exportData: [],\r\n      total: 0\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getDataList();\r\n      // 初始化导出列数据\r\n      let array = [];\r\n      this.exportColumns.forEach(e => {\r\n        // 指定列限制权限\r\n        if (\r\n          !this.getStore(\"roles\").includes(\"ROLE_ADMIN\") &&\r\n          e.key == \"mobile\"\r\n        ) {\r\n          e.title = \"[无权导出] \" + e.title;\r\n          e.disabled = true;\r\n        } else {\r\n          e.disabled = false;\r\n        }\r\n        array.push(e.title);\r\n      });\r\n      this.chooseColumns = array;\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getDataList();\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getDataList();\r\n    },\r\n    selectDateRange(v) {\r\n      if (v) {\r\n        this.searchForm.startDate = v[0];\r\n        this.searchForm.endDate = v[1];\r\n      }\r\n    },\r\n    getDataList() {\r\n      this.loading = true;\r\n      let params = {\r\n        pageNumber: this.pageNumber,\r\n        pageSize: this.pageSize,\r\n        sort: this.sortColumn,\r\n        order: this.sortType\r\n      };\r\n      // 请求后端获取表单数据 请自行修改接口\r\n      // this.getRequest(\"请求路径\", params).then(res => {\r\n      //   this.loading = false;\r\n      //   if (res.success) {\r\n      //     this.data = res.result.content;\r\n      //     this.total = res.result.totalElements;\r\n      //   }\r\n      // });\r\n      // 以下为模拟数据\r\n      this.data = [\r\n        {\r\n          id: \"1\",\r\n          name: \"XBoot\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        },\r\n        {\r\n          id: \"2\",\r\n          name: \"Exrick\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        }\r\n      ];\r\n      this.total = this.data.length;\r\n      this.loading = false;\r\n    },\r\n    handleSearch() {\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.getDataList();\r\n    },\r\n    handleReset() {\r\n      this.$refs.searchForm.resetFields();\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      // 重新加载数据\r\n      this.getDataList();\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order == \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getDataList();\r\n    },\r\n    exportSelectData() {\r\n      if (this.selectCount <= 0) {\r\n        this.$Message.warning(\"您还未选择要导出的数据\");\r\n        return;\r\n      }\r\n      this.exportType = \"part\";\r\n      this.exportModalVisible = true;\r\n      this.exportTitle = \"确认导出 \" + this.selectCount + \" 条数据\";\r\n    },\r\n    exportAll() {\r\n      this.exportType = \"all\";\r\n      this.exportModalVisible = true;\r\n      this.exportTitle = \"确认导出全部 \" + this.total + \" 条数据\";\r\n      // 请求后端获取全部数据 请自行修改接口\r\n      // this.getRequest(\"请求路径\", params).then(res => {\r\n      //   if (res.success) {\r\n      //     this.exportData = res.result;\r\n      //   }\r\n      // });\r\n      // 以下为模拟数据\r\n      this.exportData = [\r\n        {\r\n          id: \"1\",\r\n          name: \"XBoot\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        },\r\n        {\r\n          id: \"2\",\r\n          name: \"Exrick\",\r\n          mobile: \"12345678901\",\r\n          createTime: \"2018-08-08 00:08:00\",\r\n          updateTime: \"2018-08-08 00:08:00\"\r\n        }\r\n      ];\r\n    },\r\n    exportCustomData() {\r\n      if (this.filename == \"\") {\r\n        this.filename = \"用户数据\";\r\n      }\r\n      // 判断勾选导出列\r\n      let array = [];\r\n      this.exportColumns.forEach(e => {\r\n        this.chooseColumns.forEach(c => {\r\n          if (e.title == c && !e.disabled) {\r\n            array.push(e);\r\n          }\r\n        });\r\n      });\r\n      this.exportColumns = array;\r\n      this.exportModalVisible = false;\r\n      let title = [];\r\n      let key = [];\r\n      this.exportColumns.forEach(e => {\r\n        title.push(e.title);\r\n        key.push(e.key);\r\n      });\r\n      const params = {\r\n        title: title,\r\n        key: key,\r\n        data: this.exportData,\r\n        autoWidth: true,\r\n        filename: this.filename\r\n      };\r\n      excel.export_array_to_excel(params);\r\n    },\r\n    beforeUploadImport(file) {\r\n      this.uploadfile = file;\r\n      const fileExt = file.name\r\n        .split(\".\")\r\n        .pop()\r\n        .toLocaleLowerCase();\r\n      if (fileExt == \"xlsx\" || fileExt == \"xls\") {\r\n        this.readFile(file);\r\n        this.file = file;\r\n      } else {\r\n        this.$Notice.warning({\r\n          title: \"文件类型错误\",\r\n          desc:\r\n            \"所选文件‘ \" +\r\n            file.name +\r\n            \" ’不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。\"\r\n        });\r\n      }\r\n      return false;\r\n    },\r\n    // 读取文件\r\n    readFile(file) {\r\n      this.reading = true;\r\n      const reader = new FileReader();\r\n      reader.readAsArrayBuffer(file);\r\n      reader.onerror = e => {\r\n        this.reading = false;\r\n        this.$Message.error(\"文件读取出错\");\r\n      };\r\n      reader.onload = e => {\r\n        const data = e.target.result;\r\n        const { header, results } = excel.read(data, \"array\");\r\n        const tableTitle = header.map(item => {\r\n          return { title: item, key: item, minWidth: 100, align: \"center\" };\r\n        });\r\n        this.importTableData = results;\r\n        this.importColumns = tableTitle;\r\n        this.reading = false;\r\n        this.$Message.success(\"读取数据成功\");\r\n      };\r\n    },\r\n    downloadTemple() {\r\n      let title = [];\r\n      let key = [];\r\n      userColumns.forEach(e => {\r\n        title.push(e.title);\r\n        key.push(e.key);\r\n      });\r\n      const params = {\r\n        title: title,\r\n        key: key,\r\n        data: userData,\r\n        autoWidth: true,\r\n        filename: \"导入数据模版\"\r\n      };\r\n      excel.export_array_to_excel(params);\r\n    },\r\n    importData() {\r\n      this.importLoading = true;\r\n      // 传入导入数据 后端接收body数组列表批量导入\r\n      // this.importRequest(\"请求路径\", this.importTableData).then(res => {\r\n      //   this.importLoading = false;\r\n      //   if (res.success) {\r\n      //     this.importModalVisible = false;\r\n      //     this.getDataList();\r\n      //     this.$Modal.info({\r\n      //       title: \"导入结果\",\r\n      //       content: res.message\r\n      //     });\r\n      //   }\r\n      // });\r\n      // 模拟请求成功\r\n      this.importLoading = false;\r\n      this.importModalVisible = false;\r\n      this.$Modal.info({\r\n        title: \"导入结果\",\r\n        content: \"导入成功，这是假通知\"\r\n      });\r\n      this.getDataList();\r\n    },\r\n    showSelect(e) {\r\n      this.exportData = e;\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    clearImportData() {\r\n      this.importTableData = [];\r\n      this.importColumns = [];\r\n      this.uploadfile = {};\r\n    }\r\n  },\r\n  mounted() {\r\n    // 计算高度\r\n    this.height = Number(document.documentElement.clientHeight - 230);\r\n    this.init();\r\n  }\r\n};\r\n</script>"]}]}