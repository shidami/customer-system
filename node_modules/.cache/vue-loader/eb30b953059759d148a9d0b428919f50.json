{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\my-components\\IVR\\Set_Flow.vue?vue&type=style&index=0&id=fbcbfcf2&scoped=true&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\my-components\\IVR\\Set_Flow.vue","mtime":1614579763291},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYXV0by13YXJwewogIC8vLml2dS10YWJsZS13cmFwcGVyewogIC8vICBtYXgtaGVpZ2h0OiA2MDBweDsKICAvLyAgb3ZlcmZsb3c6IGF1dG87CiAgLy8gIHBhZGRpbmctYm90dG9tOiAzMHB4OwogIC8vfQp9Cgo="},{"version":3,"sources":["Set_Flow.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2YA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Set_Flow.vue","sourceRoot":"src/views/my-components/IVR","sourcesContent":["<template>\r\n    <div>\r\n      <Modal\r\n          :title=\"setFlowModalVisibleTitle\"\r\n          v-model=\"setFlowModalVisibles\"\r\n          :closable=\"false\"\r\n          :mask-closable=\"false\"\r\n          :width=\"700\"\r\n      >\r\n        <div class=\"auto-warp\">\r\n          <Tabs value=\"name1\">\r\n            <TabPane label=\"基本信息\" name=\"name1\" :IVRFormData1=\"IVRFormData1\">\r\n              {{IVRFormData1}}\r\n              <Form ref=\"formItem\" :model=\"IVRFormData1\" :rules=\"formItemValidate\" :label-width=\"80\">\r\n                <FormItem label=\"流程ID\" prop=\"id\">\r\n                  <Input v-model=\"IVRFormData1.id\" placeholder=\"请输入...\"></Input>\r\n                </FormItem>\r\n                <FormItem label=\"流程名称\" prop=\"name\">\r\n                  <Input v-model=\"IVRFormData1.name\" placeholder=\"请输入...\"></Input>\r\n                </FormItem>\r\n<!--                <FormItem label=\"流程分类\" prop=\"type\">-->\r\n<!--                  <Select v-model=\"IVRFormData1.type\">-->\r\n<!--                    <Option value=\"1\">呼入IVR流程</Option>-->\r\n<!--                  </Select>-->\r\n<!--                </FormItem>-->\r\n                <FormItem label=\"所属公司\" prop=\"tenantId\">\r\n                  <Input v-model=\"IVRFormData1.tenantId\" placeholder=\"请输入...\"></Input>\r\n                </FormItem>\r\n                <FormItem label=\"版本号\" prop=\"wfversion\">\r\n                  <Input v-model=\"IVRFormData1.wfversion\" placeholder=\"请输入...\"></Input>\r\n                </FormItem>\r\n                <FormItem label=\"备注\" prop=\"remark\">\r\n                  <Input v-model=\"IVRFormData1.remark\" placeholder=\"请输入...\"></Input>\r\n                </FormItem>\r\n              </Form>\r\n            </TabPane>\r\n            <TabPane label=\"流程变量\" name=\"name2\">\r\n              <processVariables ref=\"processVariables\"></processVariables>\r\n            </TabPane>\r\n          </Tabs>\r\n        </div>\r\n        <div slot=\"footer\">\r\n          <Button type=\"text\" @click=\"btnCancel\">{{\r\n              $t(\"cancel\")\r\n            }}</Button>\r\n          <Button\r\n              type=\"primary\"\r\n              @click=\"submitAddVoice\"\r\n          >{{ $t(\"save\") }}</Button\r\n          >\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {getIVRSet_FlowDataList} from '@/api/index'\r\nimport processVariables from \"@/views/my-components/IVR/processVariables\";\r\nexport default {\r\nname: \"Set_Flow\",\r\n  props:['setFlowModalVisibles','IVRFormData1'],\r\n  components:{processVariables},\r\n  data(){\r\n    return{\r\n      wfGlobalVariablesObj:null,\r\n      setFlowModalVisibleTitle:'',\r\n      checkCodeLoading:'',\r\n      formItem:{\r\n        id:'6fe0074c-558a-45c1-a0a4-d57a305e96e1',//流程ID\r\n        name:'新流程',//流程名称\r\n        keyName:'新流程',//流程代码\r\n        type:'1',//流程分类\r\n        companyName:'companyName',//所属公司名称【hide】\r\n        companyId:'31b05701-60ef-405c-87ba-af47049e3f48',//所属公司\r\n        manager :'6fe0074c-558a-45c1-a0a4-d57a305e96e1',//创建人【hide】\r\n        instanceManager:'6fe0074c-558a-45c1-a0a4-d57a305e96e1',//实例管理者【hide】\r\n        removeCompleted:'0',//删除已完成【hide】\r\n        debug:'1',//调试模式【hide】\r\n        debugUsers:'1',//调试人员【hide】\r\n        version:'1',//版本号【hide】\r\n        describe:''//备注【hide】\r\n      },\r\n      formItemValidate:{\r\n        version: [\r\n          {\r\n            required: true,\r\n            message: this.$t(\"pleaseEnter\"),\r\n            trigger: \"blur\",\r\n          },\r\n        ],\r\n      },\r\n      newInitFlowData:{\r\n        /*\"id\": \"20170319-1803-5911-4be7-ee4be3c4eb5a\",\r\n        \"name\": \"新流程\",\r\n        \"keyName\": \"test\",\r\n        \"type\": \"\",\r\n        \"companyId\": \"1\",\r\n        \"manager\": \"u_System\",\r\n        \"instanceManager\": \"u_System\",\r\n        \"removeCompleted\": \"0\",\r\n        \"debug\": \"0\",\r\n        \"debugUsers\": \"\",\r\n        \"describe\": \"\",*/\r\n        \"nextNodeId\": 3,\r\n        \"nextLineId\": 1,\r\n        \"nextNodeEventId\": 1,\r\n        \"nextVarId\": 1,\r\n        \"variables\":[],\r\n        \"nodes\": [\r\n          {\r\n            \"type\": \"Start\",\r\n            \"id\": 1,\r\n            \"name\": \"开始\",\r\n            \"position\": {\r\n              \"x\": 34,\r\n              \"y\": 38,\r\n              \"width\": 42,\r\n              \"height\": 42\r\n            },\r\n            \"sort\": 1,\r\n            \"describe\":\"\",\r\n            \"nodeResults\":[]\r\n          },\r\n          {\r\n            \"type\": \"End\",\r\n            \"id\": 2,\r\n            \"name\": \"结束\",\r\n            \"position\": {\r\n              \"x\": 33,\r\n              \"y\": 199,\r\n              \"width\": 42,\r\n              \"height\": 42\r\n            },\r\n            \"sort\": 2,\r\n            \"describe\":\"\",\r\n            \"hangUpReason\": \"\",\r\n            \"nodeResults\":[]\r\n          }\r\n        ],\r\n        \"lines\": []\r\n      },\r\n    }\r\n  },\r\n  methods:{\r\n    init(){\r\n      var than=this;\r\n      //this.getIVRSet_FlowData();\r\n      if(this.IVRFormData1){\r\n        than.initData();\r\n      }\r\n\r\n    },\r\n    initData(){\r\n      var than=this;\r\n      if (this.IVRFormData1.designJson!=null) {\r\n        debugger\r\n\r\n       var flowdata = this.$parent.$refs.myflow;\r\n        if (flowdata != null) {\r\n          $(\"#base_Name\").val(flowdata.name);\r\n          $(\"#base_KeyName\").val(flowdata.keyName || \"\");\r\n          $(\"#base_Type\").val(flowdata.type);\r\n          var compid = flowdata.companyId != '' ? flowdata.companyId : defaultCompanyID;\r\n          if(flowdata.companyId != '')\r\n          {\r\n            //获取公司名称\r\n            WFCore.AjaxJson(\"/cctadmin/CommonModule/Company/SetCompanyForm.do\", { KeyValue: flowdata.companyId }, function (data) {\r\n              $(\"#base_ComapnyName\").val(data.FullName);\r\n            });\r\n          }\r\n          $(\"#base_ComapnyId\").val(compid);\r\n          new RoadUI.Company().setValue($(\"#base_Comapny\"));\r\n          $(\"#base_Manager_text\").attr(\"compid\", compid);\r\n          $(\"#base_Manager\").val(flowdata.manager || defaultManager);\r\n          new RoadUI.Member().setValue($(\"#base_Manager\"));\r\n          $(\"#base_InstanceManager_text\").attr(\"compid\", compid);\r\n          $(\"#base_InstanceManager\").val(flowdata.instanceManager || defaultManager);\r\n          new RoadUI.Member().setValue($(\"#base_InstanceManager\"));\r\n          $(\"#base_RemoveCompleted\").val(flowdata.removeCompleted);\r\n          $(\"#base_Describe\").val(flowdata.describe);\r\n          $(\"#base_Version\").val(flowdata.version);\r\n          $(\"#base_Debug\").val(flowdata.debug);\r\n          $(\"#base_DebugUsers_text\").attr(\"compid\", compid);\r\n          $(\"#base_DebugUsers\").val(flowdata.debugUsers);\r\n\r\n          var variables = flowdata.variables;\r\n          if (variables && variables.size()>0) {\r\n            variables.each(function(key,value,index){\r\n              link_add(value);\r\n            });\r\n          }\r\n          else if(wfGlobalVariables != undefined && wfGlobalVariables.length>0)\r\n          {\r\n            for (var i = 0; i < wfGlobalVariables.length; i++) {\r\n              link_add(wfGlobalVariables[i]);\r\n            }\r\n          }\r\n          new RoadUI.Member().setValue($(\"#base_DebugUsers\"));\r\n        }\r\n      } else {\r\n\r\n        $(\"#base_Name\").val(\"新流程\");\r\n        if(wfGlobalVariables != undefined && wfGlobalVariables.length>0)\r\n        {\r\n          for (var i = 0; i < wfGlobalVariables.length; i++) {\r\n            than.link_add(wfGlobalVariables[i]);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    link_add(variable) {\r\n      debugger\r\n      var index = $(\"#link_listtable tbody tr\").size() + 1;\r\n      var tr = '<tr>';\r\n      if(variable == undefined || variable.tag !=1)\r\n      {\r\n        var typeId = variable != undefined && variable.type.getIndex != undefined ? variable.type.getIndex() : variable != undefined ? WFCore.Enums.GetIndex(WFCore.Enums.VarType,variable.type):null;\r\n        var typeOptions = getTypeOptions(typeId);\r\n        tr += '<td style=\"background:#ffffff; height:30px;\">';\r\n        tr += '<input type=\"hidden\" name=\"link_index\" tag=\"2\" value=\"' + index.toString() + '\"/>'+ index.toString() + '</td>';\r\n        tr += '<td style=\"background:#ffffff;\"><input type=\"text\" name=\"var_name\" class=\"text1\" style=\"width:150px;\" value=\"'+(!!variable ? variable.name:\"\")+'\"  /></td>';\r\n        tr += '<td style=\"background:#ffffff;\"><select class=\"myselect\" style=\"width:85px\" onchange=\"var_type_change(this)\" id=\"var_type\" name=\"var_type\">' + typeOptions + '</select></td>';\r\n        tr += '<td style=\"background:#ffffff;\"><input type=\"text\" name=\"var_nLength\" class=\"text1\" style=\"width:55px;\" value=\"'+(!!variable ? variable.nLength:0)+'\"  /></td>';\r\n        tr += '<td style=\"background:#ffffff;\"><input type=\"text\" name=\"var_value\" class=\"text1\" style=\"width:135px;\" value=\"'+(!!variable ? variable.value:\"\")+'\"  /></td>';\r\n        tr += '<td style=\"background:#ffffff;\"><input type=\"text\" name=\"var_describe\" class=\"text1\" style=\"width:135px;\" value=\"'+(!!variable ? variable.describe:\"\")+'\"  /></td>';\r\n        tr += '<td style=\"background:#ffffff;\"><a href=\"javascript:link_delete(' + index.toString() + ');\" class=\"deletelink\">删除</a></td>';\r\n      }\r\n      else if(variable != undefined && variable != null)\r\n      {\r\n        var typeName = variable.type.getName != undefined ? variable.type.getName() : WFCore.Enums.GetName(WFCore.Enums.VarType,variable.type);\r\n        tr += '<td style=\"background:#ffffff; height:30px;\">';\r\n        tr += '<input type=\"hidden\" name=\"link_index\" tag=\"1\" value=\"' + index.toString() + '\"/>'+ index.toString() + '</td>';\r\n        tr += '<td style=\"background:#ffffff;\">'+variable.name+'</td>';\r\n        tr += '<td style=\"background:#ffffff;\">'+typeName + '</td>';\r\n        tr += '<td style=\"background:#ffffff;\">'+variable.nLength+'</td>';\r\n        tr += '<td style=\"background:#ffffff;word-wrap:break-word;word-break:break-all;\">'+variable.value+'</td>';\r\n        tr += '<td style=\"background:#ffffff;word-wrap:break-word;word-break:break-all;\">'+variable.describe+'</td>';\r\n        tr += '<td style=\"background:#ffffff;\"></td>';\r\n      }\r\n\r\n      tr += '</tr>';\r\n      $(\"#link_listtable tbody\").append(tr);\r\n      new RoadUI.Select().init($(\".myselect\", $(\"#link_listtable tbody\")));\r\n    },\r\n    btnCancel(){\r\n\r\n      this.$parent.$data.setFlowModalVisibles=false;\r\n    },\r\n    getIVRSet_FlowData(){\r\n      getIVRSet_FlowDataList().then(res=>{\r\n        if(res.status){\r\n          this.formItem=res.result;\r\n        }\r\n      })\r\n    },\r\n    submitAddVoice(){\r\n      var than=this;\r\n\r\n      var variables = new WFCore.Map();\r\n      var varIndex = 1;\r\n      var cErrStr = \"\";\r\n      than.wfGlobalVariablesObj=than.$refs.processVariables.data1;\r\n      //加载全局变量集合\r\n      if(wfGlobalVariables != undefined && wfGlobalVariables.length>0){\r\n        for(var i=0;i<wfGlobalVariables.length;i++)\r\n        {\r\n          var curVarObj = wfGlobalVariables[i];\r\n          curVarObj.id = varIndex;\r\n\r\n          if(variables.get(curVarObj.name) != null)\r\n          {\r\n            cErrStr += \"第\"+varIndex+\"行全局变量名【\"+curVarObj.name+\"】已重复;<br/>\";\r\n            varIndex++;\r\n            continue;\r\n          }\r\n          variables.put(curVarObj.name,curVarObj);\r\n          varIndex++;\r\n        }\r\n      }\r\n      than.wfGlobalVariablesObj.forEach(function (v,i,arr){\r\n        if(v.tag == \"2\"){\r\n          var index = v.id;\r\n          var trobj = v;\r\n          var curVarObj = {\r\n            id: index,\r\n            name: trobj.name || \"\",\r\n            type: isNaN(trobj.type) ? 0 : parseInt(trobj.type) || 0 ,\r\n            nLength: isNaN(trobj.nLength) ? 0 : parseInt(trobj.nLength) || 0,\r\n            describe : trobj.describe,\r\n            value: trobj.value || \"\",\r\n            tag:2\r\n          };\r\n          //校验\r\n          if(WFCore.validator.isNull(curVarObj.name))\r\n          {\r\n            cErrStr += \"第\"+index+\"行变量名不能为空;<br/>\";\r\n          }\r\n          else if(variables.get(curVarObj.name) != null)\r\n          {\r\n            cErrStr += \"第\"+index+\"行变量名【\"+curVarObj.name+\"】已重复;<br/>\";\r\n          }\r\n          else if(WFCore.validator.isNull(curVarObj.type) || curVarObj.type == 0)\r\n          {\r\n            cErrStr += \"第\"+index+\"行变量名【\"+curVarObj.name+\"】未选择变量类型;<br/>\";\r\n          }\r\n          else if(WFCore.validator.isNull(curVarObj.nLength))\r\n          {\r\n            cErrStr += \"第\"+index+\"行变量名【\"+curVarObj.name+\"】变量长度不能为空;<br/>\";\r\n          }\r\n          else\r\n          {\r\n            curVarObj.id = varIndex;\r\n            variables.put(curVarObj.name,curVarObj);\r\n          }\r\n          varIndex++;\r\n        }\r\n      });\r\n      if(cErrStr.length>0)\r\n      {\r\n        WFCore.DialogUtils.alertDialog(\"全局变量配置不规范：<br/>\"+cErrStr);\r\n        return false;\r\n      }\r\n\r\n      //isFormValid\r\n\r\n      this.$refs[\"formItem\"].validate((valid) => {\r\n        if (valid) {\r\n          this.confirm1();\r\n        }else {\r\n          this.$Message.error('请输入版本号');\r\n        }\r\n      })\r\n    },\r\n    confirm1(){\r\n      var than=this;\r\n      var flowProps=this.IVRFormData1;\r\n\r\n      var variables = new WFCore.Map();\r\n      var varIndex = 1;\r\n      var checkVarResult= true;\r\n      //加载全局变量集合\r\n      if(than.wfGlobalVariablesObj != undefined && than.wfGlobalVariablesObj.length>0)\r\n      {\r\n        for(var i=0;i<than.wfGlobalVariablesObj.length;i++)\r\n        {\r\n          var curVarObj = than.wfGlobalVariablesObj[i];\r\n          curVarObj.id = varIndex;\r\n\r\n          if(variables.get(curVarObj.name) != null)\r\n          {\r\n            checkVarResult  = false;\r\n            return;\r\n          }\r\n          variables.put(curVarObj.name,curVarObj);\r\n          varIndex++;\r\n        }\r\n      }\r\n      if(!checkVarResult)\r\n        return;\r\n\r\n      //isAdd\r\n      if (flowProps.designJson==null) {\r\n        var newFlowStore = $.extend(true, {}, this.newInitFlowData);\r\n        flowProps.variables = [];\r\n        variables.each(function(key,value,index){\r\n          flowProps.variables.push(value);\r\n        });\r\n        $.extend(true, newFlowStore, flowProps);\r\n\r\n        $(than.$parent.$refs['myflow']).reloadMyflow({\r\n          restore: newFlowStore\r\n        });\r\n        this.$parent.$data.setFlowModalVisibles=false;\r\n      } else {\r\n        var _myflow=this.$parent.$refs.myflow;\r\n        var flowdata=_myflow.GetMyFlowData();\r\n        $.extend(true, flowdata, flowProps);\r\n        var variableArr = [];\r\n        variables.each(function(key,value,index){\r\n          variableArr.push(value);\r\n        });\r\n        flowdata.reloadVariablesData(variableArr);\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  },\r\n  watch:{\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  .auto-warp{\r\n    //.ivu-table-wrapper{\r\n    //  max-height: 600px;\r\n    //  overflow: auto;\r\n    //  padding-bottom: 30px;\r\n    //}\r\n  }\r\n\r\n</style>"]}]}