{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\my-components\\excel\\excelImport.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\my-components\\excel\\excelImport.vue","mtime":1614579763291},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBleGNlbCBmcm9tICJAL2xpYnMvZXhjZWwiOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGltcG9ydE1vZGFsVmlzaWJsZTogZmFsc2UsCiAgICAgIHJlYWRpbmc6IGZhbHNlLCAvLyDor7vlj5bkuK0KICAgICAgdXBsb2FkZmlsZTogewogICAgICAgIG5hbWU6ICIiCiAgICAgIH0sCiAgICAgIGRhdGE6IFtdLAogICAgICBpbXBvcnRMb2FkaW5nOiBmYWxzZSwgLy8g5a+85YWl5Yqg6L2954q25oCBCiAgICAgIGltcG9ydENvbHVtbnM6IFtdLAogICAgICBpbXBvcnRUYWJsZURhdGE6IFtdLAogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgYmVmb3JlVXBsb2FkSW1wb3J0KGZpbGUpIHsKICAgICAgdGhpcy51cGxvYWRmaWxlID0gZmlsZTsKICAgICAgY29uc3QgZmlsZUV4dCA9IGZpbGUubmFtZQogICAgICAgIC5zcGxpdCgiLiIpCiAgICAgICAgLnBvcCgpCiAgICAgICAgLnRvTG9jYWxlTG93ZXJDYXNlKCk7CiAgICAgIGlmIChmaWxlRXh0ID09ICJ4bHN4IiB8fCBmaWxlRXh0ID09ICJ4bHMiKSB7CiAgICAgICAgdGhpcy5yZWFkRmlsZShmaWxlKTsKICAgICAgICB0aGlzLmZpbGUgPSBmaWxlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJE5vdGljZS53YXJuaW5nKHsKICAgICAgICAgIHRpdGxlOiAi5paH5Lu257G75Z6L6ZSZ6K+vIiwKICAgICAgICAgIGRlc2M6ICLmiYDpgInmlofku7bigJggIiArCiAgICAgICAgICAgIGZpbGUubmFtZSArCiAgICAgICAgICAgICIg4oCZ5LiN5pivRVhDRUzmlofku7bvvIzor7fpgInmi6nlkI7nvIDkuLoueGxzeOaIluiAhS54bHPnmoRFWENFTOaWh+S7tuOAgiIKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgcmVhZEZpbGUoZmlsZSkgewogICAgICB0aGlzLnJlYWRpbmcgPSB0cnVlOwogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7CiAgICAgIHJlYWRlci5vbmVycm9yID0gZSA9PiB7CiAgICAgICAgdGhpcy5yZWFkaW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy4kTWVzc2FnZS5lcnJvcigi5paH5Lu26K+75Y+W5Ye66ZSZIik7CiAgICAgIH07CiAgICAgIHJlYWRlci5vbmxvYWQgPSBlID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS50YXJnZXQucmVzdWx0OwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGhlYWRlciwKICAgICAgICAgIHJlc3VsdHMKICAgICAgICB9ID0gZXhjZWwucmVhZChkYXRhLCAiYXJyYXkiKTsKICAgICAgICBjb25zdCB0YWJsZVRpdGxlID0gaGVhZGVyLm1hcChpdGVtID0+IHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRpdGxlOiBpdGVtLAogICAgICAgICAgICBrZXk6IGl0ZW0sCiAgICAgICAgICAgIG1pbldpZHRoOiAxMDAsCiAgICAgICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmltcG9ydFRhYmxlRGF0YSA9IHJlc3VsdHM7CiAgICAgICAgdGhpcy5pbXBvcnRDb2x1bW5zID0gdGFibGVUaXRsZTsKICAgICAgICB0aGlzLnJlYWRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MoIuivu+WPluaVsOaNruaIkOWKnyIpOwogICAgICB9OwogICAgfSwKICAgIGltcG9ydERhdGEoKSB7CiAgICAgIHRoaXMuaW1wb3J0TG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuJGVtaXQoJ2ltcG9ydCcsdGhpcy5pbXBvcnRUYWJsZURhdGEpCiAgICB9LAogICAgY2xlYXJJbXBvcnREYXRhKCkgewogICAgICB0aGlzLmltcG9ydFRhYmxlRGF0YSA9IFtdOwogICAgICB0aGlzLmltcG9ydENvbHVtbnMgPSBbXTsKICAgICAgdGhpcy51cGxvYWRmaWxlID0ge307CiAgICB9LAogICAgY2xvc2UoKXsKICAgICAgdGhpcy5jbGVhckltcG9ydERhdGEoKQogICAgICB0aGlzLmltcG9ydExvYWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5pbXBvcnRNb2RhbFZpc2libGUgPSBmYWxzZTsKICAgIH0sCiAgfQp9Cg=="},{"version":3,"sources":["excelImport.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"excelImport.vue","sourceRoot":"src/views/my-components/excel","sourcesContent":["<template>\r\n  <Drawer title=\"导入数据\" closable v-model=\"importModalVisible\" width=\"1000\">\r\n    <Row>\r\n      <div style=\"display:flex;justify-content: space-between;align-items: center;\">\r\n        <Upload action :before-upload=\"beforeUploadImport\" accept=\".xls, .xlsx\">\r\n          <Button :loading=\"reading\" icon=\"ios-cloud-upload-outline\" style=\"margin-right:10px\">上传Excel文件</Button>\r\n          <span v-if=\"uploadfile.name\">当前选择文件：{{ uploadfile.name }}</span>\r\n        </Upload>\r\n        <Button @click=\"clearImportData\" icon=\"md-trash\">清空数据</Button>\r\n      </div>\r\n      <Alert type=\"warning\" show-icon>导入前请下载查看导入模版数据文件，确保数据格式正确，不得修改列名称。</Alert>\r\n      <Table :columns=\"importColumns\" border height=\"510\" :data=\"importTableData\" ref=\"importTable\"></Table>\r\n    </Row>\r\n    <div class=\"demo-drawer-footer\">\r\n      <Button :loading=\"importLoading\" :disabled=\"importTableData.length<=0\" @click=\"importData\" class=\"mt-10\" type=\"primary\">确认导入<span v-if=\"importTableData.length>0\">{{importTableData.length}} 条数据</span>\r\n      </Button>\r\n    </div>\r\n  </Drawer>\r\n</template>\r\n\r\n<script>\r\n  import excel from \"@/libs/excel\";\r\n  export default {\r\n    data() {\r\n      return {\r\n        importModalVisible: false,\r\n        reading: false, // 读取中\r\n        uploadfile: {\r\n          name: \"\"\r\n        },\r\n        data: [],\r\n        importLoading: false, // 导入加载状态\r\n        importColumns: [],\r\n        importTableData: [],\r\n      }\r\n    },\r\n    methods: {\r\n      beforeUploadImport(file) {\r\n        this.uploadfile = file;\r\n        const fileExt = file.name\r\n          .split(\".\")\r\n          .pop()\r\n          .toLocaleLowerCase();\r\n        if (fileExt == \"xlsx\" || fileExt == \"xls\") {\r\n          this.readFile(file);\r\n          this.file = file;\r\n        } else {\r\n          this.$Notice.warning({\r\n            title: \"文件类型错误\",\r\n            desc: \"所选文件‘ \" +\r\n              file.name +\r\n              \" ’不是EXCEL文件，请选择后缀为.xlsx或者.xls的EXCEL文件。\"\r\n          });\r\n        }\r\n        return false;\r\n      },\r\n      readFile(file) {\r\n        this.reading = true;\r\n        const reader = new FileReader();\r\n        reader.readAsArrayBuffer(file);\r\n        reader.onerror = e => {\r\n          this.reading = false;\r\n          this.$Message.error(\"文件读取出错\");\r\n        };\r\n        reader.onload = e => {\r\n          const data = e.target.result;\r\n          const {\r\n            header,\r\n            results\r\n          } = excel.read(data, \"array\");\r\n          const tableTitle = header.map(item => {\r\n            return {\r\n              title: item,\r\n              key: item,\r\n              minWidth: 100,\r\n              align: \"center\"\r\n            };\r\n          });\r\n          this.importTableData = results;\r\n          this.importColumns = tableTitle;\r\n          this.reading = false;\r\n          this.$Message.success(\"读取数据成功\");\r\n        };\r\n      },\r\n      importData() {\r\n        this.importLoading = true;\r\n        this.$emit('import',this.importTableData)\r\n      },\r\n      clearImportData() {\r\n        this.importTableData = [];\r\n        this.importColumns = [];\r\n        this.uploadfile = {};\r\n      },\r\n      close(){\r\n        this.clearImportData()\r\n        this.importLoading = false;\r\n        this.importModalVisible = false;\r\n      },\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped=\"scoped\">\r\n  .demo-drawer-footer {\r\n    width: 100%;\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 0;\r\n    border-top: 1px solid #e8e8e8;\r\n    padding: 10px 16px;\r\n    background: #fff;\r\n  }\r\n</style>\r\n"]}]}