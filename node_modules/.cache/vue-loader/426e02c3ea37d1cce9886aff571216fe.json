{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\callcenter\\baseLogSession.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\callcenter\\baseLogSession.vue","mtime":1614579763221},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi8uLi9zdHlsZXMvdGFibGUtY29tbW9uLmxlc3MiOw0K"},{"version":3,"sources":["baseLogSession.vue"],"names":[],"mappings":";AACA","file":"baseLogSession.vue","sourceRoot":"src/views/callcenter","sourcesContent":["<style lang=\"less\">\r\n@import \"../../styles/table-common.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Card>\r\n      <Row v-show=\"openSearch\">\r\n        <Form ref=\"searchForm\" :model=\"searchForm\" inline :label-width=\"75\">\r\n          <Row>\r\n               <Form-item label=\"通话时间\">\r\n                <DatePicker  v-model=\"searchForm.callStartDate\"  type=\"datetime\" format=\"yyyy-MM-dd HH:mm:ss\" style=\"width: 152px\" ></DatePicker>~\r\n                <DatePicker  v-model=\"searchForm.callEndDate\"  type=\"datetime\" format=\"yyyy-MM-dd HH:mm:ss\" style=\"width: 152px\" ></DatePicker>\r\n              </Form-item>\r\n              <FormItem label=\"主叫\" prop=\"caller\"> \r\n                  <Input v-model=\"searchForm.caller\" style=\"width: 120px\" />\r\n              </FormItem>\r\n              <FormItem label=\"被叫\" prop=\"called\">\r\n                  <Input v-model=\"searchForm.called\" style=\"width: 120px\" />\r\n              </FormItem>\r\n              <FormItem label=\"坐席\" prop=\"agentNo\">\r\n                  <Input v-model=\"searchForm.agentNo\" v-show=\"false\" />\r\n                  <user-choose  @click=\"submitUser\" ref=\"user\" style=\"display: inline-block;\"></user-choose>               \r\n              </FormItem>\r\n              <Form-item style=\"margin-left:-35px;\" class=\"br\">\r\n                <Button @click.native=\"handleSearch\" type=\"primary\" icon=\"ios-search\">搜索</Button>\r\n                <Button @click=\"handleReset\">重置</Button>\r\n                <a class=\"drop-down\" @click=\"dropDown\">\r\n                  {{dropDownContent}}\r\n                  <Icon :type=\"dropDownIcon\"></Icon>\r\n                </a>\r\n              </Form-item>\r\n          </Row>\r\n          <span v-if=\"drop\">\r\n          <Row>\r\n               <FormItem label=\"呼叫流水号\" prop=\"sessionId\">\r\n                  <Input v-model=\"searchForm.sessionId\" style=\"width:150px\" />\r\n              </FormItem>\r\n              <FormItem label=\"呼叫状态\" prop=\"callState\">\r\n                  <Select v-model=\"searchForm.callState\" style=\"width:150px\" multiple>\r\n                    <Option  value=\"0\" >留言</Option>\r\n                    <Option  value=\"1\" >排队超时</Option>\r\n                    <Option  value=\"2\" >接听超时</Option>\r\n                    <Option  value=\"3\" >队列客户挂机</Option>\r\n                    <Option  value=\"4\" >满意度调查</Option>\r\n                    <Option  value=\"5\" >已接听</Option>\r\n                    <Option  value=\"6\" >自助语音</Option>\r\n                    <Option  value=\"7\" >呼出中断</Option>\r\n                    <Option  value=\"8\" >呼出取消</Option>\r\n                  </Select>\r\n              </FormItem>\r\n              <FormItem label=\"呼叫类型\" prop=\"sessionType\">\r\n                  <Select v-model=\"searchForm.sessionType\" style=\"width:150px\" multiple>\r\n                    <Option  value=\"0\" >呼入</Option>\r\n                    <Option  value=\"1\" >呼出</Option>\r\n                    <Option  value=\"2\" >预测外呼</Option>\r\n                    <Option  value=\"3\" >自动外呼</Option>\r\n                    <Option  value=\"4\" >手动外呼</Option>\r\n                    <Option  value=\"5\" >下班转外线</Option>\r\n                    <Option  value=\"6\" >IVR转外线</Option>\r\n                    <Option  value=\"7\" >座席转外线</Option>\r\n                    <Option  value=\"8\" >遇忙转外线</Option>\r\n                  </Select>\r\n              </FormItem>\r\n          </Row>\r\n          </span>\r\n        </Form>\r\n      </Row>\r\n      <!-- <Row class=\"operation\">\r\n        <Button type=\"dashed\" @click=\"openSearch=!openSearch\">{{openSearch ? \"关闭搜索\" : \"开启搜索\"}}</Button>\r\n      </Row> -->\r\n      <Row v-show=\"openTip && selectCount > 0\">\r\n        <Alert show-icon>\r\n          已选择\r\n          <span class=\"select-count\">{{selectCount}}</span> 项\r\n          <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\r\n        </Alert>\r\n      </Row>\r\n      <Row>\r\n        <Table\r\n          :loading=\"loading\"\r\n          :columns=\"columns\"\r\n          :data=\"data\"\r\n          sortable=\"custom\"\r\n          @on-sort-change=\"changeSort\"\r\n          @on-selection-change=\"showSelect\"\r\n          ref=\"table\"\r\n        ></Table>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"end\" class=\"page\">\r\n        <Page\r\n          :current=\"searchForm.pageNumber\"\r\n          :total=\"total\"\r\n          :page-size=\"searchForm.pageSize\"\r\n          @on-change=\"changePage\"\r\n          @on-page-size-change=\"changePageSize\"\r\n          :page-size-opts=\"[10,20,50]\"\r\n          size=\"small\"\r\n          show-total\r\n          show-elevator\r\n          show-sizer\r\n        ></Page>\r\n      </Row>\r\n\r\n\r\n    <!-- 查询通话记录详情-start -->\r\n    <Modal :title=\"modalTitle\" v-model=\"detailModalVisible\" :closable=\"false\" :mask-closable=\"false\" :width=\"700\">\r\n      <Form ref=\"detailForm\" :model=\"detailForm\" :label-width=\"100\">\r\n          <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"主叫号码\" prop=\"caller\">\r\n                <Input v-model=\"detailForm.caller\" :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"被叫号码\" prop=\"called\">\r\n                <Input v-model=\"detailForm.called\"  :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n           <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"呼叫类型\" prop=\"sessionType\">\r\n                <Input v-model=\"detailForm.sessionType\" :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"呼叫状态\" prop=\"callState\">\r\n                <Input v-model=\"detailForm.callState\"  :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n           <Row :gutter=\"32\">\r\n             <Col span=\"12\">\r\n              <FormItem label=\"拨打时间\" prop=\"ringDialTimestamp\">\r\n                <Input v-model=\"detailForm.ringDialTimestamp\" :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"接听时间\" prop=\"connectTimestamp\">\r\n                <Input v-model=\"detailForm.connectTimestamp\"  :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>     \r\n           <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"挂断时间\" prop=\"releasedTimestamp\">\r\n                <Input v-model=\"detailForm.releasedTimestamp\"  :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"录音文件\" prop=\"audioFile\">\r\n                <Input v-model=\"detailForm.audioFile\" :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n           <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"振铃时长\" prop=\"ringdialTime\">\r\n                <Input v-model=\"detailForm.ringdialTime\" :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"通话时长\" prop=\"handleTime\">\r\n                <Input v-model=\"detailForm.handleTime\"  :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n           <Row :gutter=\"32\">\r\n            <Col span=\"12\">\r\n              <FormItem label=\"处理坐席\" prop=\"agentNo\">\r\n                <Input v-model=\"detailForm.agentNo\" :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"12\">\r\n              <FormItem label=\"挂断原因\" prop=\"releaseCode\">\r\n                <Input v-model=\"detailForm.releaseCode\"  :disabled=\"detailState\" />\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n      </Form>\r\n      <div slot=\"footer\">\r\n        <Button type=\"text\" @click=\"cancelDetail\">取消</Button>\r\n      </div>\r\n    </Modal>\r\n    <!-- 查询通话记录详情-end -->\r\n\r\n\r\n    </Card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getCallTaskDetailTodo,\r\n  getCallTaskAllLists,       //获取任务记录\r\n  getCallTaskBatchAllLists,  //根据任务id,获取批次记录\r\n  getResultAllLists,         //根据任务id,获取营销结果\r\n  getBaseLogSessionPageList\r\n} from \"@/api/index\";\r\nimport userChoose from \"@/views/callcenter/user-choose\";\r\nexport default {\r\n  components: {\r\n    userChoose\r\n  },\r\n  name: \"callTaskDetail-manage\",\r\n  data() {\r\n    return {\r\n      height: 510,\r\n      showUser: false,\r\n      showType: \"0\",\r\n      openSearch: true,\r\n      openTip: true,\r\n      loading: false,\r\n      reading: false,\r\n      detailState:true,\r\n      drop: false,\r\n      dropDownContent: \"展开\",\r\n      dropDownIcon: \"ios-arrow-down\",\r\n      selectCount: 0,\r\n      selectList: [],\r\n      detailForm: {},\r\n      modalTitle:\"通话详情\",\r\n      detailModalVisible:false,   \r\n      searchForm: {\r\n        taskId:\"\",\r\n        batchId:\"\",\r\n        returnVisit:\"\",\r\n        marketingResult:\"\",\r\n        callResult:\"\",\r\n        mobileNumber:\"\",\r\n        callStartDate : this.addDate()+\" 00:00:00\",\r\n        callEndDate : this.addDate()+\" 23:59:59\",\r\n        pageNumber: 1,\r\n        pageSize: 10,\r\n        sort: \"connect_timestamp\",\r\n        order: \"desc\"\r\n      },\r\n      selectDate: null,\r\n      columns: [\r\n        // {\r\n        //   type: \"selection\",\r\n        //   width: 60,\r\n        //   align: \"center\"\r\n        // },\r\n        {\r\n          type: \"index\",\r\n          width: 60,\r\n          align: \"center\"\r\n        },\r\n        {  title: \"通话时间\", key: \"connectTimestamp\", minWidth: 145,\r\n           render: (h, params) => {\r\n              return h(\r\n                \"a\",\r\n                {\r\n                  on: {\r\n                    click: () => {\r\n                      this.showDetail(params.row);\r\n                    }\r\n                  }\r\n                },\r\n                params.row.connectTimestamp\r\n              );\r\n            }\r\n        },\r\n        {  title: \"主叫号码\", key: \"caller\", minWidth: 125},\r\n        {  title: \"被叫号码\", key: \"called\", minWidth: 125},\r\n        {  title: \"坐席\", key: \"agentNo\", minWidth: 125},\r\n        {  title: \"呼叫流水号\", key: \"sessionId\", minWidth: 125},\r\n        {  title: \"坐席通话时长\", key: \"handleTime\", minWidth: 125},\r\n        {  title: \"排队等待时长\", key: \"queueTime\", minWidth: 125},\r\n        {  title: \"振铃时长\", key: \"ringdialTime\", minWidth: 125},\r\n        {  title: \"呼叫类型\", key: \"sessionType\", minWidth: 125,\r\n              render:(h,params)=>{\r\n                    var typeObj={0:\"呼入\",1:\"呼出\",2:\"预测外呼\",3:\"自动外呼\",4:\"手动外呼\",5:\"下班转外线\",6:\"IVR转外线\",7:\"座席转外线\",8:\"遇忙转外线\"};\r\n                  return h(\"div\",typeObj[params.row.sessionType]);\r\n              }\r\n        },\r\n        {  title: \"挂机原因\", key: \"releaseCode\", minWidth: 125,\r\n                render:(h,params)=>{\r\n                     var typeObj={0:\"未通话挂机\",1:\"客户先挂机\",2:\"坐席先挂机\"};\r\n                    return h(\"div\",typeObj[params.row.callState]);\r\n                }\r\n        },\r\n        {  title: \"满意度调查结果\", key: \"satisfactionCode\", minWidth: 125},\r\n        {  title: \"呼叫状态\", key: \"callState\", minWidth: 125,\r\n                render:(h,params)=>{\r\n                     var typeObj={0:\"留言\",1:\"排队超时\",2:\"接听超时\",3:\"队列客户挂机\",4:\"满意度调查\",5:\"已接听\",6:\"自助语音\",7:\"呼出中断\",8:\"呼出取消\"};\r\n                    return h(\"div\",typeObj[params.row.callState]);\r\n                }\r\n        }\r\n      ],\r\n      data: [],\r\n      total: 0,\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getCallTaskDetailList();\r\n      \r\n    },\r\n    changeSelect(e) {\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n      if(this.selectCount > 0){\r\n         this.openTip = true;\r\n      }else{\r\n         this.openTip = false;\r\n      }\r\n    },\r\n    handleSearch() {\r\n      this.selectList = \"\";\r\n      this.selectCount = 0;\r\n      this.searchForm.pagember = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.getCallTaskDetailList();\r\n    },\r\n    handleReset() {\r\n      this.$refs.searchForm.resetFields();\r\n      this.searchForm.pageNumber = 1;\r\n      this.searchForm.pageSize = 10;\r\n      this.selectDate = null;\r\n      this.searchForm.callStartDate = \"\";\r\n      this.searchForm.callEndDate = \"\";\r\n      this.$refs.dep.clearSelect();\r\n    },\r\n    selectDateRange(v) {\r\n      if (v) {\r\n        this.searchForm.callStartDate = v[0];\r\n        this.searchForm.callEndDate = v[1];\r\n      }\r\n    },\r\n    dropDown() {\r\n      if (this.drop) {\r\n        this.dropDownContent = \"展开\";\r\n        this.dropDownIcon = \"ios-arrow-down\";\r\n      } else {\r\n        this.dropDownContent = \"收起\";\r\n        this.dropDownIcon = \"ios-arrow-up\";\r\n      }\r\n      this.drop = !this.drop;\r\n    },\r\n    changePage(v) {\r\n      this.searchForm.pageNumber = v;\r\n      this.getCallTaskDetailList();\r\n      this.clearSelectAll();\r\n    },\r\n    changePageSize(v) {\r\n      this.searchForm.pageSize = v;\r\n      this.getCallTaskDetailList();\r\n    },\r\n    clearSelectAll() {\r\n      this.$refs.table.selectAll(false);\r\n    },\r\n    showSelect(e) {\r\n      this.selectList = e;\r\n      this.selectCount = e.length;\r\n    },\r\n    changeSort(e) {\r\n      this.searchForm.sort = e.key;\r\n      this.searchForm.order = e.order;\r\n      if (e.order == \"normal\") {\r\n        this.searchForm.order = \"\";\r\n      }\r\n      this.getCallTaskDetailList();\r\n    },\r\n    addDate(toDay) {\r\n      let nowDate = \"\";\r\n      if(toDay){\r\n        nowDate = toDay;\r\n      }else{\r\n        nowDate = new Date();\r\n      }\r\n      let date = {\r\n        year: nowDate.getFullYear(),\r\n        month: nowDate.getMonth() + 1,\r\n        date: nowDate.getDate()\r\n      }\r\n      let month = date.month < 10 ? '0'+date.month:date.month;\r\n      let day = date.date < 10 ? '0'+date.date:date.date;\r\n      let systemTime = date.year + '-' + month + '-' + day;\r\n      return systemTime;\r\n    },\r\n    submitUser(v){\r\n      let ids = \"\";\r\n      v.forEach(function(e) {\r\n        console.log(e);\r\n        ids += e.userCode + \",\";\r\n      });\r\n      ids = ids.substring(0, ids.length - 1);\r\n      this.searchForm.agentNo = ids;\r\n    },\r\n    getCallTaskDetailList() {\r\n        this.loading = true;\r\n        var formdata={};\r\n        for(var i in this.searchForm){\r\n          if(this.searchForm[i] != null && this.searchForm[i] !=\"\"){\r\n            if(i==\"sessionType\" || i==\"callState\"){\r\n              formdata[i] = this.searchForm[i].toString();\r\n            }else{\r\n              formdata[i] = this.searchForm[i];\r\n            }\r\n          }\r\n        }\r\n        getBaseLogSessionPageList(formdata).then(res => {\r\n          this.loading = false;\r\n          if (res.success) {\r\n            this.data = res.result.list;\r\n            this.total = res.result.total;\r\n          }\r\n        });\r\n    },\r\n    showDetail(v) {\r\n      var data = {};\r\n      for (var i in v) {\r\n        if (v[i] != null) {\r\n          if(i==\"sessionType\"){\r\n            var sessionType={0:\"呼入\",1:\"呼出\",2:\"预测外呼\",3:\"自动外呼\",4:\"手动外呼\",5:\"下班转外线\",6:\"IVR转外线\",7:\"座席转外线\",8:\"遇忙转外线\"};\r\n            v[i] = sessionType[v[i]];\r\n          }\r\n          if(i==\"callState\"){\r\n            var callState={0:\"留言\",1:\"排队超时\",2:\"接听超时\",3:\"队列客户挂机\",4:\"满意度调查\",5:\"已接听\",6:\"自助语音\",7:\"呼出中断\",8:\"呼出取消\"};\r\n            v[i] = callState[v[i]];\r\n          }\r\n          if(i==\"releaseCode\"){\r\n            var releaseCode={0:\"未通话挂机\",1:\"客户先挂机\",2:\"坐席先挂机\"};\r\n            v[i] = releaseCode[v[i]];\r\n          }\r\n          data[i] = v[i];\r\n        }\r\n      }\r\n      this.detailForm = data;\r\n      this.detailModalVisible = true;\r\n    },\r\n    cancelDetail(){\r\n      this.detailModalVisible = false;\r\n      this.detailForm = {};\r\n    }\r\n  },\r\n  mounted() {\r\n    // 计算高度\r\n    this.height = Number(document.documentElement.clientHeight - 230);\r\n    this.init();\r\n  }\r\n};\r\n</script>"]}]}