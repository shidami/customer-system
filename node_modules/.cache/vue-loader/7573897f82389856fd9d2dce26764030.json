{"remainingRequest":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\activiti\\process-manage\\processNodeEdit.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\src\\views\\activiti\\process-manage\\processNodeEdit.vue","mtime":1614579763211},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Documents\\shimin\\current project\\xrcc-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi8uLi8uLi9zdHlsZXMvdHJlZS1jb21tb24ubGVzcyI7DQpAaW1wb3J0ICIuLi8uLi8uLi9zdHlsZXMvc2luZ2xlLWNvbW1vbi5sZXNzIjsNCkBpbXBvcnQgIi4vcHJvY2Vzc01hbmFnZS5sZXNzIjsNCg=="},{"version":3,"sources":["processNodeEdit.vue"],"names":[],"mappings":";AACA;AACA;AACA","file":"processNodeEdit.vue","sourceRoot":"src/views/activiti/process-manage","sourcesContent":["<style lang=\"less\">\r\n@import \"../../../styles/tree-common.less\";\r\n@import \"../../../styles/single-common.less\";\r\n@import \"./processManage.less\";\r\n</style>\r\n<template>\r\n  <div class=\"search\">\r\n    <Card style=\"min-height: 600px\">\r\n      <div slot=\"title\">\r\n        <div class=\"edit-head\">\r\n          <a @click=\"close\" class=\"back-title\">\r\n            <Icon type=\"ios-arrow-back\" />返回\r\n          </a>\r\n          <div class=\"head-name\">{{processName}} 流程配置</div>\r\n          <span></span>\r\n          <a @click=\"close\" class=\"window-close\">\r\n            <Icon type=\"ios-close\" size=\"31\" class=\"ivu-icon-ios-close\" />\r\n          </a>\r\n        </div>\r\n      </div>\r\n      <div style=\"display:flex;justify-content:center;margin: 10px 0 30px 0;\">\r\n        <Steps :current=\"current\" style=\"width: 400px\">\r\n          <Step title=\"基本配置\"></Step>\r\n          <Step title=\"节点审批人配置\"></Step>\r\n        </Steps>\r\n      </div>\r\n      <Row type=\"flex\" justify=\"center\" v-show=\"current==0\">\r\n        <Col :xs=\"24\" :md=\"24\" :lg=\"16\" :xl=\"9\">\r\n          <Form\r\n            ref=\"basicForm\"\r\n            :model=\"basicForm\"\r\n            label-position=\"left\"\r\n            :label-width=\"110\"\r\n            :rules=\"formValidate\"\r\n          >\r\n            <FormItem label=\"关联表单路由\" prop=\"routeName\">\r\n              <Select v-model=\"basicForm.routeName\" placeholder=\"请选择关联业务表单前端路由名\" clearable @on-change=\"handelSubmitEdit\">\r\n                <Option\r\n                  v-for=\"(item, i) in dictForm\"\r\n                  :key=\"i\"\r\n                  :value=\"item.value\"\r\n                  :label=\"item.title\"\r\n                >\r\n                  <span style=\"margin-right:10px;\">{{ item.title }}</span>\r\n                  <span style=\"color:#ccc;\">{{ item.value }}</span>\r\n                </Option>\r\n              </Select>\r\n            </FormItem>\r\n            <FormItem label=\"关联业务表\" prop=\"businessTable\">\r\n              <Select v-model=\"basicForm.businessTable\" placeholder=\"请选择关联数据库业务表\" clearable @on-change=\"handelSubmitEdit\">\r\n                <Option\r\n                  v-for=\"(item, i) in dictTable\"\r\n                  :key=\"i\"\r\n                  :value=\"item.value\"\r\n                  :label=\"item.title\"\r\n                >\r\n                  <span style=\"margin-right:10px;\">{{ item.title }}</span>\r\n                  <span style=\"color:#ccc;\">{{ item.value }}</span>\r\n                </Option>\r\n              </Select>\r\n            </FormItem>\r\n            <FormItem label=\"流程分类\">\r\n              <div style=\"display:flex;\">\r\n                <Input\r\n                  v-model=\"categoryTitle\"\r\n                  readonly\r\n                  clearable\r\n                  @on-clear=\"clearSelectCat\"\r\n                  style=\"margin-right:10px;\"\r\n                />\r\n                <Poptip trigger=\"click\" placement=\"right\" title=\"选择类别\" width=\"250\">\r\n                  <Button icon=\"md-list\">选择分类</Button>\r\n                  <div slot=\"content\">\r\n                    <Input\r\n                      v-model=\"searchKey\"\r\n                      suffix=\"ios-search\"\r\n                      @on-change=\"searchCat\"\r\n                      placeholder=\"输入分类名搜索\"\r\n                      clearable\r\n                    />\r\n                    <div class=\"tree-list\">\r\n                      <Tree :data=\"dataCat\" :load-data=\"loadDataTree\" :render=\"renderCatContent\"></Tree>\r\n                      <Spin size=\"large\" fix v-if=\"catLoading\"></Spin>\r\n                    </div>\r\n                  </div>\r\n                </Poptip>\r\n              </div>\r\n            </FormItem>\r\n            <FormItem label=\"备注描述\" prop=\"description\">\r\n              <Input v-model=\"basicForm.description\" type=\"textarea\" :rows=\"4\" @on-blur=\"handelSubmitEdit\"/>\r\n            </FormItem>\r\n            <FormItem class=\"br\">\r\n              <Button type=\"warning\" @click=\"current=1\">\r\n                下一步\r\n                <Icon type=\"ios-arrow-forward\" />\r\n              </Button>\r\n              <Button @click=\"close\">关闭</Button>\r\n            </FormItem>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n      <Row type=\"flex\" justify=\"start\" v-if=\"current==1\">\r\n        <Col :md=\"8\" :lg=\"8\" :xl=\"6\">\r\n          <Alert show-icon>\r\n            当前选择编辑：\r\n            <span class=\"select-title\">{{editTitle}}</span>\r\n            <a class=\"select-clear\" v-if=\"form.id\" @click=\"cancelEdit\">取消选择</a>\r\n          </Alert>\r\n          <div class=\"tree-bar\">\r\n            <Tree ref=\"tree\" :data=\"data\" :render=\"renderContent\" @on-select-change=\"selectTree\"></Tree>\r\n            <Spin size=\"large\" fix v-if=\"loading\"></Spin>\r\n          </div>\r\n        </Col>\r\n        <Col :md=\"15\" :lg=\"13\" :xl=\"10\" style=\"margin-left:10px;\">\r\n          <Alert\r\n            type=\"warning\"\r\n            show-icon\r\n            style=\"margin-left: 1vw\"\r\n          >温馨提示：若流程运行至未分配审批人员的审批节点时，流程将自动中断取消</Alert>\r\n          <Form ref=\"form\" :model=\"form\" :label-width=\"90\" style=\"position:relative\">\r\n            <FormItem label=\"节点名称\" prop=\"title\">\r\n              {{form.title}}\r\n              <Tooltip\r\n                content=\"配置可看到该流程的所属用户，默认所有人可发起\"\r\n                placement=\"right\"\r\n                transfer\r\n                max-width=\"280\"\r\n                style=\"display: inline-block !important;\"\r\n              >\r\n                <Icon\r\n                  type=\"md-help-circle\"\r\n                  size=\"20\"\r\n                  color=\"#c5c5c5\"\r\n                  style=\"margin-left:5px;cursor:pointer;\"\r\n                  v-show=\"form.type==0\"\r\n                />\r\n              </Tooltip>\r\n            </FormItem>\r\n            <Form-item label=\"节点类型\" prop=\"type\">\r\n              <Select v-model=\"form.type\" disabled style=\"width: 300px\">\r\n                <Option\r\n                  v-for=\"(item, i) in dictNodeType\"\r\n                  :key=\"i\"\r\n                  :value=\"item.value\"\r\n                >{{item.title}}</Option>\r\n              </Select>\r\n            </Form-item>\r\n            <div v-show=\"form.type==0\">\r\n              <FormItem label=\"可发起人员\">\r\n                <Checkbox v-model=\"allUser\">\r\n                  <Icon type=\"md-contacts\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>所有人</span>\r\n                </Checkbox>\r\n                <Checkbox v-model=\"chooseRole\" @on-change=\"clickRole\" :disabled=\"allUser\">\r\n                  <Icon type=\"md-people\" size=\"14\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>指定角色</span>\r\n                </Checkbox>\r\n                <Checkbox\r\n                  v-model=\"chooseDepartment\"\r\n                  @on-change=\"clickDepartment\"\r\n                  :disabled=\"allUser\"\r\n                >\r\n                  <Icon type=\"ios-people\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>指定部门</span>\r\n                </Checkbox>\r\n                <Checkbox v-model=\"chooseUser\" @on-change=\"clickUser\" :disabled=\"allUser\">\r\n                  <Icon type=\"md-person\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>指定人员</span>\r\n                </Checkbox>\r\n              </FormItem>\r\n            </div>\r\n            <div v-show=\"form.type==1\">\r\n              <FormItem label=\"可审批人员\">\r\n                <Checkbox v-model=\"chooseRole\" @on-change=\"clickRole\" :disabled=\"form.customUser\">\r\n                  <Icon type=\"md-people\" size=\"14\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>指定角色</span>\r\n                </Checkbox>\r\n                <Checkbox\r\n                  v-model=\"chooseDepartment\"\r\n                  @on-change=\"clickDepartment\"\r\n                  :disabled=\"form.customUser\"\r\n                >\r\n                  <Icon type=\"ios-people\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>指定部门负责人</span>\r\n                </Checkbox>\r\n                <Checkbox v-model=\"chooseUser\" @on-change=\"clickUser\" :disabled=\"form.customUser\">\r\n                  <Icon type=\"md-person\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>指定人员</span>\r\n                </Checkbox>\r\n                <Checkbox v-model=\"form.customUser\">\r\n                  <Icon type=\"md-contacts\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>审批人自选</span>\r\n                  <Tooltip\r\n                    content=\"审批人任意自选用户，请勿在网关后设置\"\r\n                    placement=\"right\"\r\n                    transfer\r\n                    max-width=\"280\"\r\n                    style=\"display: inline-block !important;\"\r\n                  >\r\n                    <Icon\r\n                      type=\"md-help-circle\"\r\n                      size=\"20\"\r\n                      color=\"#c5c5c5\"\r\n                      style=\"margin-left:10px;cursor:pointer;\"\r\n                    />\r\n                  </Tooltip>\r\n                </Checkbox>\r\n                <Checkbox v-model=\"form.chooseDepHeader\" :disabled=\"form.customUser\">\r\n                  <Icon type=\"md-person\" style=\"margin:0 2px 0 0\"></Icon>\r\n                  <span>连续多级部门负责人</span>\r\n                  <Tooltip\r\n                    content=\"自动获取发起人或上一审批人的部门负责人\"\r\n                    placement=\"right\"\r\n                    transfer\r\n                    max-width=\"280\"\r\n                    style=\"display: inline-block !important;\"\r\n                  >\r\n                    <Icon\r\n                      type=\"md-help-circle\"\r\n                      size=\"20\"\r\n                      color=\"#c5c5c5\"\r\n                      style=\"margin-left:10px;cursor:pointer;\"\r\n                    />\r\n                  </Tooltip>\r\n                </Checkbox>\r\n              </FormItem>\r\n            </div>\r\n            <FormItem\r\n              label=\"选择角色\"\r\n              v-show=\"chooseRole&&((form.type==0&&!allUser)||(form.type==1&&!form.customUser))\"\r\n            >\r\n              <Select v-model=\"form.roles\" multiple>\r\n                <Option v-for=\"item in roleList\" :value=\"item.id\" :key=\"item.id\" :label=\"item.name\">\r\n                  <span style=\"margin-right:10px;\">{{ item.name }}</span>\r\n                  <span style=\"color:#ccc;\">{{ item.description }}</span>\r\n                </Option>\r\n              </Select>\r\n            </FormItem>\r\n            <div v-show=\"chooseDepartment&&((form.type==0&&!allUser)||(form.type==1&&!form.customUser))\">\r\n              <FormItem label=\"选择部门\">\r\n                <department-tree-choose\r\n                  multiple\r\n                  width=\"250px\"\r\n                  @on-change=\"handleSelectDepTree\"\r\n                  ref=\"depTree\"\r\n                ></department-tree-choose>\r\n              </FormItem>\r\n            </div>\r\n            <div v-show=\"chooseUser&&((form.type==0&&!allUser)||(form.type==1&&!form.customUser))\">\r\n              <FormItem label=\"选择用户\">\r\n                <user-choose @on-change=\"handleSelectUser\" ref=\"user\"></user-choose>\r\n              </FormItem>\r\n            </div>\r\n            <Form-item class=\"br\">\r\n              <Button\r\n                type=\"primary\"\r\n                :loading=\"submitLoading\"\r\n                @click=\"handelSubmit\"\r\n                icon=\"ios-create-outline\"\r\n                :disabled=\"form.type!=0&&form.type!=1\"\r\n              >保存并提交</Button>\r\n              <Button type=\"warning\" icon=\"ios-arrow-back\" @click=\"current=0\">上一步</Button>\r\n              <Button @click=\"close\">关闭</Button>\r\n            </Form-item>\r\n            <Spin size=\"large\" fix v-if=\"nodeLoading\"></Spin>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n    </Card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getProcessNode,\r\n  editStartUser,\r\n  editNodeUser,\r\n  updateInfo,\r\n  initActCategory,\r\n  loadActCategory,\r\n  searchActCategory\r\n} from \"@/api/activiti\";\r\nimport { getAllRoleList, getDictDataByType } from \"@/api/index\";\r\nimport userChoose from \"@/views/my-components/xboot/user-choose\";\r\nimport departmentTreeChoose from \"@/views/my-components/xboot/department-tree-choose\";\r\nexport default {\r\n  name: \"process_node_edit\",\r\n  components: {\r\n    userChoose,\r\n    departmentTreeChoose\r\n  },\r\n  props: {\r\n    nodeEditData: Object\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false, // 表单加载状态\r\n      nodeLoading: false,\r\n      data: [],\r\n      editTitle: \"\",\r\n      selectUsers: [],\r\n      dataCat: [],\r\n      catLoading: false,\r\n      searchKey: \"\",\r\n      basicForm: {\r\n        routeName: \"\",\r\n        businessTable: \"\",\r\n        description: \"\"\r\n      },\r\n      formValidate: {\r\n        routeName: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\r\n        businessTable: [\r\n          { required: true, message: \"不能为空\", trigger: \"blur\" }\r\n        ]\r\n      },\r\n      categoryTitle: \"\",\r\n      dictTable: [],\r\n      dictForm: [],\r\n      form: {\r\n        // 添加或编辑表单对象初始化数据\r\n        title: \"\",\r\n        content: \"\",\r\n        type: null,\r\n        roles: [],\r\n        departmentIds: [],\r\n        chooseDepHeader: false,\r\n        customUser: false\r\n      },\r\n      roleList: [],\r\n      submitLoading: false, // 添加或编辑提交状态\r\n      chooseRole: false,\r\n      chooseUser: false,\r\n      chooseDepartment: false,\r\n      allUser: true,\r\n      current: 0,\r\n      dictNodeType: [],\r\n      processName: \"\",\r\n      processId: \"\"\r\n    };\r\n  },\r\n  methods: {\r\n    init() {\r\n      this.getDictDataType();\r\n      this.getRoleList();\r\n      this.initCategoryTreeData();\r\n      this.processId = this.nodeEditData.id;\r\n      this.processName = this.nodeEditData.name;\r\n      this.basicForm.id = this.nodeEditData.id;\r\n      this.basicForm.routeName = this.nodeEditData.routeName;\r\n      this.basicForm.businessTable = this.nodeEditData.businessTable;\r\n      this.basicForm.description = this.nodeEditData.description;\r\n      this.basicForm.categoryId = this.nodeEditData.categoryId;\r\n      this.categoryTitle = this.nodeEditData.categoryTitle;\r\n      let allUser = this.nodeEditData.allUser + \"\";\r\n      if (allUser == \"false\") {\r\n        this.allUser = false;\r\n      } else {\r\n        this.allUser = true;\r\n      }\r\n    },\r\n    getDictDataType() {\r\n      getDictDataByType(\"process_node_type\").then(res => {\r\n        if (res.success) {\r\n          this.dictNodeType = res.result;\r\n          this.getData();\r\n        }\r\n      });\r\n      getDictDataByType(\"business_table\").then(res => {\r\n        if (res.success) {\r\n          this.dictTable = res.result;\r\n        }\r\n      });\r\n      getDictDataByType(\"business_form\").then(res => {\r\n        if (res.success) {\r\n          this.dictForm = res.result;\r\n        }\r\n      });\r\n    },\r\n    renderCatContent(h, { root, node, data }) {\r\n      let icon = \"\";\r\n      if (data.type == \"0\") {\r\n        icon = \"md-folder-open\";\r\n      } else if (data.type == \"1\") {\r\n        icon = \"ios-bookmark-outline\";\r\n      }\r\n      return h(\r\n        \"span\",\r\n        {\r\n          style: {\r\n            display: \"inline-block\",\r\n            cursor: \"pointer\"\r\n          },\r\n          on: {\r\n            click: () => {\r\n              this.selectCatTree(data);\r\n            }\r\n          }\r\n        },\r\n        [\r\n          h(\"span\", [\r\n            h(\"Icon\", {\r\n              props: {\r\n                type: icon,\r\n                size: \"16\"\r\n              },\r\n              style: {\r\n                \"margin-right\": \"8px\",\r\n                \"margin-bottom\": \"3px\"\r\n              }\r\n            }),\r\n            h(\"span\", data.title)\r\n          ])\r\n        ]\r\n      );\r\n    },\r\n    initCategoryTreeData() {\r\n      initActCategory().then(res => {\r\n        if (res.success) {\r\n          res.result.forEach(function(e) {\r\n            if (e.isParent) {\r\n              e.loading = false;\r\n              e.children = [];\r\n            }\r\n            if (e.status == -1) {\r\n              e.title = \"[已禁用] \" + e.title;\r\n              e.disabled = true;\r\n            }\r\n          });\r\n          this.dataCat = res.result;\r\n        }\r\n      });\r\n    },\r\n    loadDataTree(item, callback) {\r\n      loadActCategory(item.id).then(res => {\r\n        if (res.success) {\r\n          res.result.forEach(function(e) {\r\n            if (e.isParent) {\r\n              e.loading = false;\r\n              e.children = [];\r\n            }\r\n            if (e.status == -1) {\r\n              e.title = \"[已禁用] \" + e.title;\r\n              e.disabled = true;\r\n            }\r\n          });\r\n          callback(res.result);\r\n        }\r\n      });\r\n    },\r\n    searchCat() {\r\n      // 搜索部门\r\n      if (this.searchKey) {\r\n        this.catLoading = true;\r\n        searchActCategory({ title: this.searchKey }).then(res => {\r\n          this.catLoading = false;\r\n          if (res.success) {\r\n            res.result.forEach(function(e) {\r\n              if (e.status == -1) {\r\n                e.title = \"[已禁用] \" + e.title;\r\n                e.disabled = true;\r\n              }\r\n            });\r\n            this.dataCat = res.result;\r\n          }\r\n        });\r\n      } else {\r\n        this.initCategoryTreeData();\r\n      }\r\n    },\r\n    selectCatTree(v) {\r\n      if (v) {\r\n        // 转换null为\"\"\r\n        for (let attr in v) {\r\n          if (v[attr] == null) {\r\n            v[attr] = \"\";\r\n          }\r\n        }\r\n        let str = JSON.stringify(v);\r\n        let data = JSON.parse(str);\r\n        if (data.type == 0) {\r\n          this.$Message.warning(\"请选择一个类别\");\r\n          return;\r\n        }\r\n        this.basicForm.categoryId = data.id;\r\n        this.categoryTitle = data.title;\r\n        this.handelSubmitEdit();\r\n      }\r\n    },\r\n    clearSelectCat() {\r\n      this.basicForm.categoryId = \"\";\r\n      this.categoryTitle = \"\";\r\n      this.handelSubmitEdit();\r\n    },\r\n    handelSubmitEdit() {\r\n      this.$refs.basicForm.validate(valid => {\r\n        if (valid) {\r\n          updateInfo(this.basicForm).then(res => {\r\n            if (res.success) {\r\n              this.$Message.success(\"操作成功\");\r\n              this.$emit(\"submited\", true);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    getRoleList() {\r\n      getAllRoleList().then(res => {\r\n        if (res.success) {\r\n          this.roleList = res.result;\r\n        }\r\n      });\r\n    },\r\n    getData() {\r\n      this.loading = true;\r\n      getProcessNode(this.processId).then(res => {\r\n        this.loading = false;\r\n        if (res.success) {\r\n          // 转换null为\"\"\r\n          let v = res.result;\r\n          for (let attr in v) {\r\n            if (v[attr] == null) {\r\n              v[attr] = \"\";\r\n            }\r\n          }\r\n          let str = JSON.stringify(v);\r\n          let data = JSON.parse(str);\r\n          data.forEach(e => {\r\n            this.dictNodeType.forEach(t => {\r\n              t.value = Number(t.value);\r\n              if (!e.title && e.type == t.value) {\r\n                e.title = t.title;\r\n              }\r\n            });\r\n          });\r\n          this.data = data;\r\n        }\r\n      });\r\n    },\r\n    renderContent(h, { root, node, data }) {\r\n      let color = \"\",\r\n        word = \"\",\r\n        title = data.title;\r\n      if (data.type == 0) {\r\n        color = \"#47cb89\";\r\n        word = \"开\";\r\n        title = title + \"【谁可以发起】\";\r\n      } else if (data.type == 1) {\r\n        color = \"#2db7f5\";\r\n        word = \"审\";\r\n      } else if (data.type == 2) {\r\n        word = \"结\";\r\n      } else {\r\n        color = \"#f90\";\r\n        word = \"其他\";\r\n      }\r\n      return h(\"span\", [\r\n        h(\"span\", [\r\n          h(\r\n            \"Avatar\",\r\n            {\r\n              props: {\r\n                size: \"small\"\r\n              },\r\n              style: {\r\n                background: color,\r\n                \"margin-right\": \"5px\"\r\n              }\r\n            },\r\n            word\r\n          ),\r\n          h(\"span\", title)\r\n        ])\r\n      ]);\r\n    },\r\n    selectTree(v) {\r\n      if (v.length > 0) {\r\n        // 转换null为\"\"\r\n        for (let attr in v[0]) {\r\n          if (v[0][attr] == null) {\r\n            v[0][attr] = \"\";\r\n          }\r\n        }\r\n        let str = JSON.stringify(v[0]);\r\n        let data = JSON.parse(str);\r\n        this.selectUsers = data.users;\r\n        this.editTitle = data.title;\r\n        // 回显用户\r\n        if (data.users && data.users.length > 0) {\r\n          this.chooseUser = true;\r\n          this.$refs.user.setData(data.users);\r\n        } else {\r\n          this.chooseUser = false;\r\n          this.$refs.user.setData([]);\r\n        }\r\n        // 回显角色\r\n        if (data.roles && data.roles.length > 0) {\r\n          this.chooseRole = true;\r\n          let roleIds = [];\r\n          data.roles.forEach(e => {\r\n            roleIds.push(e.id);\r\n          });\r\n          data.roles = roleIds;\r\n        } else {\r\n          this.chooseRole = false;\r\n        }\r\n        // 回显部门\r\n        if (data.departments && data.departments.length > 0) {\r\n          this.chooseDepartment = true;\r\n          let departmentIds = [],\r\n            title = \"\";\r\n          data.departments.forEach(e => {\r\n            departmentIds.push(e.id);\r\n            if (title == \"\") {\r\n              title = e.title;\r\n            } else {\r\n              title = title + \"、\" + e.title;\r\n            }\r\n          });\r\n          this.$refs.depTree.setData(departmentIds, title);\r\n          data.departmentIds = departmentIds;\r\n        } else {\r\n          this.chooseDepartment = false;\r\n          this.$refs.depTree.setData([], \"\");\r\n        }\r\n        this.form = data;\r\n      } else {\r\n        this.cancelEdit();\r\n      }\r\n    },\r\n    cancelEdit() {\r\n      let data = this.$refs.tree.getSelectedNodes()[0];\r\n      if (data) {\r\n        data.selected = false;\r\n      }\r\n      this.$refs.form.resetFields();\r\n      this.form.id = \"\";\r\n      delete this.form.id;\r\n      this.editTitle = \"\";\r\n    },\r\n    handelSubmit() {\r\n      this.submitLoading = true;\r\n      // 用户id数据\r\n      let ids = [];\r\n      this.selectUsers.forEach(e => {\r\n        ids += e.id + \",\";\r\n      });\r\n      if (ids.length > 0) {\r\n        ids = ids.substring(0, ids.length - 1);\r\n      }\r\n      this.form.nodeId = this.form.id;\r\n      if (this.chooseUser) {\r\n        if (ids && ids.length > 0) {\r\n          this.form.userIds = ids;\r\n        }\r\n      }\r\n      if (this.chooseRole) {\r\n        if (this.form.roles && this.form.roles.length > 0) {\r\n          this.form.roleIds = this.form.roles;\r\n        }\r\n      }\r\n      if (this.form.type == 0) {\r\n        this.form.nodeId = this.processId;\r\n        this.form.allUser = this.allUser;\r\n        editStartUser(this.form).then(res => {\r\n          this.submitLoading = false;\r\n          if (res.success) {\r\n            this.$Message.success(\"操作成功\");\r\n            this.getData();\r\n            this.$emit(\"submited\", true);\r\n          }\r\n        });\r\n      } else {\r\n        editNodeUser(this.form).then(res => {\r\n          this.submitLoading = false;\r\n          if (res.success) {\r\n            this.$Message.success(\"操作成功\");\r\n            this.getData();\r\n          }\r\n        });\r\n      }\r\n    },\r\n    clickRole(v) {\r\n      this.chooseRole = v;\r\n    },\r\n    clickUser(v) {\r\n      this.chooseUser = v;\r\n    },\r\n    clickDepartment(v) {\r\n      this.chooseDepartment = v;\r\n    },\r\n    handleSelectUser(v) {\r\n      this.selectUsers = v;\r\n    },\r\n    handleSelectDepTree(v) {\r\n      this.form.departmentIds = v;\r\n    },\r\n    close() {\r\n      this.$emit(\"close\", true);\r\n    }\r\n  },\r\n  mounted() {\r\n    this.init();\r\n  }\r\n};\r\n</script>"]}]}